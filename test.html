<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BHRC System Test Page</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="assets/css/styles.css" rel="stylesheet">
    <link href="assets/css/auth.css" rel="stylesheet">
    <link href="assets/css/admin.css" rel="stylesheet">
    <style>
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section h2 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .test-form {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        .test-form h3 {
            margin-top: 0;
            color: #495057;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            font-size: 14px;
        }
        .form-control.error {
            border-color: #dc3545;
            background-color: #fff5f5;
        }
        .form-error {
            color: #dc3545;
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }
        .form-error.show {
            display: block;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        .btn-primary {
            background-color: #007bff;
            color: white;
        }
        .btn-success {
            background-color: #28a745;
            color: white;
        }
        .btn-danger {
            background-color: #dc3545;
            color: white;
        }
        .btn-info {
            background-color: #17a2b8;
            color: white;
        }
        .test-results {
            background: #e9ecef;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-success { background-color: #28a745; }
        .status-error { background-color: #dc3545; }
        .status-warning { background-color: #ffc107; }
        .status-info { background-color: #17a2b8; }
        
        .api-test {
            display: flex;
            align-items: center;
            padding: 10px;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        .api-test .endpoint {
            flex: 1;
            font-family: monospace;
            font-size: 12px;
        }
        .api-test .method {
            background: #6c757d;
            color: white;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 10px;
            margin-right: 10px;
        }
        .api-test .method.GET { background: #28a745; }
        .api-test .method.POST { background: #007bff; }
        .api-test .method.PUT { background: #ffc107; color: #000; }
        .api-test .method.DELETE { background: #dc3545; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1><i class="fas fa-flask"></i> BHRC System Test Suite</h1>
        
        <!-- Form Validation Tests -->
        <div class="test-section">
            <h2><i class="fas fa-check-circle"></i> Form Validation Tests</h2>
            <div class="test-grid">
                <!-- User Registration Form Test -->
                <div class="test-form">
                    <h3>User Registration Validation</h3>
                    <form data-validate="true" id="registrationTestForm">
                        <div class="form-group">
                            <label>Full Name</label>
                            <input type="text" class="form-control" name="name" 
                                   data-rules="required|alpha|minLength:2|maxLength:50"
                                   data-sanitize="name">
                            <div class="form-error" id="nameError"></div>
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" class="form-control" name="email" 
                                   data-rules="required|email"
                                   data-sanitize="email">
                            <div class="form-error" id="emailError"></div>
                        </div>
                        <div class="form-group">
                            <label>Phone</label>
                            <input type="tel" class="form-control" name="phone" 
                                   data-rules="required|phone"
                                   data-format="phone"
                                   data-sanitize="phone">
                            <div class="form-error" id="phoneError"></div>
                        </div>
                        <div class="form-group">
                            <label>Password</label>
                            <input type="password" class="form-control" name="password" 
                                   data-rules="required|strongPassword">
                            <div class="form-error" id="passwordError"></div>
                        </div>
                        <button type="submit" class="btn btn-primary">Test Registration</button>
                        <button type="button" class="btn btn-info" onclick="fillTestData('registrationTestForm')">Fill Test Data</button>
                    </form>
                    <div class="test-results" id="registrationResults"></div>
                </div>

                <!-- Complaint Form Test -->
                <div class="test-form">
                    <h3>Complaint Form Validation</h3>
                    <form data-validate="true" id="complaintTestForm">
                        <div class="form-group">
                            <label>Complainant Name</label>
                            <input type="text" class="form-control" name="complainant_name" 
                                   data-rules="required|alpha|minLength:2"
                                   data-sanitize="name">
                            <div class="form-error" id="complainant_nameError"></div>
                        </div>
                        <div class="form-group">
                            <label>Category</label>
                            <select class="form-control" name="category" 
                                    data-rules="required|complaintCategory">
                                <option value="">Select Category</option>
                                <option value="human_rights_violation">Human Rights Violation</option>
                                <option value="discrimination">Discrimination</option>
                                <option value="police_brutality">Police Brutality</option>
                                <option value="other">Other</option>
                            </select>
                            <div class="form-error" id="categoryError"></div>
                        </div>
                        <div class="form-group">
                            <label>Description</label>
                            <textarea class="form-control" name="description" rows="3"
                                      data-rules="required|minLength:10|maxLength:1000"
                                      data-sanitize="html"></textarea>
                            <div class="form-error" id="descriptionError"></div>
                        </div>
                        <div class="form-group">
                            <label>Incident Date</label>
                            <input type="date" class="form-control" name="incident_date" 
                                   data-rules="required|date">
                            <div class="form-error" id="incident_dateError"></div>
                        </div>
                        <button type="submit" class="btn btn-primary">Test Complaint</button>
                        <button type="button" class="btn btn-info" onclick="fillTestData('complaintTestForm')">Fill Test Data</button>
                    </form>
                    <div class="test-results" id="complaintResults"></div>
                </div>

                <!-- Member Registration Test -->
                <div class="test-form">
                    <h3>Member Registration Validation</h3>
                    <form data-validate="true" id="memberTestForm">
                        <div class="form-group">
                            <label>Aadhar Number</label>
                            <input type="text" class="form-control" name="aadhar" 
                                   data-rules="required|aadhar"
                                   data-format="aadhar"
                                   data-sanitize="phone">
                            <div class="form-error" id="aadharError"></div>
                        </div>
                        <div class="form-group">
                            <label>PAN Number</label>
                            <input type="text" class="form-control" name="pan" 
                                   data-rules="required|pan"
                                   data-format="pan">
                            <div class="form-error" id="panError"></div>
                        </div>
                        <div class="form-group">
                            <label>Date of Birth</label>
                            <input type="date" class="form-control" name="dob" 
                                   data-rules="required|validDOB">
                            <div class="form-error" id="dobError"></div>
                        </div>
                        <div class="form-group">
                            <label>PIN Code</label>
                            <input type="text" class="form-control" name="pincode" 
                                   data-rules="required|pincode"
                                   data-format="pincode"
                                   data-sanitize="phone">
                            <div class="form-error" id="pincodeError"></div>
                        </div>
                        <button type="submit" class="btn btn-primary">Test Member</button>
                        <button type="button" class="btn btn-info" onclick="fillTestData('memberTestForm')">Fill Test Data</button>
                    </form>
                    <div class="test-results" id="memberResults"></div>
                </div>

                <!-- Donation Form Test -->
                <div class="test-form">
                    <h3>Donation Form Validation</h3>
                    <form data-validate="true" id="donationTestForm">
                        <div class="form-group">
                            <label>Donor Name</label>
                            <input type="text" class="form-control" name="donor_name" 
                                   data-rules="required|alpha|minLength:2"
                                   data-sanitize="name">
                            <div class="form-error" id="donor_nameError"></div>
                        </div>
                        <div class="form-group">
                            <label>Amount</label>
                            <input type="number" class="form-control" name="amount" 
                                   data-rules="required|donationAmount"
                                   data-format="currency"
                                   step="0.01" min="1">
                            <div class="form-error" id="amountError"></div>
                        </div>
                        <div class="form-group">
                            <label>Purpose</label>
                            <select class="form-control" name="purpose" data-rules="required">
                                <option value="">Select Purpose</option>
                                <option value="general">General Fund</option>
                                <option value="legal_aid">Legal Aid</option>
                                <option value="awareness">Awareness Programs</option>
                                <option value="education">Education</option>
                            </select>
                            <div class="form-error" id="purposeError"></div>
                        </div>
                        <button type="submit" class="btn btn-primary">Test Donation</button>
                        <button type="button" class="btn btn-info" onclick="fillTestData('donationTestForm')">Fill Test Data</button>
                    </form>
                    <div class="test-results" id="donationResults"></div>
                </div>
            </div>
        </div>

        <!-- API Endpoint Tests -->
        <div class="test-section">
            <h2><i class="fas fa-network-wired"></i> API Endpoint Tests</h2>
            <div class="test-grid">
                <div class="test-form">
                    <h3>Authentication Endpoints</h3>
                    <div class="api-test">
                        <span class="method POST">POST</span>
                        <span class="endpoint">/api/auth/login</span>
                        <button class="btn btn-primary btn-sm" onclick="testAPI('POST', '/api/auth/login', {email: 'test@example.com', password: 'password123'})">Test</button>
                        <span class="status-indicator" id="status-auth-login"></span>
                    </div>
                    <div class="api-test">
                        <span class="method POST">POST</span>
                        <span class="endpoint">/api/auth/send-otp</span>
                        <button class="btn btn-primary btn-sm" onclick="testAPI('POST', '/api/auth/send-otp', {phone: '+919876543210'})">Test</button>
                        <span class="status-indicator" id="status-auth-otp"></span>
                    </div>
                    <div class="api-test">
                        <span class="method POST">POST</span>
                        <span class="endpoint">/api/auth/verify-otp</span>
                        <button class="btn btn-primary btn-sm" onclick="testAPI('POST', '/api/auth/verify-otp', {phone: '+919876543210', otp: '123456'})">Test</button>
                        <span class="status-indicator" id="status-auth-verify"></span>
                    </div>
                    <div class="test-results" id="authResults"></div>
                </div>

                <div class="test-form">
                    <h3>Complaint Endpoints</h3>
                    <div class="api-test">
                        <span class="method GET">GET</span>
                        <span class="endpoint">/api/complaints</span>
                        <button class="btn btn-success btn-sm" onclick="testAPI('GET', '/api/complaints')">Test</button>
                        <span class="status-indicator" id="status-complaints-get"></span>
                    </div>
                    <div class="api-test">
                        <span class="method POST">POST</span>
                        <span class="endpoint">/api/complaints</span>
                        <button class="btn btn-primary btn-sm" onclick="testAPI('POST', '/api/complaints', {complainant_name: 'Test User', category: 'other', description: 'Test complaint'})">Test</button>
                        <span class="status-indicator" id="status-complaints-post"></span>
                    </div>
                    <div class="test-results" id="complaintApiResults"></div>
                </div>

                <div class="test-form">
                    <h3>Event Endpoints</h3>
                    <div class="api-test">
                        <span class="method GET">GET</span>
                        <span class="endpoint">/api/events</span>
                        <button class="btn btn-success btn-sm" onclick="testAPI('GET', '/api/events')">Test</button>
                        <span class="status-indicator" id="status-events-get"></span>
                    </div>
                    <div class="api-test">
                        <span class="method POST">POST</span>
                        <span class="endpoint">/api/events</span>
                        <button class="btn btn-primary btn-sm" onclick="testAPI('POST', '/api/events', {title: 'Test Event', type: 'workshop', date: '2024-12-31'})">Test</button>
                        <span class="status-indicator" id="status-events-post"></span>
                    </div>
                    <div class="test-results" id="eventApiResults"></div>
                </div>

                <div class="test-form">
                    <h3>Member Endpoints</h3>
                    <div class="api-test">
                        <span class="method GET">GET</span>
                        <span class="endpoint">/api/members</span>
                        <button class="btn btn-success btn-sm" onclick="testAPI('GET', '/api/members')">Test</button>
                        <span class="status-indicator" id="status-members-get"></span>
                    </div>
                    <div class="api-test">
                        <span class="method POST">POST</span>
                        <span class="endpoint">/api/members</span>
                        <button class="btn btn-primary btn-sm" onclick="testAPI('POST', '/api/members', {name: 'Test Member', email: 'member@test.com', phone: '9876543210'})">Test</button>
                        <span class="status-indicator" id="status-members-post"></span>
                    </div>
                    <div class="test-results" id="memberApiResults"></div>
                </div>
            </div>
        </div>

        <!-- Database Connection Test -->
        <div class="test-section">
            <h2><i class="fas fa-database"></i> Database & Configuration Tests</h2>
            <div class="test-grid">
                <div class="test-form">
                    <h3>Database Connection</h3>
                    <button class="btn btn-primary" onclick="testDatabase()">Test Database Connection</button>
                    <button class="btn btn-info" onclick="testDatabaseTables()">Test Table Creation</button>
                    <button class="btn btn-success" onclick="testSampleData()">Insert Sample Data</button>
                    <div class="test-results" id="databaseResults"></div>
                </div>

                <div class="test-form">
                    <h3>Configuration Tests</h3>
                    <button class="btn btn-primary" onclick="testConfig()">Test Configuration</button>
                    <button class="btn btn-info" onclick="testDirectories()">Test Directory Structure</button>
                    <button class="btn btn-success" onclick="testPermissions()">Test File Permissions</button>
                    <div class="test-results" id="configResults"></div>
                </div>
            </div>
        </div>

        <!-- System Status -->
        <div class="test-section">
            <h2><i class="fas fa-heartbeat"></i> System Status</h2>
            <div class="test-grid">
                <div class="test-form">
                    <h3>Overall System Health</h3>
                    <button class="btn btn-success" onclick="runAllTests()">Run All Tests</button>
                    <button class="btn btn-danger" onclick="clearAllResults()">Clear Results</button>
                    <div class="test-results" id="systemStatus"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Scripts -->
    <script src="assets/js/validation.js"></script>
    <script src="assets/js/auth.js"></script>
    <script>
        // Test data for forms
        const testData = {
            registrationTestForm: {
                name: 'John Doe',
                email: 'john.doe@example.com',
                phone: '9876543210',
                password: 'SecurePass123!'
            },
            complaintTestForm: {
                complainant_name: 'Jane Smith',
                category: 'human_rights_violation',
                description: 'This is a test complaint description with sufficient length to pass validation.',
                incident_date: '2024-01-15'
            },
            memberTestForm: {
                aadhar: '123456789012',
                pan: 'ABCDE1234F',
                dob: '1990-01-01',
                pincode: '110001'
            },
            donationTestForm: {
                donor_name: 'Robert Johnson',
                amount: '1000',
                purpose: 'legal_aid'
            }
        };

        // Fill test data function
        function fillTestData(formId) {
            const form = document.getElementById(formId);
            const data = testData[formId];
            
            if (form && data) {
                Object.keys(data).forEach(key => {
                    const input = form.querySelector(`[name="${key}"]`);
                    if (input) {
                        input.value = data[key];
                        // Trigger input event for formatting
                        input.dispatchEvent(new Event('input'));
                    }
                });
                logResult(formId.replace('TestForm', 'Results'), 'Test data filled successfully', 'success');
            }
        }

        // API testing function
        async function testAPI(method, endpoint, data = null) {
            const resultId = endpoint.replace(/[^a-zA-Z0-9]/g, '-');
            const statusId = 'status-' + endpoint.replace('/api/', '').replace(/[^a-zA-Z0-9]/g, '-');
            
            try {
                const config = {
                    method,
                    headers: {
                        'Content-Type': 'application/json'
                    }
                };

                if (data && method !== 'GET') {
                    config.body = JSON.stringify(data);
                }

                logResult('systemStatus', `Testing ${method} ${endpoint}...`, 'info');
                
                const response = await fetch(endpoint, config);
                const result = await response.json();
                
                if (response.ok) {
                    updateStatus(statusId, 'success');
                    logResult('systemStatus', `âœ“ ${method} ${endpoint}: ${response.status}`, 'success');
                } else {
                    updateStatus(statusId, 'error');
                    logResult('systemStatus', `âœ— ${method} ${endpoint}: ${response.status} - ${result.message || 'Error'}`, 'error');
                }
            } catch (error) {
                updateStatus(statusId, 'error');
                logResult('systemStatus', `âœ— ${method} ${endpoint}: ${error.message}`, 'error');
            }
        }

        // Database testing functions
        async function testDatabase() {
            logResult('databaseResults', 'Testing database connection...', 'info');
            try {
                const response = await fetch(window.BHRC_CONFIG ? window.BHRC_CONFIG.API.BASE_URL + ''.replace('/api', '') : 'https://bhrcdata.online/backend/api'.replace('/api', '')));
                const result = await response.json();
                
                if (result.success) {
                    logResult('databaseResults', 'âœ“ Database connection successful', 'success');
                } else {
                    logResult('databaseResults', 'âœ— Database connection failed: ' + result.message, 'error');
                }
            } catch (error) {
                logResult('databaseResults', 'âœ— Database test failed: ' + error.message, 'error');
            }
        }

        async function testDatabaseTables() {
            logResult('databaseResults', 'Testing table creation...', 'info');
            try {
                const response = await fetch(window.BHRC_CONFIG ? window.BHRC_CONFIG.API.BASE_URL + ''.replace('/api', '') : 'https://bhrcdata.online/backend/api'.replace('/api', '')));
                const result = await response.json();
                
                if (result.success) {
                    logResult('databaseResults', 'âœ“ All tables created successfully', 'success');
                } else {
                    logResult('databaseResults', 'âœ— Table creation failed: ' + result.message, 'error');
                }
            } catch (error) {
                logResult('databaseResults', 'âœ— Table test failed: ' + error.message, 'error');
            }
        }

        async function testSampleData() {
            logResult('databaseResults', 'Inserting sample data...', 'info');
            try {
                const response = await fetch(window.BHRC_CONFIG ? window.BHRC_CONFIG.API.BASE_URL + ''.replace('/api', '') : 'https://bhrcdata.online/backend/api'.replace('/api', '')), { method: 'POST' });
                const result = await response.json();
                
                if (result.success) {
                    logResult('databaseResults', 'âœ“ Sample data inserted successfully', 'success');
                } else {
                    logResult('databaseResults', 'âœ— Sample data insertion failed: ' + result.message, 'error');
                }
            } catch (error) {
                logResult('databaseResults', 'âœ— Sample data test failed: ' + error.message, 'error');
            }
        }

        // Configuration testing functions
        async function testConfig() {
            logResult('configResults', 'Testing configuration...', 'info');
            try {
                const response = await fetch(window.BHRC_CONFIG ? window.BHRC_CONFIG.API.BASE_URL + ''.replace('/api', '') : 'https://bhrcdata.online/backend/api'.replace('/api', '')));
                const result = await response.json();
                
                if (result.success) {
                    logResult('configResults', 'âœ“ Configuration loaded successfully', 'success');
                    logResult('configResults', `Environment: ${result.environment}`, 'info');
                    logResult('configResults', `Debug Mode: ${result.debug ? 'ON' : 'OFF'}`, 'info');
                } else {
                    logResult('configResults', 'âœ— Configuration test failed: ' + result.message, 'error');
                }
            } catch (error) {
                logResult('configResults', 'âœ— Configuration test failed: ' + error.message, 'error');
            }
        }

        async function testDirectories() {
            logResult('configResults', 'Testing directory structure...', 'info');
            try {
                const response = await fetch(window.BHRC_CONFIG ? window.BHRC_CONFIG.API.BASE_URL + ''.replace('/api', '') : 'https://bhrcdata.online/backend/api'.replace('/api', '')));
                const result = await response.json();
                
                if (result.success) {
                    logResult('configResults', 'âœ“ All directories exist and are writable', 'success');
                } else {
                    logResult('configResults', 'âœ— Directory test failed: ' + result.message, 'error');
                }
            } catch (error) {
                logResult('configResults', 'âœ— Directory test failed: ' + error.message, 'error');
            }
        }

        async function testPermissions() {
            logResult('configResults', 'Testing file permissions...', 'info');
            try {
                const response = await fetch(window.BHRC_CONFIG ? window.BHRC_CONFIG.API.BASE_URL + ''.replace('/api', '') : 'https://bhrcdata.online/backend/api'.replace('/api', '')));
                const result = await response.json();
                
                if (result.success) {
                    logResult('configResults', 'âœ“ File permissions are correct', 'success');
                } else {
                    logResult('configResults', 'âœ— Permission test failed: ' + result.message, 'error');
                }
            } catch (error) {
                logResult('configResults', 'âœ— Permission test failed: ' + error.message, 'error');
            }
        }

        // Run all tests
        async function runAllTests() {
            logResult('systemStatus', 'Starting comprehensive system test...', 'info');
            
            // Test database
            await testDatabase();
            await testDatabaseTables();
            
            // Test configuration
            await testConfig();
            await testDirectories();
            
            // Test API endpoints
            await testAPI('GET', '/api/complaints');
            await testAPI('GET', '/api/events');
            await testAPI('GET', '/api/members');
            await testAPI('GET', '/api/gallery');
            
            logResult('systemStatus', 'All tests completed!', 'success');
        }

        // Clear all results
        function clearAllResults() {
            document.querySelectorAll('.test-results').forEach(result => {
                result.innerHTML = '';
            });
            document.querySelectorAll('.status-indicator').forEach(status => {
                status.className = 'status-indicator';
            });
        }

        // Update status indicator
        function updateStatus(statusId, status) {
            const indicator = document.getElementById(statusId);
            if (indicator) {
                indicator.className = `status-indicator status-${status}`;
            }
        }

        // Log result function
        function logResult(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            if (container) {
                const timestamp = new Date().toLocaleTimeString();
                const logEntry = document.createElement('div');
                logEntry.innerHTML = `<span style="color: #666;">[${timestamp}]</span> <span style="color: ${getLogColor(type)};">${message}</span>`;
                container.appendChild(logEntry);
                container.scrollTop = container.scrollHeight;
            }
        }

        // Get log color based on type
        function getLogColor(type) {
            const colors = {
                'success': '#28a745',
                'error': '#dc3545',
                'warning': '#ffc107',
                'info': '#17a2b8'
            };
            return colors[type] || '#6c757d';
        }

        // Form submission handlers
        document.addEventListener('DOMContentLoaded', function() {
            // Handle form submissions for testing
            document.querySelectorAll('form[data-validate]').forEach(form => {
                form.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const formId = this.id;
                    const resultsId = formId.replace('TestForm', 'Results');
                    
                    logResult(resultsId, 'Validating form...', 'info');
                    
                    if (formValidator.validateForm(this)) {
                        const formData = formValidator.getFormData(this);
                        logResult(resultsId, 'âœ“ Form validation passed', 'success');
                        logResult(resultsId, 'Form data: ' + JSON.stringify(formData.data, null, 2), 'info');
                    } else {
                        logResult(resultsId, 'âœ— Form validation failed', 'error');
                    }
                });
            });
        });
    </script>

    <!-- Back to Top Button -->
    <button class="back-to-top" id="backToTop" aria-label="Back to top">
        <i class="fas fa-chevron-up"></i>
    </button>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/common.js"></script>
</body>
</html>



