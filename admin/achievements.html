<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Achievements Management - BHRC Admin</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/css/admin.css" rel="stylesheet">
    <style>
        .achievement-card {
            border: 1px solid #dee2e6;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .achievement-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }
        .achievement-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #007bff, #28a745, #ffc107, #dc3545);
        }
        .achievement-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .achievement-icon.award { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .achievement-icon.certificate { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .achievement-icon.recognition { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .achievement-icon.milestone { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
        
        .achievement-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .achievement-date {
            color: #6c757d;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .achievement-category {
            padding: 6px 15px;
            border-radius: 25px;
            font-size: 0.8em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .category-award { background: #fff3cd; color: #856404; }
        .category-certificate { background: #d1ecf1; color: #0c5460; }
        .category-recognition { background: #d4edda; color: #155724; }
        .category-milestone { background: #f8d7da; color: #721c24; }
        
        .achievement-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .stat-item {
            text-align: center;
            padding: 15px;
            background: rgba(0,123,255,0.1);
            border-radius: 10px;
        }
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #007bff;
        }
        .stat-label {
            font-size: 0.8rem;
            color: #6c757d;
            text-transform: uppercase;
        }
        
        .timeline-view {
            position: relative;
            padding-left: 30px;
        }
        .timeline-view::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, #007bff, #28a745);
        }
        .timeline-item {
            position: relative;
            margin-bottom: 30px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -37px;
            top: 20px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #007bff;
            border: 3px solid white;
            box-shadow: 0 0 0 3px #007bff;
        }
        
        .filter-tabs {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .view-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .view-btn {
            padding: 8px 16px;
            border: 2px solid #dee2e6;
            background: white;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .view-btn.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }
    </style>
</head>
<body>
    <div class="admin-wrapper">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <img src="../../images/logo-light.png" alt="BHRC" class="sidebar-logo">
                <h4>BHRC Admin</h4>
            </div>
            <nav class="sidebar-nav">
                <a href="dashboard.html" class="nav-link">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </a>
                <a href="complaints.html" class="nav-link">
                    <i class="fas fa-exclamation-triangle"></i> Complaints
                </a>
                <a href="events.html" class="nav-link">
                    <i class="fas fa-calendar-alt"></i> Events
                </a>
                <a href="activities.html" class="nav-link">
                    <i class="fas fa-tasks"></i> Activities
                </a>
                <a href="members.html" class="nav-link">
                    <i class="fas fa-users"></i> Members
                </a>
                <a href="donations.html" class="nav-link">
                    <i class="fas fa-heart"></i> Donations
                </a>
                <a href="gallery.html" class="nav-link">
                    <i class="fas fa-images"></i> Gallery
                </a>
                <a href="achievements.html" class="nav-link active">
                    <i class="fas fa-trophy"></i> Achievements
                </a>
                <a href="newsletter.html" class="nav-link">
                    <i class="fas fa-newspaper"></i> Newsletter
                </a>
                <a href="testimonials.html" class="nav-link">
                    <i class="fas fa-quote-left"></i> Testimonials
                </a>
                <a href="pages.html" class="nav-link">
                    <i class="fas fa-file-alt"></i> Pages
                </a>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <header class="admin-header">
                <div class="header-left">
                    <button class="sidebar-toggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1>Achievements Management</h1>
                </div>
                <div class="header-right">
                    <div class="header-actions">
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addAchievementModal">
                            <i class="fas fa-plus"></i> Add Achievement
                        </button>
                        <div class="user-menu dropdown">
                            <button class="user-avatar dropdown-toggle" data-bs-toggle="dropdown">
                                <img src="../../images/default-avatar.png" alt="User">
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#"><i class="fas fa-user"></i> Profile</a></li>
                                <li><a class="dropdown-item" href="#"><i class="fas fa-cog"></i> Settings</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Content Area -->
            <div class="content-area">
                <!-- Statistics Overview -->
                <div class="achievement-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="totalAchievements">0</div>
                        <div class="stat-label">Total Achievements</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="awardsCount">0</div>
                        <div class="stat-label">Awards</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="certificatesCount">0</div>
                        <div class="stat-label">Certificates</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="recognitionsCount">0</div>
                        <div class="stat-label">Recognitions</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="milestonesCount">0</div>
                        <div class="stat-label">Milestones</div>
                    </div>
                </div>

                <!-- Filters and View Toggle -->
                <div class="filter-tabs">
                    <div class="view-toggle">
                        <button class="view-btn active" onclick="switchView('grid')" id="gridViewBtn">
                            <i class="fas fa-th-large"></i> Grid View
                        </button>
                        <button class="view-btn" onclick="switchView('timeline')" id="timelineViewBtn">
                            <i class="fas fa-stream"></i> Timeline View
                        </button>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-3">
                            <label class="form-label">Category</label>
                            <select class="form-select" id="categoryFilter">
                                <option value="">All Categories</option>
                                <option value="award">Awards</option>
                                <option value="certificate">Certificates</option>
                                <option value="recognition">Recognitions</option>
                                <option value="milestone">Milestones</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Year</label>
                            <select class="form-select" id="yearFilter">
                                <option value="">All Years</option>
                                <!-- Years will be populated dynamically -->
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Search</label>
                            <input type="text" class="form-control" id="searchInput" placeholder="Search achievements...">
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">&nbsp;</label>
                            <button class="btn btn-outline-secondary w-100" onclick="clearFilters()">
                                <i class="fas fa-times"></i> Clear
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Achievements Display -->
                <div id="achievementsContainer">
                    <!-- Grid View -->
                    <div id="gridView" class="row">
                        <!-- Achievements will be loaded here -->
                    </div>
                    
                    <!-- Timeline View -->
                    <div id="timelineView" class="timeline-view" style="display: none;">
                        <!-- Timeline achievements will be loaded here -->
                    </div>
                </div>

                <!-- Pagination -->
                <nav aria-label="Achievements pagination">
                    <ul class="pagination justify-content-center" id="pagination">
                        <!-- Pagination will be generated here -->
                    </ul>
                </nav>
            </div>
        </div>
    </div>

    <!-- Add Achievement Modal -->
    <div class="modal fade" id="addAchievementModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Achievement</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addAchievementForm" data-validate="true">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Title *</label>
                                    <input type="text" class="form-control" name="title" 
                                           data-rules="required|minLength:3|maxLength:200" required>
                                    <div class="form-error" id="titleError"></div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Category *</label>
                                    <select class="form-select" name="category" data-rules="required" required>
                                        <option value="">Select Category</option>
                                        <option value="award">Award</option>
                                        <option value="certificate">Certificate</option>
                                        <option value="recognition">Recognition</option>
                                        <option value="milestone">Milestone</option>
                                    </select>
                                    <div class="form-error" id="categoryError"></div>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Description *</label>
                            <textarea class="form-control" name="description" rows="4" 
                                      data-rules="required|minLength:10|maxLength:1000" required></textarea>
                            <div class="form-error" id="descriptionError"></div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Date Achieved *</label>
                                    <input type="date" class="form-control" name="date_achieved" 
                                           data-rules="required|date" required>
                                    <div class="form-error" id="date_achievedError"></div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Awarded By</label>
                                    <input type="text" class="form-control" name="awarded_by" 
                                           data-rules="maxLength:200">
                                    <div class="form-error" id="awarded_byError"></div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Location</label>
                                    <input type="text" class="form-control" name="location" 
                                           data-rules="maxLength:200">
                                    <div class="form-error" id="locationError"></div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Impact Score (1-10)</label>
                                    <input type="number" class="form-control" name="impact_score" 
                                           min="1" max="10" data-rules="numeric|min:1|max:10">
                                    <div class="form-error" id="impact_scoreError"></div>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Achievement Image</label>
                            <input type="file" class="form-control" name="image" 
                                   accept="image/*" data-rules="file|fileSize:5MB|fileType:image">
                            <div class="form-error" id="imageError"></div>
                            <small class="form-text text-muted">Maximum file size: 5MB. Supported formats: JPG, PNG, GIF</small>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Certificate/Document</label>
                            <input type="file" class="form-control" name="document" 
                                   accept=".pdf,.doc,.docx" data-rules="file|fileSize:10MB">
                            <div class="form-error" id="documentError"></div>
                            <small class="form-text text-muted">Upload certificate or related document (PDF, DOC, DOCX - Max 10MB)</small>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Related URL</label>
                            <input type="url" class="form-control" name="related_url" 
                                   data-rules="url" placeholder="https://example.com">
                            <div class="form-error" id="related_urlError"></div>
                            <small class="form-text text-muted">Link to news article, press release, or related content</small>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Tags</label>
                            <input type="text" class="form-control" name="tags" 
                                   placeholder="human rights, legal aid, community service">
                            <small class="form-text text-muted">Separate tags with commas</small>
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="is_featured" id="isFeatured">
                                <label class="form-check-label" for="isFeatured">
                                    Feature this achievement on homepage
                                </label>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveAchievement()">Save Achievement</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Achievement Modal -->
    <div class="modal fade" id="editAchievementModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Achievement</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editAchievementForm" data-validate="true">
                        <input type="hidden" name="id" id="editAchievementId">
                        <!-- Same form fields as add modal -->
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Title *</label>
                                    <input type="text" class="form-control" name="title" 
                                           data-rules="required|minLength:3|maxLength:200" required>
                                    <div class="form-error" id="editTitleError"></div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Category *</label>
                                    <select class="form-select" name="category" data-rules="required" required>
                                        <option value="">Select Category</option>
                                        <option value="award">Award</option>
                                        <option value="certificate">Certificate</option>
                                        <option value="recognition">Recognition</option>
                                        <option value="milestone">Milestone</option>
                                    </select>
                                    <div class="form-error" id="editCategoryError"></div>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Description *</label>
                            <textarea class="form-control" name="description" rows="4" 
                                      data-rules="required|minLength:10|maxLength:1000" required></textarea>
                            <div class="form-error" id="editDescriptionError"></div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Date Achieved *</label>
                                    <input type="date" class="form-control" name="date_achieved" 
                                           data-rules="required|date" required>
                                    <div class="form-error" id="editDate_achievedError"></div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Awarded By</label>
                                    <input type="text" class="form-control" name="awarded_by" 
                                           data-rules="maxLength:200">
                                    <div class="form-error" id="editAwarded_byError"></div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Location</label>
                                    <input type="text" class="form-control" name="location" 
                                           data-rules="maxLength:200">
                                    <div class="form-error" id="editLocationError"></div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Impact Score (1-10)</label>
                                    <input type="number" class="form-control" name="impact_score" 
                                           min="1" max="10" data-rules="numeric|min:1|max:10">
                                    <div class="form-error" id="editImpact_scoreError"></div>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Achievement Image</label>
                            <input type="file" class="form-control" name="image" 
                                   accept="image/*" data-rules="file|fileSize:5MB|fileType:image">
                            <div class="form-error" id="editImageError"></div>
                            <small class="form-text text-muted">Leave empty to keep current image</small>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Certificate/Document</label>
                            <input type="file" class="form-control" name="document" 
                                   accept=".pdf,.doc,.docx" data-rules="file|fileSize:10MB">
                            <div class="form-error" id="editDocumentError"></div>
                            <small class="form-text text-muted">Leave empty to keep current document</small>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Related URL</label>
                            <input type="url" class="form-control" name="related_url" 
                                   data-rules="url" placeholder="https://example.com">
                            <div class="form-error" id="editRelated_urlError"></div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Tags</label>
                            <input type="text" class="form-control" name="tags" 
                                   placeholder="human rights, legal aid, community service">
                            <small class="form-text text-muted">Separate tags with commas</small>
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="is_featured" id="editIsFeatured">
                                <label class="form-check-label" for="editIsFeatured">
                                    Feature this achievement on homepage
                                </label>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="updateAchievement()">Update Achievement</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container position-fixed top-0 end-0 p-3"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/validation.js"></script>
    <script src="assets/js/admin.js"></script>
    <script>
        class AchievementsManager {
            constructor() {
                this.currentPage = 1;
                this.itemsPerPage = 12;
                this.achievements = [];
                this.filteredAchievements = [];
                this.currentView = 'grid';
                this.init();
            }

            init() {
                this.loadAchievements();
                this.loadStatistics();
                this.setupEventListeners();
                this.setupFormValidation();
                this.populateYearFilter();
            }

            setupEventListeners() {
                // Filter change events
                document.getElementById('categoryFilter').addEventListener('change', () => this.applyFilters());
                document.getElementById('yearFilter').addEventListener('change', () => this.applyFilters());
                
                // Search input
                document.getElementById('searchInput').addEventListener('input', 
                    this.debounce(() => this.applyFilters(), 300));
            }

            setupFormValidation() {
                if (typeof FormValidator !== 'undefined') {
                    this.formValidator = new FormValidator();
                    this.formValidator.initializeForm(document.getElementById('addAchievementForm'));
                    this.formValidator.initializeForm(document.getElementById('editAchievementForm'));
                }
            }

            populateYearFilter() {
                const yearFilter = document.getElementById('yearFilter');
                const currentYear = new Date().getFullYear();
                const startYear = 2000; // Adjust as needed
                
                for (let year = currentYear; year >= startYear; year--) {
                    const option = document.createElement('option');
                    option.value = year;
                    option.textContent = year;
                    yearFilter.appendChild(option);
                }
            }

            async loadAchievements() {
                try {
                    const response = await fetch(window.BHRC_CONFIG ? window.BHRC_CONFIG.API.BASE_URL + ''.replace('/api', '') : 'https://bhrcdata.online/backend/api'.replace('/api', '')));
                    const result = await response.json();
                    
                    if (result.success) {
                        this.achievements = result.data;
                        this.filteredAchievements = [...this.achievements];
                        this.renderAchievements();
                        this.renderPagination();
                    } else {
                        this.showToast('Error loading achievements: ' + result.message, 'error');
                    }
                } catch (error) {
                    this.showToast('Error loading achievements: ' + error.message, 'error');
                }
            }

            async loadStatistics() {
                try {
                    const response = await fetch(window.BHRC_CONFIG ? window.BHRC_CONFIG.API.BASE_URL + ''.replace('/api', '') : 'https://bhrcdata.online/backend/api'.replace('/api', '')));
                    const result = await response.json();
                    
                    if (result.success) {
                        const stats = result.data;
                        document.getElementById('totalAchievements').textContent = stats.total || 0;
                        document.getElementById('awardsCount').textContent = stats.awards || 0;
                        document.getElementById('certificatesCount').textContent = stats.certificates || 0;
                        document.getElementById('recognitionsCount').textContent = stats.recognitions || 0;
                        document.getElementById('milestonesCount').textContent = stats.milestones || 0;
                    }
                } catch (error) {
                    console.error('Error loading statistics:', error);
                }
            }

            renderAchievements() {
                if (this.currentView === 'grid') {
                    this.renderGridView();
                } else {
                    this.renderTimelineView();
                }
            }

            renderGridView() {
                const container = document.getElementById('gridView');
                const startIndex = (this.currentPage - 1) * this.itemsPerPage;
                const endIndex = startIndex + this.itemsPerPage;
                const pageAchievements = this.filteredAchievements.slice(startIndex, endIndex);

                if (pageAchievements.length === 0) {
                    container.innerHTML = `
                        <div class="col-12">
                            <div class="text-center py-5">
                                <i class="fas fa-trophy fa-3x text-muted mb-3"></i>
                                <h5>No achievements found</h5>
                                <p class="text-muted">Try adjusting your filters or add a new achievement.</p>
                            </div>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = pageAchievements.map(achievement => `
                    <div class="col-md-6 col-lg-4">
                        <div class="achievement-card">
                            <div class="achievement-icon ${achievement.category}">
                                <i class="fas ${this.getCategoryIcon(achievement.category)}"></i>
                            </div>
                            <div class="achievement-meta">
                                <span class="achievement-date">
                                    <i class="fas fa-calendar"></i>
                                    ${this.formatDate(achievement.date_achieved)}
                                </span>
                                <span class="achievement-category category-${achievement.category}">
                                    ${this.capitalizeFirst(achievement.category)}
                                </span>
                            </div>
                            <h5>${achievement.title}</h5>
                            <p class="text-muted">${this.truncateText(achievement.description, 120)}</p>
                            
                            ${achievement.awarded_by ? `
                                <div class="mb-2">
                                    <small class="text-muted">
                                        <i class="fas fa-award"></i> Awarded by: ${achievement.awarded_by}
                                    </small>
                                </div>
                            ` : ''}
                            
                            ${achievement.location ? `
                                <div class="mb-2">
                                    <small class="text-muted">
                                        <i class="fas fa-map-marker-alt"></i> ${achievement.location}
                                    </small>
                                </div>
                            ` : ''}
                            
                            ${achievement.impact_score ? `
                                <div class="mb-3">
                                    <small class="text-muted">Impact Score: </small>
                                    <div class="d-inline-block">
                                        ${this.renderStars(achievement.impact_score)}
                                    </div>
                                </div>
                            ` : ''}
                            
                            <div class="achievement-actions mt-3">
                                <button class="btn btn-sm btn-outline-primary" onclick="achievementsManager.viewAchievement(${achievement.id})">
                                    <i class="fas fa-eye"></i> View
                                </button>
                                <button class="btn btn-sm btn-outline-secondary" onclick="achievementsManager.editAchievement(${achievement.id})">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="achievementsManager.deleteAchievement(${achievement.id})">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                                ${achievement.is_featured ? '<span class="badge bg-warning ms-2">Featured</span>' : ''}
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            renderTimelineView() {
                const container = document.getElementById('timelineView');
                const sortedAchievements = [...this.filteredAchievements].sort((a, b) => 
                    new Date(b.date_achieved) - new Date(a.date_achieved)
                );

                if (sortedAchievements.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-5">
                            <i class="fas fa-trophy fa-3x text-muted mb-3"></i>
                            <h5>No achievements found</h5>
                            <p class="text-muted">Try adjusting your filters or add a new achievement.</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = sortedAchievements.map(achievement => `
                    <div class="timeline-item">
                        <div class="d-flex align-items-start">
                            <div class="achievement-icon ${achievement.category} me-3" style="width: 60px; height: 60px; font-size: 1.5rem;">
                                <i class="fas ${this.getCategoryIcon(achievement.category)}"></i>
                            </div>
                            <div class="flex-grow-1">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <h5 class="mb-1">${achievement.title}</h5>
                                    <span class="achievement-category category-${achievement.category}">
                                        ${this.capitalizeFirst(achievement.category)}
                                    </span>
                                </div>
                                <p class="text-muted mb-2">${achievement.description}</p>
                                <div class="row">
                                    <div class="col-md-6">
                                        <small class="text-muted">
                                            <i class="fas fa-calendar"></i> ${this.formatDate(achievement.date_achieved)}
                                        </small>
                                        ${achievement.awarded_by ? `<br><small class="text-muted"><i class="fas fa-award"></i> ${achievement.awarded_by}</small>` : ''}
                                    </div>
                                    <div class="col-md-6">
                                        ${achievement.location ? `<small class="text-muted"><i class="fas fa-map-marker-alt"></i> ${achievement.location}</small><br>` : ''}
                                        ${achievement.impact_score ? `<small class="text-muted">Impact: ${this.renderStars(achievement.impact_score)}</small>` : ''}
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <button class="btn btn-sm btn-outline-primary me-2" onclick="achievementsManager.viewAchievement(${achievement.id})">
                                        <i class="fas fa-eye"></i> View
                                    </button>
                                    <button class="btn btn-sm btn-outline-secondary me-2" onclick="achievementsManager.editAchievement(${achievement.id})">
                                        <i class="fas fa-edit"></i> Edit
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger" onclick="achievementsManager.deleteAchievement(${achievement.id})">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                    ${achievement.is_featured ? '<span class="badge bg-warning ms-2">Featured</span>' : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            renderPagination() {
                if (this.currentView === 'timeline') {
                    document.getElementById('pagination').innerHTML = '';
                    return;
                }

                const totalPages = Math.ceil(this.filteredAchievements.length / this.itemsPerPage);
                const pagination = document.getElementById('pagination');
                
                if (totalPages <= 1) {
                    pagination.innerHTML = '';
                    return;
                }

                let paginationHTML = '';
                
                // Previous button
                paginationHTML += `
                    <li class="page-item ${this.currentPage === 1 ? 'disabled' : ''}">
                        <a class="page-link" href="#" onclick="achievementsManager.changePage(${this.currentPage - 1})">Previous</a>
                    </li>
                `;
                
                // Page numbers
                for (let i = 1; i <= totalPages; i++) {
                    if (i === 1 || i === totalPages || (i >= this.currentPage - 2 && i <= this.currentPage + 2)) {
                        paginationHTML += `
                            <li class="page-item ${i === this.currentPage ? 'active' : ''}">
                                <a class="page-link" href="#" onclick="achievementsManager.changePage(${i})">${i}</a>
                            </li>
                        `;
                    } else if (i === this.currentPage - 3 || i === this.currentPage + 3) {
                        paginationHTML += '<li class="page-item disabled"><span class="page-link">...</span></li>';
                    }
                }
                
                // Next button
                paginationHTML += `
                    <li class="page-item ${this.currentPage === totalPages ? 'disabled' : ''}">
                        <a class="page-link" href="#" onclick="achievementsManager.changePage(${this.currentPage + 1})">Next</a>
                    </li>
                `;
                
                pagination.innerHTML = paginationHTML;
            }

            changePage(page) {
                const totalPages = Math.ceil(this.filteredAchievements.length / this.itemsPerPage);
                if (page >= 1 && page <= totalPages) {
                    this.currentPage = page;
                    this.renderAchievements();
                    this.renderPagination();
                    window.scrollTo(0, 0);
                }
            }

            switchView(view) {
                this.currentView = view;
                
                // Update button states
                document.getElementById('gridViewBtn').classList.toggle('active', view === 'grid');
                document.getElementById('timelineViewBtn').classList.toggle('active', view === 'timeline');
                
                // Show/hide views
                document.getElementById('gridView').style.display = view === 'grid' ? 'block' : 'none';
                document.getElementById('timelineView').style.display = view === 'timeline' ? 'block' : 'none';
                
                this.renderAchievements();
                this.renderPagination();
            }

            applyFilters() {
                const categoryFilter = document.getElementById('categoryFilter').value;
                const yearFilter = document.getElementById('yearFilter').value;
                const searchTerm = document.getElementById('searchInput').value.toLowerCase();

                this.filteredAchievements = this.achievements.filter(achievement => {
                    // Category filter
                    if (categoryFilter && achievement.category !== categoryFilter) return false;
                    
                    // Year filter
                    if (yearFilter && new Date(achievement.date_achieved).getFullYear() != yearFilter) return false;
                    
                    // Search filter
                    if (searchTerm) {
                        const searchableText = `${achievement.title} ${achievement.description} ${achievement.awarded_by} ${achievement.location}`.toLowerCase();
                        if (!searchableText.includes(searchTerm)) return false;
                    }
                    
                    return true;
                });

                this.currentPage = 1;
                this.renderAchievements();
                this.renderPagination();
            }

            clearFilters() {
                document.getElementById('categoryFilter').value = '';
                document.getElementById('yearFilter').value = '';
                document.getElementById('searchInput').value = '';
                this.applyFilters();
            }

            async saveAchievement() {
                const form = document.getElementById('addAchievementForm');
                
                if (this.formValidator && !this.formValidator.validateForm(form)) {
                    return;
                }

                const formData = new FormData(form);
                
                try {
                    const response = await fetch(window.BHRC_CONFIG ? window.BHRC_CONFIG.API.BASE_URL + ''.replace('/api', '') : 'https://bhrcdata.online/backend/api'.replace('/api', '')), {
                        method: 'POST',
                        body: formData
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        this.showToast('Achievement created successfully!', 'success');
                        bootstrap.Modal.getInstance(document.getElementById('addAchievementModal')).hide();
                        form.reset();
                        this.loadAchievements();
                        this.loadStatistics();
                    } else {
                        this.showToast('Error creating achievement: ' + result.message, 'error');
                    }
                } catch (error) {
                    this.showToast('Error creating achievement: ' + error.message, 'error');
                }
            }

            async editAchievement(id) {
                try {
                    const response = await fetch(`/api/achievements/${id}`);
                    const result = await response.json();
                    
                    if (result.success) {
                        const achievement = result.data;
                        const form = document.getElementById('editAchievementForm');
                        
                        // Populate form fields
                        form.querySelector('[name="id"]').value = achievement.id;
                        form.querySelector('[name="title"]').value = achievement.title;
                        form.querySelector('[name="category"]').value = achievement.category;
                        form.querySelector('[name="description"]').value = achievement.description;
                        form.querySelector('[name="date_achieved"]').value = achievement.date_achieved;
                        form.querySelector('[name="awarded_by"]').value = achievement.awarded_by || '';
                        form.querySelector('[name="location"]').value = achievement.location || '';
                        form.querySelector('[name="impact_score"]').value = achievement.impact_score || '';
                        form.querySelector('[name="related_url"]').value = achievement.related_url || '';
                        form.querySelector('[name="tags"]').value = achievement.tags || '';
                        form.querySelector('[name="is_featured"]').checked = achievement.is_featured || false;
                        
                        bootstrap.Modal.getOrCreateInstance(document.getElementById('editAchievementModal')).show();
                    } else {
                        this.showToast('Error loading achievement: ' + result.message, 'error');
                    }
                } catch (error) {
                    this.showToast('Error loading achievement: ' + error.message, 'error');
                }
            }

            async updateAchievement() {
                const form = document.getElementById('editAchievementForm');
                
                if (this.formValidator && !this.formValidator.validateForm(form)) {
                    return;
                }

                const formData = new FormData(form);
                const id = formData.get('id');
                
                try {
                    const response = await fetch(`/api/achievements/${id}`, {
                        method: 'PUT',
                        body: formData
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        this.showToast('Achievement updated successfully!', 'success');
                        bootstrap.Modal.getInstance(document.getElementById('editAchievementModal')).hide();
                        this.loadAchievements();
                        this.loadStatistics();
                    } else {
                        this.showToast('Error updating achievement: ' + result.message, 'error');
                    }
                } catch (error) {
                    this.showToast('Error updating achievement: ' + error.message, 'error');
                }
            }

            async deleteAchievement(id) {
                if (!confirm('Are you sure you want to delete this achievement? This action cannot be undone.')) {
                    return;
                }

                try {
                    const response = await fetch(`/api/achievements/${id}`, {
                        method: 'DELETE'
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        this.showToast('Achievement deleted successfully!', 'success');
                        this.loadAchievements();
                        this.loadStatistics();
                    } else {
                        this.showToast('Error deleting achievement: ' + result.message, 'error');
                    }
                } catch (error) {
                    this.showToast('Error deleting achievement: ' + error.message, 'error');
                }
            }

            viewAchievement(id) {
                // Implement view achievement details
                window.open(`achievement-details.html?id=${id}`, '_blank');
            }

            // Utility methods
            getCategoryIcon(category) {
                const icons = {
                    award: 'fa-trophy',
                    certificate: 'fa-certificate',
                    recognition: 'fa-medal',
                    milestone: 'fa-flag-checkered'
                };
                return icons[category] || 'fa-star';
            }

            renderStars(score) {
                const fullStars = Math.floor(score);
                const halfStar = score % 1 >= 0.5;
                let starsHTML = '';
                
                for (let i = 0; i < fullStars; i++) {
                    starsHTML += '<i class="fas fa-star text-warning"></i>';
                }
                
                if (halfStar) {
                    starsHTML += '<i class="fas fa-star-half-alt text-warning"></i>';
                }
                
                const emptyStars = 10 - Math.ceil(score);
                for (let i = 0; i < emptyStars; i++) {
                    starsHTML += '<i class="far fa-star text-muted"></i>';
                }
                
                return starsHTML;
            }

            formatDate(dateString) {
                return new Date(dateString).toLocaleDateString('en-IN', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            }

            capitalizeFirst(str) {
                return str.charAt(0).toUpperCase() + str.slice(1);
            }

            truncateText(text, maxLength) {
                return text.length > maxLength ? text.substring(0, maxLength) + '...' : text;
            }

            debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }

            showToast(message, type = 'info') {
                const toastContainer = document.getElementById('toastContainer');
                const toastId = 'toast-' + Date.now();
                
                const toastHTML = `
                    <div id="${toastId}" class="toast align-items-center text-white bg-${type === 'error' ? 'danger' : type === 'success' ? 'success' : 'primary'} border-0" role="alert">
                        <div class="d-flex">
                            <div class="toast-body">${message}</div>
                            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                        </div>
                    </div>
                `;
                
                toastContainer.insertAdjacentHTML('beforeend', toastHTML);
                const toast = new bootstrap.Toast(document.getElementById(toastId));
                toast.show();
                
                // Remove toast element after it's hidden
                document.getElementById(toastId).addEventListener('hidden.bs.toast', function() {
                    this.remove();
                });
            }
        }

        // Global functions
        function switchView(view) {
            achievementsManager.switchView(view);
        }

        function clearFilters() {
            achievementsManager.clearFilters();
        }

        function saveAchievement() {
            achievementsManager.saveAchievement();
        }

        function updateAchievement() {
            achievementsManager.updateAchievement();
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('authToken');
                window.location.href = '../login.html';
            }
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            window.achievementsManager = new AchievementsManager();
        });
    </script>
</body>
</html>


