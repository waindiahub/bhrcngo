<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Activities Management - BHRC Admin</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/css/admin.css" rel="stylesheet">
    <style>
        .activity-card {
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        .activity-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }
        .activity-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        .activity-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .activity-date {
            color: #6c757d;
            font-size: 0.9em;
        }
        .activity-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 500;
        }
        .status-active { background: #d4edda; color: #155724; }
        .status-completed { background: #cce5ff; color: #004085; }
        .status-cancelled { background: #f8d7da; color: #721c24; }
        .filter-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        .stat-card.success {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        .stat-card.warning {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }
        .stat-card.info {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            color: #333;
        }
        .impact-metrics {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .metric-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        .metric-item:last-child {
            border-bottom: none;
        }
        .metric-value {
            font-weight: bold;
            color: #007bff;
        }
    </style>
</head>
<body>
    <div class="admin-wrapper">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <img src="../../images/logo-light.png" alt="BHRC" class="sidebar-logo">
                <h4>BHRC Admin</h4>
            </div>
            <nav class="sidebar-nav">
                <a href="dashboard.html" class="nav-link">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </a>
                <a href="complaints.html" class="nav-link">
                    <i class="fas fa-exclamation-triangle"></i> Complaints
                </a>
                <a href="events.html" class="nav-link">
                    <i class="fas fa-calendar-alt"></i> Events
                </a>
                <a href="activities.html" class="nav-link active">
                    <i class="fas fa-tasks"></i> Activities
                </a>
                <a href="members.html" class="nav-link">
                    <i class="fas fa-users"></i> Members
                </a>
                <a href="donations.html" class="nav-link">
                    <i class="fas fa-heart"></i> Donations
                </a>
                <a href="gallery.html" class="nav-link">
                    <i class="fas fa-images"></i> Gallery
                </a>
                <a href="achievements.html" class="nav-link">
                    <i class="fas fa-trophy"></i> Achievements
                </a>
                <a href="newsletter.html" class="nav-link">
                    <i class="fas fa-newspaper"></i> Newsletter
                </a>
                <a href="testimonials.html" class="nav-link">
                    <i class="fas fa-quote-left"></i> Testimonials
                </a>
                <a href="pages.html" class="nav-link">
                    <i class="fas fa-file-alt"></i> Pages
                </a>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <header class="admin-header">
                <div class="header-left">
                    <button class="sidebar-toggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1>Activities Management</h1>
                </div>
                <div class="header-right">
                    <div class="header-actions">
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addActivityModal">
                            <i class="fas fa-plus"></i> Add Activity
                        </button>
                        <div class="user-menu dropdown">
                            <button class="user-avatar dropdown-toggle" data-bs-toggle="dropdown">
                                <img src="../../images/default-avatar.png" alt="User">
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#"><i class="fas fa-user"></i> Profile</a></li>
                                <li><a class="dropdown-item" href="#"><i class="fas fa-cog"></i> Settings</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Content Area -->
            <div class="content-area">
                <!-- Statistics Cards -->
                <div class="stats-cards">
                    <div class="stat-card">
                        <h3 id="totalActivities">0</h3>
                        <p>Total Activities</p>
                        <i class="fas fa-tasks"></i>
                    </div>
                    <div class="stat-card success">
                        <h3 id="activeActivities">0</h3>
                        <p>Active Activities</p>
                        <i class="fas fa-play"></i>
                    </div>
                    <div class="stat-card warning">
                        <h3 id="completedActivities">0</h3>
                        <p>Completed</p>
                        <i class="fas fa-check"></i>
                    </div>
                    <div class="stat-card info">
                        <h3 id="totalBeneficiaries">0</h3>
                        <p>Total Beneficiaries</p>
                        <i class="fas fa-users"></i>
                    </div>
                </div>

                <!-- Impact Metrics -->
                <div class="impact-metrics">
                    <h5><i class="fas fa-chart-line"></i> Impact Summary</h5>
                    <div id="impactMetrics">
                        <div class="metric-item">
                            <span>People Reached</span>
                            <span class="metric-value" id="peopleReached">0</span>
                        </div>
                        <div class="metric-item">
                            <span>Communities Served</span>
                            <span class="metric-value" id="communitiesServed">0</span>
                        </div>
                        <div class="metric-item">
                            <span>Legal Aid Cases</span>
                            <span class="metric-value" id="legalAidCases">0</span>
                        </div>
                        <div class="metric-item">
                            <span>Awareness Programs</span>
                            <span class="metric-value" id="awarenessPrograms">0</span>
                        </div>
                    </div>
                </div>

                <!-- Filters -->
                <div class="filter-section">
                    <div class="row">
                        <div class="col-md-3">
                            <label class="form-label">Status</label>
                            <select class="form-select" id="statusFilter">
                                <option value="">All Status</option>
                                <option value="active">Active</option>
                                <option value="completed">Completed</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Type</label>
                            <select class="form-select" id="typeFilter">
                                <option value="">All Types</option>
                                <option value="legal_aid">Legal Aid</option>
                                <option value="awareness">Awareness</option>
                                <option value="education">Education</option>
                                <option value="community_service">Community Service</option>
                                <option value="research">Research</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Date Range</label>
                            <input type="date" class="form-control" id="dateFrom" placeholder="From">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">&nbsp;</label>
                            <input type="date" class="form-control" id="dateTo" placeholder="To">
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <input type="text" class="form-control" id="searchInput" placeholder="Search activities...">
                        </div>
                        <div class="col-md-6">
                            <button class="btn btn-primary" onclick="applyFilters()">
                                <i class="fas fa-search"></i> Search
                            </button>
                            <button class="btn btn-secondary ms-2" onclick="clearFilters()">
                                <i class="fas fa-times"></i> Clear
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Activities List -->
                <div class="row" id="activitiesList">
                    <!-- Activities will be loaded here -->
                </div>

                <!-- Pagination -->
                <nav aria-label="Activities pagination">
                    <ul class="pagination justify-content-center" id="pagination">
                        <!-- Pagination will be generated here -->
                    </ul>
                </nav>
            </div>
        </div>
    </div>

    <!-- Add Activity Modal -->
    <div class="modal fade" id="addActivityModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Activity</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addActivityForm" data-validate="true">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Title *</label>
                                    <input type="text" class="form-control" name="title" 
                                           data-rules="required|minLength:3|maxLength:200" required>
                                    <div class="form-error" id="titleError"></div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Type *</label>
                                    <select class="form-select" name="type" data-rules="required" required>
                                        <option value="">Select Type</option>
                                        <option value="legal_aid">Legal Aid</option>
                                        <option value="awareness">Awareness Program</option>
                                        <option value="education">Education</option>
                                        <option value="community_service">Community Service</option>
                                        <option value="research">Research</option>
                                    </select>
                                    <div class="form-error" id="typeError"></div>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Description *</label>
                            <textarea class="form-control" name="description" rows="4" 
                                      data-rules="required|minLength:10|maxLength:1000" required></textarea>
                            <div class="form-error" id="descriptionError"></div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Start Date *</label>
                                    <input type="date" class="form-control" name="start_date" 
                                           data-rules="required|date" required>
                                    <div class="form-error" id="start_dateError"></div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">End Date</label>
                                    <input type="date" class="form-control" name="end_date" 
                                           data-rules="date">
                                    <div class="form-error" id="end_dateError"></div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Location</label>
                                    <input type="text" class="form-control" name="location" 
                                           data-rules="maxLength:200">
                                    <div class="form-error" id="locationError"></div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Budget</label>
                                    <input type="number" class="form-control" name="budget" 
                                           step="0.01" min="0" data-rules="numeric">
                                    <div class="form-error" id="budgetError"></div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Target Beneficiaries</label>
                                    <input type="number" class="form-control" name="target_beneficiaries" 
                                           min="0" data-rules="numeric">
                                    <div class="form-error" id="target_beneficiariesError"></div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Status *</label>
                                    <select class="form-select" name="status" data-rules="required" required>
                                        <option value="active">Active</option>
                                        <option value="completed">Completed</option>
                                        <option value="cancelled">Cancelled</option>
                                    </select>
                                    <div class="form-error" id="statusError"></div>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Activity Image</label>
                            <input type="file" class="form-control" name="image" 
                                   accept="image/*" data-rules="file|fileSize:5MB|fileType:image">
                            <div class="form-error" id="imageError"></div>
                            <small class="form-text text-muted">Maximum file size: 5MB. Supported formats: JPG, PNG, GIF</small>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Impact Details (JSON)</label>
                            <textarea class="form-control" name="impact_details" rows="3" 
                                      placeholder='{"people_reached": 100, "communities_served": 5}'></textarea>
                            <small class="form-text text-muted">Enter impact metrics in JSON format</small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveActivity()">Save Activity</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Activity Modal -->
    <div class="modal fade" id="editActivityModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Activity</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editActivityForm" data-validate="true">
                        <input type="hidden" name="id" id="editActivityId">
                        <!-- Same form fields as add modal -->
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Title *</label>
                                    <input type="text" class="form-control" name="title" 
                                           data-rules="required|minLength:3|maxLength:200" required>
                                    <div class="form-error" id="editTitleError"></div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Type *</label>
                                    <select class="form-select" name="type" data-rules="required" required>
                                        <option value="">Select Type</option>
                                        <option value="legal_aid">Legal Aid</option>
                                        <option value="awareness">Awareness Program</option>
                                        <option value="education">Education</option>
                                        <option value="community_service">Community Service</option>
                                        <option value="research">Research</option>
                                    </select>
                                    <div class="form-error" id="editTypeError"></div>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Description *</label>
                            <textarea class="form-control" name="description" rows="4" 
                                      data-rules="required|minLength:10|maxLength:1000" required></textarea>
                            <div class="form-error" id="editDescriptionError"></div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Start Date *</label>
                                    <input type="date" class="form-control" name="start_date" 
                                           data-rules="required|date" required>
                                    <div class="form-error" id="editStart_dateError"></div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">End Date</label>
                                    <input type="date" class="form-control" name="end_date" 
                                           data-rules="date">
                                    <div class="form-error" id="editEnd_dateError"></div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Location</label>
                                    <input type="text" class="form-control" name="location" 
                                           data-rules="maxLength:200">
                                    <div class="form-error" id="editLocationError"></div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Budget</label>
                                    <input type="number" class="form-control" name="budget" 
                                           step="0.01" min="0" data-rules="numeric">
                                    <div class="form-error" id="editBudgetError"></div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Target Beneficiaries</label>
                                    <input type="number" class="form-control" name="target_beneficiaries" 
                                           min="0" data-rules="numeric">
                                    <div class="form-error" id="editTarget_beneficiariesError"></div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Status *</label>
                                    <select class="form-select" name="status" data-rules="required" required>
                                        <option value="active">Active</option>
                                        <option value="completed">Completed</option>
                                        <option value="cancelled">Cancelled</option>
                                    </select>
                                    <div class="form-error" id="editStatusError"></div>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Activity Image</label>
                            <input type="file" class="form-control" name="image" 
                                   accept="image/*" data-rules="file|fileSize:5MB|fileType:image">
                            <div class="form-error" id="editImageError"></div>
                            <small class="form-text text-muted">Leave empty to keep current image</small>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Impact Details (JSON)</label>
                            <textarea class="form-control" name="impact_details" rows="3" 
                                      placeholder='{"people_reached": 100, "communities_served": 5}'></textarea>
                            <small class="form-text text-muted">Enter impact metrics in JSON format</small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="updateActivity()">Update Activity</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container position-fixed top-0 end-0 p-3"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/validation.js"></script>
    <script src="assets/js/admin.js"></script>
    <script>
        class ActivitiesManager {
            constructor() {
                this.currentPage = 1;
                this.itemsPerPage = 12;
                this.activities = [];
                this.filteredActivities = [];
                this.init();
            }

            init() {
                this.loadActivities();
                this.loadStatistics();
                this.setupEventListeners();
                this.setupFormValidation();
            }

            setupEventListeners() {
                // Filter change events
                document.getElementById('statusFilter').addEventListener('change', () => this.applyFilters());
                document.getElementById('typeFilter').addEventListener('change', () => this.applyFilters());
                document.getElementById('dateFrom').addEventListener('change', () => this.applyFilters());
                document.getElementById('dateTo').addEventListener('change', () => this.applyFilters());
                
                // Search input
                document.getElementById('searchInput').addEventListener('input', 
                    this.debounce(() => this.applyFilters(), 300));
            }

            setupFormValidation() {
                if (typeof FormValidator !== 'undefined') {
                    this.formValidator = new FormValidator();
                    this.formValidator.initializeForm(document.getElementById('addActivityForm'));
                    this.formValidator.initializeForm(document.getElementById('editActivityForm'));
                }
            }

            async loadActivities() {
                try {
                    const response = await fetch(window.BHRC_CONFIG ? window.BHRC_CONFIG.API.BASE_URL + ''.replace('/api', '') : 'https://bhrcdata.online/backend/api'.replace('/api', '')));
                    const result = await response.json();
                    
                    if (result.success) {
                        this.activities = result.data;
                        this.filteredActivities = [...this.activities];
                        this.renderActivities();
                        this.renderPagination();
                    } else {
                        this.showToast('Error loading activities: ' + result.message, 'error');
                    }
                } catch (error) {
                    this.showToast('Error loading activities: ' + error.message, 'error');
                }
            }

            async loadStatistics() {
                try {
                    const response = await fetch(window.BHRC_CONFIG ? window.BHRC_CONFIG.API.BASE_URL + ''.replace('/api', '') : 'https://bhrcdata.online/backend/api'.replace('/api', '')));
                    const result = await response.json();
                    
                    if (result.success) {
                        const stats = result.data;
                        document.getElementById('totalActivities').textContent = stats.total || 0;
                        document.getElementById('activeActivities').textContent = stats.active || 0;
                        document.getElementById('completedActivities').textContent = stats.completed || 0;
                        document.getElementById('totalBeneficiaries').textContent = stats.total_beneficiaries || 0;
                        
                        // Update impact metrics
                        if (stats.impact) {
                            document.getElementById('peopleReached').textContent = stats.impact.people_reached || 0;
                            document.getElementById('communitiesServed').textContent = stats.impact.communities_served || 0;
                            document.getElementById('legalAidCases').textContent = stats.impact.legal_aid_cases || 0;
                            document.getElementById('awarenessPrograms').textContent = stats.impact.awareness_programs || 0;
                        }
                    }
                } catch (error) {
                    console.error('Error loading statistics:', error);
                }
            }

            renderActivities() {
                const container = document.getElementById('activitiesList');
                const startIndex = (this.currentPage - 1) * this.itemsPerPage;
                const endIndex = startIndex + this.itemsPerPage;
                const pageActivities = this.filteredActivities.slice(startIndex, endIndex);

                if (pageActivities.length === 0) {
                    container.innerHTML = `
                        <div class="col-12">
                            <div class="text-center py-5">
                                <i class="fas fa-tasks fa-3x text-muted mb-3"></i>
                                <h5>No activities found</h5>
                                <p class="text-muted">Try adjusting your filters or add a new activity.</p>
                            </div>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = pageActivities.map(activity => `
                    <div class="col-md-6 col-lg-4">
                        <div class="activity-card">
                            ${activity.image ? `<img src="${activity.image}" alt="${activity.title}" class="activity-image">` : ''}
                            <div class="activity-meta">
                                <span class="activity-date">
                                    <i class="fas fa-calendar"></i> ${this.formatDate(activity.start_date)}
                                </span>
                                <span class="activity-status status-${activity.status}">${this.capitalizeFirst(activity.status)}</span>
                            </div>
                            <h5>${activity.title}</h5>
                            <p class="text-muted">${this.truncateText(activity.description, 100)}</p>
                            <div class="activity-details">
                                <small class="text-muted">
                                    <i class="fas fa-map-marker-alt"></i> ${activity.location || 'Not specified'}
                                </small>
                                <br>
                                <small class="text-muted">
                                    <i class="fas fa-users"></i> Target: ${activity.target_beneficiaries || 'Not specified'}
                                </small>
                                ${activity.budget ? `<br><small class="text-muted"><i class="fas fa-rupee-sign"></i> Budget: â‚¹${this.formatNumber(activity.budget)}</small>` : ''}
                            </div>
                            <div class="activity-actions mt-3">
                                <button class="btn btn-sm btn-outline-primary" onclick="activitiesManager.viewActivity(${activity.id})">
                                    <i class="fas fa-eye"></i> View
                                </button>
                                <button class="btn btn-sm btn-outline-secondary" onclick="activitiesManager.editActivity(${activity.id})">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="activitiesManager.deleteActivity(${activity.id})">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            renderPagination() {
                const totalPages = Math.ceil(this.filteredActivities.length / this.itemsPerPage);
                const pagination = document.getElementById('pagination');
                
                if (totalPages <= 1) {
                    pagination.innerHTML = '';
                    return;
                }

                let paginationHTML = '';
                
                // Previous button
                paginationHTML += `
                    <li class="page-item ${this.currentPage === 1 ? 'disabled' : ''}">
                        <a class="page-link" href="#" onclick="activitiesManager.changePage(${this.currentPage - 1})">Previous</a>
                    </li>
                `;
                
                // Page numbers
                for (let i = 1; i <= totalPages; i++) {
                    if (i === 1 || i === totalPages || (i >= this.currentPage - 2 && i <= this.currentPage + 2)) {
                        paginationHTML += `
                            <li class="page-item ${i === this.currentPage ? 'active' : ''}">
                                <a class="page-link" href="#" onclick="activitiesManager.changePage(${i})">${i}</a>
                            </li>
                        `;
                    } else if (i === this.currentPage - 3 || i === this.currentPage + 3) {
                        paginationHTML += '<li class="page-item disabled"><span class="page-link">...</span></li>';
                    }
                }
                
                // Next button
                paginationHTML += `
                    <li class="page-item ${this.currentPage === totalPages ? 'disabled' : ''}">
                        <a class="page-link" href="#" onclick="activitiesManager.changePage(${this.currentPage + 1})">Next</a>
                    </li>
                `;
                
                pagination.innerHTML = paginationHTML;
            }

            changePage(page) {
                const totalPages = Math.ceil(this.filteredActivities.length / this.itemsPerPage);
                if (page >= 1 && page <= totalPages) {
                    this.currentPage = page;
                    this.renderActivities();
                    this.renderPagination();
                    window.scrollTo(0, 0);
                }
            }

            applyFilters() {
                const statusFilter = document.getElementById('statusFilter').value;
                const typeFilter = document.getElementById('typeFilter').value;
                const dateFrom = document.getElementById('dateFrom').value;
                const dateTo = document.getElementById('dateTo').value;
                const searchTerm = document.getElementById('searchInput').value.toLowerCase();

                this.filteredActivities = this.activities.filter(activity => {
                    // Status filter
                    if (statusFilter && activity.status !== statusFilter) return false;
                    
                    // Type filter
                    if (typeFilter && activity.type !== typeFilter) return false;
                    
                    // Date range filter
                    if (dateFrom && activity.start_date < dateFrom) return false;
                    if (dateTo && activity.start_date > dateTo) return false;
                    
                    // Search filter
                    if (searchTerm) {
                        const searchableText = `${activity.title} ${activity.description} ${activity.location}`.toLowerCase();
                        if (!searchableText.includes(searchTerm)) return false;
                    }
                    
                    return true;
                });

                this.currentPage = 1;
                this.renderActivities();
                this.renderPagination();
            }

            clearFilters() {
                document.getElementById('statusFilter').value = '';
                document.getElementById('typeFilter').value = '';
                document.getElementById('dateFrom').value = '';
                document.getElementById('dateTo').value = '';
                document.getElementById('searchInput').value = '';
                this.applyFilters();
            }

            async saveActivity() {
                const form = document.getElementById('addActivityForm');
                
                if (this.formValidator && !this.formValidator.validateForm(form)) {
                    return;
                }

                const formData = new FormData(form);
                
                try {
                    const response = await fetch(window.BHRC_CONFIG ? window.BHRC_CONFIG.API.BASE_URL + ''.replace('/api', '') : 'https://bhrcdata.online/backend/api'.replace('/api', '')), {
                        method: 'POST',
                        body: formData
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        this.showToast('Activity created successfully!', 'success');
                        bootstrap.Modal.getInstance(document.getElementById('addActivityModal')).hide();
                        form.reset();
                        this.loadActivities();
                        this.loadStatistics();
                    } else {
                        this.showToast('Error creating activity: ' + result.message, 'error');
                    }
                } catch (error) {
                    this.showToast('Error creating activity: ' + error.message, 'error');
                }
            }

            async editActivity(id) {
                try {
                    const response = await fetch(`/api/activities/${id}`);
                    const result = await response.json();
                    
                    if (result.success) {
                        const activity = result.data;
                        const form = document.getElementById('editActivityForm');
                        
                        // Populate form fields
                        form.querySelector('[name="id"]').value = activity.id;
                        form.querySelector('[name="title"]').value = activity.title;
                        form.querySelector('[name="type"]').value = activity.type;
                        form.querySelector('[name="description"]').value = activity.description;
                        form.querySelector('[name="start_date"]').value = activity.start_date;
                        form.querySelector('[name="end_date"]').value = activity.end_date || '';
                        form.querySelector('[name="location"]').value = activity.location || '';
                        form.querySelector('[name="budget"]').value = activity.budget || '';
                        form.querySelector('[name="target_beneficiaries"]').value = activity.target_beneficiaries || '';
                        form.querySelector('[name="status"]').value = activity.status;
                        form.querySelector('[name="impact_details"]').value = activity.impact_details || '';
                        
                        bootstrap.Modal.getOrCreateInstance(document.getElementById('editActivityModal')).show();
                    } else {
                        this.showToast('Error loading activity: ' + result.message, 'error');
                    }
                } catch (error) {
                    this.showToast('Error loading activity: ' + error.message, 'error');
                }
            }

            async updateActivity() {
                const form = document.getElementById('editActivityForm');
                
                if (this.formValidator && !this.formValidator.validateForm(form)) {
                    return;
                }

                const formData = new FormData(form);
                const id = formData.get('id');
                
                try {
                    const response = await fetch(`/api/activities/${id}`, {
                        method: 'PUT',
                        body: formData
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        this.showToast('Activity updated successfully!', 'success');
                        bootstrap.Modal.getInstance(document.getElementById('editActivityModal')).hide();
                        this.loadActivities();
                        this.loadStatistics();
                    } else {
                        this.showToast('Error updating activity: ' + result.message, 'error');
                    }
                } catch (error) {
                    this.showToast('Error updating activity: ' + error.message, 'error');
                }
            }

            async deleteActivity(id) {
                if (!confirm('Are you sure you want to delete this activity? This action cannot be undone.')) {
                    return;
                }

                try {
                    const response = await fetch(`/api/activities/${id}`, {
                        method: 'DELETE'
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        this.showToast('Activity deleted successfully!', 'success');
                        this.loadActivities();
                        this.loadStatistics();
                    } else {
                        this.showToast('Error deleting activity: ' + result.message, 'error');
                    }
                } catch (error) {
                    this.showToast('Error deleting activity: ' + error.message, 'error');
                }
            }

            viewActivity(id) {
                // Implement view activity details
                window.open(`activity-details.html?id=${id}`, '_blank');
            }

            // Utility methods
            formatDate(dateString) {
                return new Date(dateString).toLocaleDateString('en-IN');
            }

            formatNumber(number) {
                return new Intl.NumberFormat('en-IN').format(number);
            }

            capitalizeFirst(str) {
                return str.charAt(0).toUpperCase() + str.slice(1);
            }

            truncateText(text, maxLength) {
                return text.length > maxLength ? text.substring(0, maxLength) + '...' : text;
            }

            debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }

            showToast(message, type = 'info') {
                const toastContainer = document.getElementById('toastContainer');
                const toastId = 'toast-' + Date.now();
                
                const toastHTML = `
                    <div id="${toastId}" class="toast align-items-center text-white bg-${type === 'error' ? 'danger' : type === 'success' ? 'success' : 'primary'} border-0" role="alert">
                        <div class="d-flex">
                            <div class="toast-body">${message}</div>
                            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                        </div>
                    </div>
                `;
                
                toastContainer.insertAdjacentHTML('beforeend', toastHTML);
                const toast = new bootstrap.Toast(document.getElementById(toastId));
                toast.show();
                
                // Remove toast element after it's hidden
                document.getElementById(toastId).addEventListener('hidden.bs.toast', function() {
                    this.remove();
                });
            }
        }

        // Global functions
        function applyFilters() {
            activitiesManager.applyFilters();
        }

        function clearFilters() {
            activitiesManager.clearFilters();
        }

        function saveActivity() {
            activitiesManager.saveActivity();
        }

        function updateActivity() {
            activitiesManager.updateActivity();
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('authToken');
                window.location.href = '../login.html';
            }
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            window.activitiesManager = new ActivitiesManager();
        });
    </script>
</body>
</html>


