<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Member - BHRC Admin</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/css/admin.css" rel="stylesheet">
    <style>
        .member-form {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .form-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .form-content {
            padding: 40px;
        }
        .section-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #495057;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .photo-upload {
            text-align: center;
            margin-bottom: 30px;
        }
        .photo-preview {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: 4px solid #e9ecef;
            object-fit: cover;
            margin-bottom: 15px;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        .photo-placeholder {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: 4px dashed #dee2e6;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            background: #f8f9fa;
            color: #6c757d;
            cursor: pointer;
            transition: all 0.3s;
        }
        .photo-placeholder:hover {
            border-color: #007bff;
            color: #007bff;
        }
        .form-section {
            margin-bottom: 40px;
        }
        .required-field::after {
            content: " *";
            color: #dc3545;
        }
        .member-type-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .member-type-card {
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        .member-type-card:hover {
            border-color: #007bff;
            background: rgba(0,123,255,0.05);
        }
        .member-type-card.selected {
            border-color: #007bff;
            background: rgba(0,123,255,0.1);
        }
        .member-type-card i {
            font-size: 2rem;
            margin-bottom: 10px;
            color: #007bff;
        }
        .skills-input {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            padding: 8px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            min-height: 38px;
        }
        .skill-tag {
            background: #007bff;
            color: white;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .skill-tag .remove-skill {
            cursor: pointer;
            font-weight: bold;
        }
        .skills-input input {
            border: none;
            outline: none;
            flex: 1;
            min-width: 100px;
        }
        .document-upload {
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
        }
        .document-upload:hover {
            border-color: #007bff;
            background: rgba(0,123,255,0.05);
        }
        .document-list {
            margin-top: 15px;
        }
        .document-item {
            display: flex;
            align-items: center;
            justify-content: between;
            padding: 10px;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            margin-bottom: 5px;
        }
        .emergency-contact {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        .form-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 40px;
            background: #f8f9fa;
            border-top: 1px solid #dee2e6;
        }
        .member-preview {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }
        .preview-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        .preview-photo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
        }
        .preview-info h5 {
            margin: 0;
            color: #495057;
        }
        .preview-info p {
            margin: 5px 0 0 0;
            color: #6c757d;
        }
        .membership-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            position: relative;
            overflow: hidden;
        }
        .membership-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.1);
            transform: rotate(45deg);
        }
        .card-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 20px;
        }
        .card-logo {
            font-size: 1.5rem;
            font-weight: bold;
        }
        .card-id {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        .card-member-info h4 {
            margin: 0 0 5px 0;
        }
        .card-member-info p {
            margin: 0;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="admin-wrapper">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <img src="../../images/logo-light.png" alt="BHRC" class="sidebar-logo">
                <h4>BHRC Admin</h4>
            </div>
            <nav class="sidebar-nav">
                <a href="dashboard.html" class="nav-link">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </a>
                <a href="complaints.html" class="nav-link">
                    <i class="fas fa-exclamation-triangle"></i> Complaints
                </a>
                <a href="events.html" class="nav-link">
                    <i class="fas fa-calendar-alt"></i> Events
                </a>
                <a href="activities.html" class="nav-link">
                    <i class="fas fa-tasks"></i> Activities
                </a>
                <a href="members.html" class="nav-link">
                    <i class="fas fa-users"></i> Members
                </a>
                <a href="add_member.html" class="nav-link active">
                    <i class="fas fa-user-plus"></i> Add Member
                </a>
                <a href="donations.html" class="nav-link">
                    <i class="fas fa-heart"></i> Donations
                </a>
                <a href="gallery.html" class="nav-link">
                    <i class="fas fa-images"></i> Gallery
                </a>
                <a href="achievements.html" class="nav-link">
                    <i class="fas fa-trophy"></i> Achievements
                </a>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <header class="admin-header">
                <div class="header-left">
                    <button class="sidebar-toggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1>Add New Member</h1>
                </div>
                <div class="header-right">
                    <div class="header-actions">
                        <a href="members.html" class="btn btn-outline-secondary">
                            <i class="fas fa-arrow-left"></i> Back to Members
                        </a>
                        <div class="user-menu dropdown">
                            <button class="user-avatar dropdown-toggle" data-bs-toggle="dropdown">
                                <img src="../../images/default-avatar.png" alt="User">
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#"><i class="fas fa-user"></i> Profile</a></li>
                                <li><a class="dropdown-item" href="#"><i class="fas fa-cog"></i> Settings</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Content Area -->
            <div class="content-area">
                <div class="member-form">
                    <!-- Form Header -->
                    <div class="form-header">
                        <h2><i class="fas fa-user-plus"></i> Register New Member</h2>
                        <p>Complete the form below to add a new member to BHRC</p>
                    </div>

                    <!-- Form Content -->
                    <form id="addMemberForm" data-validate="true" enctype="multipart/form-data">
                        <div class="form-content">
                            <!-- Photo Upload Section -->
                            <div class="photo-upload">
                                <div class="photo-placeholder" onclick="document.getElementById('memberPhoto').click()">
                                    <div>
                                        <i class="fas fa-camera fa-2x mb-2"></i>
                                        <div>Upload Photo</div>
                                    </div>
                                </div>
                                <img id="photoPreview" class="photo-preview" style="display: none;" alt="Member Photo">
                                <input type="file" id="memberPhoto" name="photo" accept="image/*" style="display: none;" 
                                       data-rules="file|fileSize:2MB|fileType:image">
                                <div class="form-error" id="photoError"></div>
                                <small class="text-muted">Upload a clear photo (max 2MB)</small>
                            </div>

                            <!-- Member Type Selection -->
                            <div class="form-section">
                                <h4 class="section-title">
                                    <i class="fas fa-user-tag"></i> Membership Type
                                </h4>
                                
                                <div class="member-type-cards">
                                    <div class="member-type-card" data-type="regular">
                                        <i class="fas fa-user"></i>
                                        <h6>Regular Member</h6>
                                        <p class="small text-muted">Standard membership with basic benefits</p>
                                    </div>
                                    <div class="member-type-card" data-type="life">
                                        <i class="fas fa-star"></i>
                                        <h6>Life Member</h6>
                                        <p class="small text-muted">Lifetime membership with full benefits</p>
                                    </div>
                                    <div class="member-type-card" data-type="honorary">
                                        <i class="fas fa-crown"></i>
                                        <h6>Honorary Member</h6>
                                        <p class="small text-muted">Special recognition membership</p>
                                    </div>
                                    <div class="member-type-card" data-type="student">
                                        <i class="fas fa-graduation-cap"></i>
                                        <h6>Student Member</h6>
                                        <p class="small text-muted">Discounted membership for students</p>
                                    </div>
                                </div>
                                <input type="hidden" name="membership_type" id="membershipType" data-rules="required">
                                <div class="form-error" id="membership_typeError"></div>
                            </div>

                            <!-- Personal Information -->
                            <div class="form-section">
                                <h4 class="section-title">
                                    <i class="fas fa-id-card"></i> Personal Information
                                </h4>
                                
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label class="form-label required-field">Title</label>
                                            <select class="form-select" name="title" data-rules="required" required>
                                                <option value="">Select Title</option>
                                                <option value="Mr">Mr.</option>
                                                <option value="Ms">Ms.</option>
                                                <option value="Mrs">Mrs.</option>
                                                <option value="Dr">Dr.</option>
                                                <option value="Prof">Prof.</option>
                                                <option value="Adv">Adv.</option>
                                            </select>
                                            <div class="form-error" id="titleError"></div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label class="form-label required-field">First Name</label>
                                            <input type="text" class="form-control" name="first_name" 
                                                   data-rules="required|minLength:2|maxLength:50|alpha" 
                                                   placeholder="Enter first name" required>
                                            <div class="form-error" id="first_nameError"></div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label class="form-label required-field">Last Name</label>
                                            <input type="text" class="form-control" name="last_name" 
                                                   data-rules="required|minLength:2|maxLength:50|alpha" 
                                                   placeholder="Enter last name" required>
                                            <div class="form-error" id="last_nameError"></div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label required-field">Email</label>
                                            <input type="email" class="form-control" name="email" 
                                                   data-rules="required|email" 
                                                   placeholder="Enter email address" required>
                                            <div class="form-error" id="emailError"></div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label required-field">Phone Number</label>
                                            <input type="tel" class="form-control" name="phone" 
                                                   data-rules="required|phone" 
                                                   placeholder="Enter phone number" required>
                                            <div class="form-error" id="phoneError"></div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label class="form-label required-field">Date of Birth</label>
                                            <input type="date" class="form-control" name="date_of_birth" 
                                                   data-rules="required|date" required>
                                            <div class="form-error" id="date_of_birthError"></div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label class="form-label required-field">Gender</label>
                                            <select class="form-select" name="gender" data-rules="required" required>
                                                <option value="">Select Gender</option>
                                                <option value="male">Male</option>
                                                <option value="female">Female</option>
                                                <option value="other">Other</option>
                                                <option value="prefer_not_to_say">Prefer not to say</option>
                                            </select>
                                            <div class="form-error" id="genderError"></div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label class="form-label">Marital Status</label>
                                            <select class="form-select" name="marital_status">
                                                <option value="">Select Status</option>
                                                <option value="single">Single</option>
                                                <option value="married">Married</option>
                                                <option value="divorced">Divorced</option>
                                                <option value="widowed">Widowed</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Aadhar Number</label>
                                            <input type="text" class="form-control" name="aadhar_number" 
                                                   data-rules="aadhar" 
                                                   placeholder="Enter 12-digit Aadhar number">
                                            <div class="form-error" id="aadhar_numberError"></div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">PAN Number</label>
                                            <input type="text" class="form-control" name="pan_number" 
                                                   data-rules="pan" 
                                                   placeholder="Enter PAN number">
                                            <div class="form-error" id="pan_numberError"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Address Information -->
                            <div class="form-section">
                                <h4 class="section-title">
                                    <i class="fas fa-map-marker-alt"></i> Address Information
                                </h4>
                                
                                <div class="mb-3">
                                    <label class="form-label required-field">Street Address</label>
                                    <textarea class="form-control" name="address" rows="3" 
                                              data-rules="required|minLength:10" 
                                              placeholder="Enter complete address" required></textarea>
                                    <div class="form-error" id="addressError"></div>
                                </div>

                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label class="form-label required-field">City</label>
                                            <input type="text" class="form-control" name="city" 
                                                   data-rules="required|alpha" required>
                                            <div class="form-error" id="cityError"></div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label class="form-label required-field">State</label>
                                            <select class="form-select" name="state" data-rules="required" required>
                                                <option value="">Select State</option>
                                                <option value="Andhra Pradesh">Andhra Pradesh</option>
                                                <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                                                <option value="Assam">Assam</option>
                                                <option value="Bharatiya">Bharatiya</option>
                                                <option value="Chhattisgarh">Chhattisgarh</option>
                                                <option value="Goa">Goa</option>
                                                <option value="Gujarat">Gujarat</option>
                                                <option value="Haryana">Haryana</option>
                                                <option value="Himachal Pradesh">Himachal Pradesh</option>
                                                <option value="Jharkhand">Jharkhand</option>
                                                <option value="Karnataka">Karnataka</option>
                                                <option value="Kerala">Kerala</option>
                                                <option value="Madhya Pradesh">Madhya Pradesh</option>
                                                <option value="Maharashtra">Maharashtra</option>
                                                <option value="Manipur">Manipur</option>
                                                <option value="Meghalaya">Meghalaya</option>
                                                <option value="Mizoram">Mizoram</option>
                                                <option value="Nagaland">Nagaland</option>
                                                <option value="Odisha">Odisha</option>
                                                <option value="Punjab">Punjab</option>
                                                <option value="Rajasthan">Rajasthan</option>
                                                <option value="Sikkim">Sikkim</option>
                                                <option value="Tamil Nadu">Tamil Nadu</option>
                                                <option value="Telangana">Telangana</option>
                                                <option value="Tripura">Tripura</option>
                                                <option value="Uttar Pradesh">Uttar Pradesh</option>
                                                <option value="Uttarakhand">Uttarakhand</option>
                                                <option value="West Bengal">West Bengal</option>
                                                <option value="Delhi">Delhi</option>
                                            </select>
                                            <div class="form-error" id="stateError"></div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label class="form-label required-field">PIN Code</label>
                                            <input type="text" class="form-control" name="pincode" 
                                                   data-rules="required|numeric|length:6" 
                                                   placeholder="Enter PIN code" required>
                                            <div class="form-error" id="pincodeError"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Professional Information -->
                            <div class="form-section">
                                <h4 class="section-title">
                                    <i class="fas fa-briefcase"></i> Professional Information
                                </h4>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Occupation</label>
                                            <input type="text" class="form-control" name="occupation" 
                                                   placeholder="Enter occupation">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Organization</label>
                                            <input type="text" class="form-control" name="organization" 
                                                   placeholder="Enter organization name">
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Designation</label>
                                            <input type="text" class="form-control" name="designation" 
                                                   placeholder="Enter designation">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Experience (Years)</label>
                                            <input type="number" class="form-control" name="experience" 
                                                   min="0" max="50" placeholder="Years of experience">
                                        </div>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Skills & Expertise</label>
                                    <div class="skills-input" id="skillsInput">
                                        <input type="text" placeholder="Add skills..." onkeypress="handleSkillInput(event)">
                                    </div>
                                    <input type="hidden" name="skills" id="skillsHidden">
                                    <small class="form-text text-muted">Press Enter to add skills</small>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Areas of Interest</label>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" name="interests[]" value="human_rights" id="int1">
                                                <label class="form-check-label" for="int1">Human Rights</label>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" name="interests[]" value="legal_aid" id="int2">
                                                <label class="form-check-label" for="int2">Legal Aid</label>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" name="interests[]" value="education" id="int3">
                                                <label class="form-check-label" for="int3">Education</label>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" name="interests[]" value="community_service" id="int4">
                                                <label class="form-check-label" for="int4">Community Service</label>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" name="interests[]" value="advocacy" id="int5">
                                                <label class="form-check-label" for="int5">Advocacy</label>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" name="interests[]" value="research" id="int6">
                                                <label class="form-check-label" for="int6">Research</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Emergency Contact -->
                            <div class="form-section">
                                <h4 class="section-title">
                                    <i class="fas fa-phone-alt"></i> Emergency Contact
                                </h4>
                                
                                <div class="emergency-contact">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Contact Name</label>
                                                <input type="text" class="form-control" name="emergency_name" 
                                                       placeholder="Emergency contact name">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Relationship</label>
                                                <select class="form-select" name="emergency_relationship">
                                                    <option value="">Select Relationship</option>
                                                    <option value="spouse">Spouse</option>
                                                    <option value="parent">Parent</option>
                                                    <option value="child">Child</option>
                                                    <option value="sibling">Sibling</option>
                                                    <option value="friend">Friend</option>
                                                    <option value="other">Other</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Phone Number</label>
                                                <input type="tel" class="form-control" name="emergency_phone" 
                                                       data-rules="phone" placeholder="Emergency contact phone">
                                                <div class="form-error" id="emergency_phoneError"></div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Email</label>
                                                <input type="email" class="form-control" name="emergency_email" 
                                                       data-rules="email" placeholder="Emergency contact email">
                                                <div class="form-error" id="emergency_emailError"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Documents -->
                            <div class="form-section">
                                <h4 class="section-title">
                                    <i class="fas fa-file-upload"></i> Documents
                                </h4>
                                
                                <div class="document-upload" onclick="document.getElementById('documents').click()">
                                    <i class="fas fa-cloud-upload-alt fa-2x text-muted mb-2"></i>
                                    <p>Click to upload documents</p>
                                    <small class="text-muted">Upload ID proof, address proof, etc. (PDF, JPG, PNG - max 5MB each)</small>
                                </div>
                                <input type="file" id="documents" name="documents[]" multiple 
                                       accept=".pdf,.jpg,.jpeg,.png" style="display: none;" 
                                       data-rules="file|fileSize:5MB">
                                <div class="form-error" id="documentsError"></div>
                                <div class="document-list" id="documentList"></div>
                            </div>

                            <!-- Member Preview -->
                            <div class="member-preview" id="memberPreview">
                                <h5><i class="fas fa-eye"></i> Member Preview</h5>
                                <div class="preview-content"></div>
                            </div>
                        </div>

                        <!-- Form Actions -->
                        <div class="form-actions">
                            <div>
                                <button type="button" class="btn btn-outline-secondary me-2" onclick="previewMember()">
                                    <i class="fas fa-eye"></i> Preview
                                </button>
                                <button type="button" class="btn btn-outline-info me-2" onclick="generateMembershipCard()">
                                    <i class="fas fa-id-card"></i> Preview Card
                                </button>
                            </div>
                            <div>
                                <button type="button" class="btn btn-outline-secondary me-2" onclick="saveDraft()">
                                    <i class="fas fa-save"></i> Save Draft
                                </button>
                                <button type="button" class="btn btn-success" onclick="submitMember()">
                                    <i class="fas fa-user-plus"></i> Add Member
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container position-fixed top-0 end-0 p-3"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/validation.js"></script>
    <script src="assets/js/admin.js"></script>
    <script>
        class AddMemberManager {
            constructor() {
                this.skills = [];
                this.selectedMembershipType = '';
                this.init();
            }

            init() {
                this.setupFormValidation();
                this.setupEventListeners();
                this.setupFileUploads();
            }

            setupFormValidation() {
                if (typeof FormValidator !== 'undefined') {
                    this.formValidator = new FormValidator();
                    this.formValidator.initializeForm(document.getElementById('addMemberForm'));
                }
            }

            setupEventListeners() {
                // Member type selection
                document.querySelectorAll('.member-type-card').forEach(card => {
                    card.addEventListener('click', () => {
                        document.querySelectorAll('.member-type-card').forEach(c => c.classList.remove('selected'));
                        card.classList.add('selected');
                        this.selectedMembershipType = card.dataset.type;
                        document.getElementById('membershipType').value = this.selectedMembershipType;
                    });
                });

                // Age calculation from DOB
                document.querySelector('[name="date_of_birth"]').addEventListener('change', this.calculateAge);
            }

            setupFileUploads() {
                // Member photo preview
                document.getElementById('memberPhoto').addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            const preview = document.getElementById('photoPreview');
                            const placeholder = document.querySelector('.photo-placeholder');
                            preview.src = e.target.result;
                            preview.style.display = 'block';
                            placeholder.style.display = 'none';
                        };
                        reader.readAsDataURL(file);
                    }
                });

                // Documents upload
                document.getElementById('documents').addEventListener('change', this.handleDocumentUpload);
            }

            calculateAge() {
                const dob = new Date(this.value);
                const today = new Date();
                const age = today.getFullYear() - dob.getFullYear();
                const monthDiff = today.getMonth() - dob.getMonth();
                
                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < dob.getDate())) {
                    age--;
                }
                
                // You can display age somewhere if needed
                console.log('Age:', age);
            }

            handleDocumentUpload(e) {
                const files = e.target.files;
                const documentList = document.getElementById('documentList');
                documentList.innerHTML = '';
                
                Array.from(files).forEach((file, index) => {
                    const item = document.createElement('div');
                    item.className = 'document-item';
                    item.innerHTML = `
                        <div>
                            <i class="fas fa-file-alt me-2"></i>
                            <span>${file.name}</span>
                            <small class="text-muted ms-2">(${(file.size / 1024 / 1024).toFixed(2)} MB)</small>
                        </div>
                        <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeDocument(${index})">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    documentList.appendChild(item);
                });
            }

            async submitMember() {
                const form = document.getElementById('addMemberForm');
                
                if (this.formValidator && !this.formValidator.validateForm(form)) {
                    this.showToast('Please fix all validation errors before submitting.', 'error');
                    return;
                }

                if (!this.selectedMembershipType) {
                    this.showToast('Please select a membership type.', 'error');
                    return;
                }

                // Update skills hidden field
                document.getElementById('skillsHidden').value = this.skills.join(',');

                const formData = new FormData(form);
                
                try {
                    const response = await fetch(window.BHRC_CONFIG ? window.BHRC_CONFIG.API.BASE_URL + ''.replace('/api', '') : 'https://bhrcdata.online/backend/api'.replace('/api', '')), {
                        method: 'POST',
                        body: formData
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        this.showToast('Member added successfully!', 'success');
                        setTimeout(() => {
                            window.location.href = 'members.html';
                        }, 2000);
                    } else {
                        this.showToast('Error adding member: ' + result.message, 'error');
                    }
                } catch (error) {
                    this.showToast('Error adding member: ' + error.message, 'error');
                }
            }

            async saveDraft() {
                const form = document.getElementById('addMemberForm');
                const formData = new FormData(form);
                formData.append('is_draft', '1');
                
                // Update skills
                document.getElementById('skillsHidden').value = this.skills.join(',');
                
                try {
                    const response = await fetch(window.BHRC_CONFIG ? window.BHRC_CONFIG.API.BASE_URL + ''.replace('/api', '') : 'https://bhrcdata.online/backend/api'.replace('/api', '')), {
                        method: 'POST',
                        body: formData
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        this.showToast('Draft saved successfully!', 'success');
                    } else {
                        this.showToast('Error saving draft: ' + result.message, 'error');
                    }
                } catch (error) {
                    this.showToast('Error saving draft: ' + error.message, 'error');
                }
            }

            previewMember() {
                const form = document.getElementById('addMemberForm');
                const formData = new FormData(form);
                const preview = document.getElementById('memberPreview');
                const previewContent = preview.querySelector('.preview-content');
                
                const title = formData.get('title') || '';
                const firstName = formData.get('first_name') || '';
                const lastName = formData.get('last_name') || '';
                const email = formData.get('email') || '';
                const phone = formData.get('phone') || '';
                const membershipType = this.selectedMembershipType || 'Not selected';
                const occupation = formData.get('occupation') || 'Not specified';
                const organization = formData.get('organization') || 'Not specified';
                
                const photoPreview = document.getElementById('photoPreview');
                const photoHTML = photoPreview.style.display !== 'none' ? 
                    `<img src="${photoPreview.src}" class="preview-photo" alt="Member Photo">` : 
                    `<div class="preview-photo bg-light d-flex align-items-center justify-content-center">
                        <i class="fas fa-user fa-2x text-muted"></i>
                    </div>`;
                
                previewContent.innerHTML = `
                    <div class="preview-header">
                        ${photoHTML}
                        <div class="preview-info">
                            <h5>${title} ${firstName} ${lastName}</h5>
                            <p><i class="fas fa-envelope me-2"></i>${email}</p>
                            <p><i class="fas fa-phone me-2"></i>${phone}</p>
                            <p><i class="fas fa-user-tag me-2"></i>${this.capitalizeFirst(membershipType.replace('_', ' '))}</p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <strong>Occupation:</strong> ${occupation}<br>
                            <strong>Organization:</strong> ${organization}<br>
                            <strong>Skills:</strong> ${this.skills.join(', ') || 'None specified'}
                        </div>
                        <div class="col-md-6">
                            <strong>Address:</strong> ${formData.get('address') || 'Not provided'}<br>
                            <strong>City:</strong> ${formData.get('city') || ''}<br>
                            <strong>State:</strong> ${formData.get('state') || ''}
                        </div>
                    </div>
                `;
                
                preview.style.display = 'block';
                preview.scrollIntoView({ behavior: 'smooth' });
            }

            generateMembershipCard() {
                const form = document.getElementById('addMemberForm');
                const formData = new FormData(form);
                
                if (!formData.get('first_name') || !formData.get('last_name')) {
                    this.showToast('Please enter member name to generate card preview.', 'error');
                    return;
                }
                
                const title = formData.get('title') || '';
                const firstName = formData.get('first_name') || '';
                const lastName = formData.get('last_name') || '';
                const membershipType = this.selectedMembershipType || 'regular';
                const memberId = 'BHRC' + Date.now().toString().slice(-6);
                
                const cardHTML = `
                    <div class="membership-card">
                        <div class="card-header">
                            <div class="card-logo">BHRC</div>
                            <div class="card-id">${memberId}</div>
                        </div>
                        <div class="card-member-info">
                            <h4>${title} ${firstName} ${lastName}</h4>
                            <p>${this.capitalizeFirst(membershipType.replace('_', ' '))} Member</p>
                        </div>
                        <div class="mt-3">
                            <small>Bharatiya Human Rights Commission</small>
                        </div>
                    </div>
                `;
                
                const preview = document.getElementById('memberPreview');
                preview.querySelector('.preview-content').innerHTML = cardHTML;
                preview.style.display = 'block';
                preview.scrollIntoView({ behavior: 'smooth' });
            }

            // Utility methods
            capitalizeFirst(str) {
                return str.charAt(0).toUpperCase() + str.slice(1);
            }

            showToast(message, type = 'info') {
                const toastContainer = document.getElementById('toastContainer');
                const toastId = 'toast-' + Date.now();
                
                const toastHTML = `
                    <div id="${toastId}" class="toast align-items-center text-white bg-${type === 'error' ? 'danger' : type === 'success' ? 'success' : 'primary'} border-0" role="alert">
                        <div class="d-flex">
                            <div class="toast-body">${message}</div>
                            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                        </div>
                    </div>
                `;
                
                toastContainer.insertAdjacentHTML('beforeend', toastHTML);
                const toast = new bootstrap.Toast(document.getElementById(toastId));
                toast.show();
                
                document.getElementById(toastId).addEventListener('hidden.bs.toast', function() {
                    this.remove();
                });
            }
        }

        // Skills management functions
        function handleSkillInput(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                const input = event.target;
                const skill = input.value.trim();
                
                if (skill && !addMemberManager.skills.includes(skill)) {
                    addMemberManager.skills.push(skill);
                    renderSkills();
                    input.value = '';
                }
            }
        }

        function removeSkill(skill) {
            const index = addMemberManager.skills.indexOf(skill);
            if (index > -1) {
                addMemberManager.skills.splice(index, 1);
                renderSkills();
            }
        }

        function renderSkills() {
            const skillsInput = document.getElementById('skillsInput');
            const input = skillsInput.querySelector('input');
            
            // Remove existing skills
            skillsInput.querySelectorAll('.skill-tag').forEach(tag => tag.remove());
            
            // Add skills
            addMemberManager.skills.forEach(skill => {
                const skillElement = document.createElement('div');
                skillElement.className = 'skill-tag';
                skillElement.innerHTML = `
                    ${skill}
                    <span class="remove-skill" onclick="removeSkill('${skill}')">&times;</span>
                `;
                skillsInput.insertBefore(skillElement, input);
            });
        }

        function removeDocument(index) {
            const input = document.getElementById('documents');
            const dt = new DataTransfer();
            const files = Array.from(input.files);
            
            files.forEach((file, i) => {
                if (i !== index) {
                    dt.items.add(file);
                }
            });
            
            input.files = dt.files;
            addMemberManager.handleDocumentUpload({ target: input });
        }

        // Global functions
        function submitMember() {
            addMemberManager.submitMember();
        }

        function saveDraft() {
            addMemberManager.saveDraft();
        }

        function previewMember() {
            addMemberManager.previewMember();
        }

        function generateMembershipCard() {
            addMemberManager.generateMembershipCard();
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('authToken');
                window.location.href = '../login.html';
            }
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            window.addMemberManager = new AddMemberManager();
        });
    </script>
</body>
</html>


