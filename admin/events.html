<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Events Management - BHRC Admin</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
    <link href="assets/css/admin.css" rel="stylesheet">
    <style>
        .events-header {
            background: linear-gradient(135deg, #8e44ad 0%, #9b59b6 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }
        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
            text-align: center;
            border-left: 4px solid;
        }
        .stat-card.upcoming { border-left-color: #3498db; }
        .stat-card.ongoing { border-left-color: #27ae60; }
        .stat-card.completed { border-left-color: #95a5a6; }
        .stat-card.cancelled { border-left-color: #e74c3c; }
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .stat-label {
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        .view-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .toggle-btn {
            padding: 8px 15px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .toggle-btn.active {
            background: #8e44ad;
            color: white;
            border-color: #8e44ad;
        }
        .calendar-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        .events-list-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        .event-card {
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
            position: relative;
        }
        .event-card:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        .event-status {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        .status-upcoming {
            background: rgba(52, 152, 219, 0.1);
            color: #3498db;
        }
        .status-ongoing {
            background: rgba(39, 174, 96, 0.1);
            color: #27ae60;
        }
        .status-completed {
            background: rgba(149, 165, 166, 0.1);
            color: #95a5a6;
        }
        .status-cancelled {
            background: rgba(231, 76, 60, 0.1);
            color: #e74c3c;
        }
        .event-date {
            background: #8e44ad;
            color: white;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            margin-right: 20px;
            min-width: 80px;
        }
        .event-date .day {
            font-size: 1.5rem;
            font-weight: bold;
            display: block;
        }
        .event-date .month {
            font-size: 0.8rem;
            opacity: 0.9;
        }
        .event-content {
            flex: 1;
        }
        .event-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        .event-meta {
            display: flex;
            gap: 20px;
            margin-bottom: 10px;
            font-size: 0.9rem;
            color: #7f8c8d;
        }
        .event-meta i {
            width: 16px;
            margin-right: 5px;
        }
        .event-description {
            color: #5a6c7d;
            margin-bottom: 15px;
        }
        .event-actions {
            display: flex;
            gap: 10px;
        }
        .btn-action {
            padding: 5px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s;
        }
        .btn-view {
            background: #3498db;
            color: white;
        }
        .btn-edit {
            background: #f39c12;
            color: white;
        }
        .btn-delete {
            background: #e74c3c;
            color: white;
        }
        .btn-action:hover {
            opacity: 0.8;
            transform: translateY(-1px);
        }
        .filters-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
        }
        .quick-add-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
        }
        .fc-event {
            border: none !important;
            border-radius: 5px !important;
            padding: 2px 5px !important;
        }
        .fc-event-upcoming {
            background-color: #3498db !important;
        }
        .fc-event-ongoing {
            background-color: #27ae60 !important;
        }
        .fc-event-completed {
            background-color: #95a5a6 !important;
        }
        .fc-event-cancelled {
            background-color: #e74c3c !important;
        }
        .event-type-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 500;
            margin-right: 8px;
        }
        .type-workshop {
            background: rgba(52, 152, 219, 0.1);
            color: #3498db;
        }
        .type-seminar {
            background: rgba(155, 89, 182, 0.1);
            color: #9b59b6;
        }
        .type-camp {
            background: rgba(39, 174, 96, 0.1);
            color: #27ae60;
        }
        .type-meeting {
            background: rgba(243, 156, 18, 0.1);
            color: #f39c12;
        }
        .type-awareness {
            background: rgba(231, 76, 60, 0.1);
            color: #e74c3c;
        }
        .attendees-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        .attendees-avatars {
            display: flex;
            margin-right: 10px;
        }
        .attendee-avatar {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            border: 2px solid white;
            margin-left: -8px;
        }
        .attendee-avatar:first-child {
            margin-left: 0;
        }
        .attendees-count {
            font-size: 0.8rem;
            color: #7f8c8d;
        }
    </style>
</head>
<body>
    <div class="admin-wrapper">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <img src="../../images/logo-light.png" alt="BHRC" class="sidebar-logo">
                <h4>BHRC Admin</h4>
            </div>
            <nav class="sidebar-nav">
                <a href="dashboard.html" class="nav-link">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </a>
                <a href="complaints.html" class="nav-link">
                    <i class="fas fa-exclamation-triangle"></i> Complaints
                </a>
                <a href="events.html" class="nav-link active">
                    <i class="fas fa-calendar-alt"></i> Events
                </a>
                <a href="activities.html" class="nav-link">
                    <i class="fas fa-tasks"></i> Activities
                </a>
                <a href="members.html" class="nav-link">
                    <i class="fas fa-users"></i> Members
                </a>
                <a href="add_member.html" class="nav-link">
                    <i class="fas fa-user-plus"></i> Add Member
                </a>
                <a href="donations.html" class="nav-link">
                    <i class="fas fa-heart"></i> Donations
                </a>
                <a href="gallery.html" class="nav-link">
                    <i class="fas fa-images"></i> Gallery
                </a>
                <a href="achievements.html" class="nav-link">
                    <i class="fas fa-trophy"></i> Achievements
                </a>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <header class="admin-header">
                <div class="header-left">
                    <button class="sidebar-toggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1>Events Management</h1>
                </div>
                <div class="header-right">
                    <div class="header-actions">
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addEventModal">
                            <i class="fas fa-plus"></i> Add Event
                        </button>
                        <div class="user-menu dropdown">
                            <button class="user-avatar dropdown-toggle" data-bs-toggle="dropdown">
                                <img src="../../images/default-avatar.png" alt="User">
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#"><i class="fas fa-user"></i> Profile</a></li>
                                <li><a class="dropdown-item" href="#"><i class="fas fa-cog"></i> Settings</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Content Area -->
            <div class="content-area">
                <!-- Page Header -->
                <div class="events-header">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h2><i class="fas fa-calendar-alt"></i> Events Management</h2>
                            <p class="mb-0">Schedule and manage BHRC events, workshops, and activities</p>
                        </div>
                        <div class="col-md-4 text-end">
                            <button class="btn btn-light" onclick="refreshEvents()">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Statistics -->
                <div class="stats-row">
                    <div class="stat-card upcoming">
                        <div class="stat-number" id="upcomingEvents">0</div>
                        <div class="stat-label">Upcoming Events</div>
                    </div>
                    <div class="stat-card ongoing">
                        <div class="stat-number" id="ongoingEvents">0</div>
                        <div class="stat-label">Ongoing Events</div>
                    </div>
                    <div class="stat-card completed">
                        <div class="stat-number" id="completedEvents">0</div>
                        <div class="stat-label">Completed Events</div>
                    </div>
                    <div class="stat-card cancelled">
                        <div class="stat-number" id="cancelledEvents">0</div>
                        <div class="stat-label">Cancelled Events</div>
                    </div>
                </div>

                <!-- Filters -->
                <div class="filters-section">
                    <div class="row align-items-center">
                        <div class="col-md-3">
                            <div class="form-group">
                                <label>Search Events</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="searchInput" placeholder="Search events...">
                                    <button class="btn btn-outline-secondary" onclick="searchEvents()">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label>Status</label>
                                <select class="form-select" id="statusFilter" onchange="filterEvents()">
                                    <option value="">All Status</option>
                                    <option value="upcoming">Upcoming</option>
                                    <option value="ongoing">Ongoing</option>
                                    <option value="completed">Completed</option>
                                    <option value="cancelled">Cancelled</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label>Event Type</label>
                                <select class="form-select" id="typeFilter" onchange="filterEvents()">
                                    <option value="">All Types</option>
                                    <option value="workshop">Workshop</option>
                                    <option value="seminar">Seminar</option>
                                    <option value="camp">Legal Camp</option>
                                    <option value="meeting">Meeting</option>
                                    <option value="awareness">Awareness</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label>Location</label>
                                <select class="form-select" id="locationFilter" onchange="filterEvents()">
                                    <option value="">All Locations</option>
                                    <option value="patna">Patna</option>
                                    <option value="gaya">Gaya</option>
                                    <option value="muzaffarpur">Muzaffarpur</option>
                                    <option value="bhagalpur">Bhagalpur</option>
                                    <option value="online">Online</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label>&nbsp;</label>
                                <div class="d-flex gap-2">
                                    <button class="btn btn-outline-primary" onclick="clearFilters()">
                                        <i class="fas fa-times"></i> Clear
                                    </button>
                                    <button class="btn btn-outline-success" onclick="exportEvents()">
                                        <i class="fas fa-download"></i> Export
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- View Toggle -->
                <div class="view-toggle">
                    <button class="toggle-btn active" onclick="switchView('calendar')" id="calendarViewBtn">
                        <i class="fas fa-calendar"></i> Calendar View
                    </button>
                    <button class="toggle-btn" onclick="switchView('list')" id="listViewBtn">
                        <i class="fas fa-list"></i> List View
                    </button>
                </div>

                <!-- Calendar View -->
                <div class="calendar-container" id="calendarView">
                    <div id="calendar"></div>
                </div>

                <!-- List View -->
                <div class="events-list-container" id="listView" style="display: none;">
                    <div id="eventsListContainer">
                        <!-- Events will be loaded here -->
                    </div>
                    
                    <!-- Pagination -->
                    <nav aria-label="Events pagination" class="mt-4">
                        <ul class="pagination justify-content-center" id="pagination">
                            <!-- Pagination will be generated here -->
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Event Modal -->
    <div class="modal fade" id="addEventModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="eventModalTitle">Add New Event</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="eventForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label for="eventTitle" class="form-label">Event Title *</label>
                                    <input type="text" class="form-control" id="eventTitle" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label for="eventType" class="form-label">Event Type *</label>
                                    <select class="form-select" id="eventType" required>
                                        <option value="">Select Type</option>
                                        <option value="workshop">Workshop</option>
                                        <option value="seminar">Seminar</option>
                                        <option value="camp">Legal Camp</option>
                                        <option value="meeting">Meeting</option>
                                        <option value="awareness">Awareness Program</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group mb-3">
                            <label for="eventDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="eventDescription" rows="3"></textarea>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label for="eventStartDate" class="form-label">Start Date *</label>
                                    <input type="datetime-local" class="form-control" id="eventStartDate" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label for="eventEndDate" class="form-label">End Date *</label>
                                    <input type="datetime-local" class="form-control" id="eventEndDate" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label for="eventLocation" class="form-label">Location *</label>
                                    <input type="text" class="form-control" id="eventLocation" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label for="eventCapacity" class="form-label">Capacity</label>
                                    <input type="number" class="form-control" id="eventCapacity" min="1">
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label for="eventOrganizer" class="form-label">Organizer</label>
                                    <input type="text" class="form-control" id="eventOrganizer">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label for="eventContact" class="form-label">Contact</label>
                                    <input type="text" class="form-control" id="eventContact">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group mb-3">
                            <label for="eventStatus" class="form-label">Status</label>
                            <select class="form-select" id="eventStatus">
                                <option value="upcoming">Upcoming</option>
                                <option value="ongoing">Ongoing</option>
                                <option value="completed">Completed</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                        </div>
                        
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="eventRegistrationRequired">
                            <label class="form-check-label" for="eventRegistrationRequired">
                                Registration Required
                            </label>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveEvent()">Save Event</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Event Details Modal -->
    <div class="modal fade" id="eventDetailsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Event Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="eventDetailsContent">
                    <!-- Event details will be loaded here -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="editCurrentEvent()">Edit Event</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container position-fixed top-0 end-0 p-3"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
    <script src="assets/js/admin.js"></script>
    <script>
        class EventsManager {
            constructor() {
                this.events = [];
                this.filteredEvents = [];
                this.currentPage = 1;
                this.itemsPerPage = 10;
                this.currentView = 'calendar';
                this.calendar = null;
                this.currentEventId = null;
                this.init();
            }

            async init() {
                await this.loadEvents();
                this.updateStats();
                this.initializeCalendar();
                this.renderListView();
                this.setupEventListeners();
            }

            async loadEvents() {
                try {
                    const response = await fetch(window.BHRC_CONFIG ? window.BHRC_CONFIG.API.BASE_URL + ''.replace('/api', '') : 'https://bhrcdata.online/backend/api'.replace('/api', '')));
                    const result = await response.json();
                    
                    if (result.success) {
                        this.events = result.data;
                        this.filteredEvents = [...this.events];
                    } else {
                        this.showToast('Error loading events: ' + result.message, 'error');
                        this.loadSampleData();
                    }
                } catch (error) {
                    this.showToast('Error loading events: ' + error.message, 'error');
                    this.loadSampleData();
                }
            }

            loadSampleData() {
                this.events = [
                    {
                        id: 1,
                        title: 'Legal Awareness Workshop',
                        type: 'workshop',
                        description: 'Workshop on legal rights and awareness for rural communities',
                        start: '2024-02-15T10:00:00',
                        end: '2024-02-15T16:00:00',
                        location: 'Community Hall, Patna',
                        organizer: 'Dr. Rajesh Kumar',
                        contact: '+91 9876543210',
                        capacity: 100,
                        registered: 75,
                        status: 'upcoming',
                        registrationRequired: true
                    },
                    {
                        id: 2,
                        title: 'Human Rights Seminar',
                        type: 'seminar',
                        description: 'Seminar on current human rights issues in Bharatiya',
                        start: '2024-02-20T14:00:00',
                        end: '2024-02-20T18:00:00',
                        location: 'BHRC Office, Patna',
                        organizer: 'Priya Sharma',
                        contact: '+91 9876543211',
                        capacity: 50,
                        registered: 35,
                        status: 'upcoming',
                        registrationRequired: true
                    },
                    {
                        id: 3,
                        title: 'Free Legal Aid Camp',
                        type: 'camp',
                        description: 'Free legal consultation and aid for underprivileged',
                        start: '2024-02-10T09:00:00',
                        end: '2024-02-10T17:00:00',
                        location: 'District Court, Gaya',
                        organizer: 'Amit Singh',
                        contact: '+91 9876543212',
                        capacity: 200,
                        registered: 150,
                        status: 'completed',
                        registrationRequired: false
                    }
                ];
                this.filteredEvents = [...this.events];
            }

            updateStats() {
                const stats = {
                    upcoming: this.events.filter(e => e.status === 'upcoming').length,
                    ongoing: this.events.filter(e => e.status === 'ongoing').length,
                    completed: this.events.filter(e => e.status === 'completed').length,
                    cancelled: this.events.filter(e => e.status === 'cancelled').length
                };

                document.getElementById('upcomingEvents').textContent = stats.upcoming;
                document.getElementById('ongoingEvents').textContent = stats.ongoing;
                document.getElementById('completedEvents').textContent = stats.completed;
                document.getElementById('cancelledEvents').textContent = stats.cancelled;
            }

            initializeCalendar() {
                const calendarEl = document.getElementById('calendar');
                this.calendar = new FullCalendar.Calendar(calendarEl, {
                    initialView: 'dayGridMonth',
                    headerToolbar: {
                        left: 'prev,next today',
                        center: 'title',
                        right: 'dayGridMonth,timeGridWeek,timeGridDay'
                    },
                    events: this.events.map(event => ({
                        id: event.id,
                        title: event.title,
                        start: event.start,
                        end: event.end,
                        className: `fc-event-${event.status}`,
                        extendedProps: {
                            type: event.type,
                            status: event.status,
                            location: event.location
                        }
                    })),
                    eventClick: (info) => {
                        this.viewEvent(parseInt(info.event.id));
                    },
                    dateClick: (info) => {
                        this.openAddEventModal(info.dateStr);
                    }
                });
                this.calendar.render();
            }

            renderListView() {
                const container = document.getElementById('eventsListContainer');
                const startIndex = (this.currentPage - 1) * this.itemsPerPage;
                const endIndex = startIndex + this.itemsPerPage;
                const pageEvents = this.filteredEvents.slice(startIndex, endIndex);

                container.innerHTML = pageEvents.map(event => {
                    const startDate = new Date(event.start);
                    const endDate = new Date(event.end);
                    
                    return `
                        <div class="event-card">
                            <div class="event-status status-${event.status}">
                                ${event.status.charAt(0).toUpperCase() + event.status.slice(1)}
                            </div>
                            <div class="d-flex">
                                <div class="event-date">
                                    <span class="day">${startDate.getDate()}</span>
                                    <span class="month">${startDate.toLocaleDateString('en', { month: 'short' })}</span>
                                </div>
                                <div class="event-content">
                                    <div class="event-title">${event.title}</div>
                                    <div class="event-meta">
                                        <span><i class="fas fa-clock"></i> ${startDate.toLocaleTimeString('en', { hour: '2-digit', minute: '2-digit' })} - ${endDate.toLocaleTimeString('en', { hour: '2-digit', minute: '2-digit' })}</span>
                                        <span><i class="fas fa-map-marker-alt"></i> ${event.location}</span>
                                        <span><i class="fas fa-user"></i> ${event.organizer}</span>
                                    </div>
                                    <div class="event-type-badge type-${event.type}">
                                        ${event.type.charAt(0).toUpperCase() + event.type.slice(1)}
                                    </div>
                                    <div class="event-description">${event.description}</div>
                                    ${event.registrationRequired ? `
                                        <div class="attendees-info">
                                            <div class="attendees-avatars">
                                                <img src="../../images/default-avatar.png" alt="Attendee" class="attendee-avatar">
                                                <img src="../../images/default-avatar.png" alt="Attendee" class="attendee-avatar">
                                                <img src="../../images/default-avatar.png" alt="Attendee" class="attendee-avatar">
                                            </div>
                                            <span class="attendees-count">${event.registered}/${event.capacity} registered</span>
                                        </div>
                                    ` : ''}
                                    <div class="event-actions">
                                        <button class="btn-action btn-view" onclick="viewEvent(${event.id})" title="View Details">
                                            <i class="fas fa-eye"></i> View
                                        </button>
                                        <button class="btn-action btn-edit" onclick="editEvent(${event.id})" title="Edit">
                                            <i class="fas fa-edit"></i> Edit
                                        </button>
                                        <button class="btn-action btn-delete" onclick="deleteEvent(${event.id})" title="Delete">
                                            <i class="fas fa-trash"></i> Delete
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

                this.renderPagination();
            }

            renderPagination() {
                const totalPages = Math.ceil(this.filteredEvents.length / this.itemsPerPage);
                const pagination = document.getElementById('pagination');
                
                if (totalPages <= 1) {
                    pagination.innerHTML = '';
                    return;
                }

                let paginationHTML = '';
                
                // Previous button
                paginationHTML += `
                    <li class="page-item ${this.currentPage === 1 ? 'disabled' : ''}">
                        <a class="page-link" href="#" onclick="changePage(${this.currentPage - 1})">Previous</a>
                    </li>
                `;

                // Page numbers
                for (let i = 1; i <= totalPages; i++) {
                    if (i === 1 || i === totalPages || (i >= this.currentPage - 2 && i <= this.currentPage + 2)) {
                        paginationHTML += `
                            <li class="page-item ${i === this.currentPage ? 'active' : ''}">
                                <a class="page-link" href="#" onclick="changePage(${i})">${i}</a>
                            </li>
                        `;
                    } else if (i === this.currentPage - 3 || i === this.currentPage + 3) {
                        paginationHTML += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
                    }
                }

                // Next button
                paginationHTML += `
                    <li class="page-item ${this.currentPage === totalPages ? 'disabled' : ''}">
                        <a class="page-link" href="#" onclick="changePage(${this.currentPage + 1})">Next</a>
                    </li>
                `;

                pagination.innerHTML = paginationHTML;
            }

            setupEventListeners() {
                document.getElementById('searchInput').addEventListener('input', () => {
                    this.searchEvents();
                });
            }

            searchEvents() {
                const query = document.getElementById('searchInput').value.toLowerCase();
                this.filteredEvents = this.events.filter(event => 
                    event.title.toLowerCase().includes(query) ||
                    event.description.toLowerCase().includes(query) ||
                    event.location.toLowerCase().includes(query) ||
                    event.organizer.toLowerCase().includes(query)
                );
                this.currentPage = 1;
                this.renderListView();
                this.updateCalendar();
            }

            filterEvents() {
                const statusFilter = document.getElementById('statusFilter').value;
                const typeFilter = document.getElementById('typeFilter').value;
                const locationFilter = document.getElementById('locationFilter').value;

                this.filteredEvents = this.events.filter(event => {
                    return (!statusFilter || event.status === statusFilter) &&
                           (!typeFilter || event.type === typeFilter) &&
                           (!locationFilter || event.location.toLowerCase().includes(locationFilter));
                });

                this.currentPage = 1;
                this.renderListView();
                this.updateCalendar();
            }

            clearFilters() {
                document.getElementById('searchInput').value = '';
                document.getElementById('statusFilter').value = '';
                document.getElementById('typeFilter').value = '';
                document.getElementById('locationFilter').value = '';
                this.filteredEvents = [...this.events];
                this.currentPage = 1;
                this.renderListView();
                this.updateCalendar();
            }

            switchView(view) {
                this.currentView = view;
                
                if (view === 'calendar') {
                    document.getElementById('calendarView').style.display = 'block';
                    document.getElementById('listView').style.display = 'none';
                    document.getElementById('calendarViewBtn').classList.add('active');
                    document.getElementById('listViewBtn').classList.remove('active');
                } else {
                    document.getElementById('calendarView').style.display = 'none';
                    document.getElementById('listView').style.display = 'block';
                    document.getElementById('calendarViewBtn').classList.remove('active');
                    document.getElementById('listViewBtn').classList.add('active');
                }
            }

            changePage(page) {
                const totalPages = Math.ceil(this.filteredEvents.length / this.itemsPerPage);
                if (page >= 1 && page <= totalPages) {
                    this.currentPage = page;
                    this.renderListView();
                }
            }

            updateCalendar() {
                if (this.calendar) {
                    this.calendar.removeAllEvents();
                    this.calendar.addEventSource(this.filteredEvents.map(event => ({
                        id: event.id,
                        title: event.title,
                        start: event.start,
                        end: event.end,
                        className: `fc-event-${event.status}`,
                        extendedProps: {
                            type: event.type,
                            status: event.status,
                            location: event.location
                        }
                    })));
                }
            }

            openAddEventModal(date = null) {
                document.getElementById('eventModalTitle').textContent = 'Add New Event';
                document.getElementById('eventForm').reset();
                this.currentEventId = null;
                
                if (date) {
                    document.getElementById('eventStartDate').value = date + 'T10:00';
                    document.getElementById('eventEndDate').value = date + 'T18:00';
                }
                
                const modal = new bootstrap.Modal(document.getElementById('addEventModal'));
                modal.show();
            }

            viewEvent(eventId) {
                const event = this.events.find(e => e.id === eventId);
                if (!event) return;

                this.currentEventId = eventId;
                const startDate = new Date(event.start);
                const endDate = new Date(event.end);

                const modalContent = document.getElementById('eventDetailsContent');
                modalContent.innerHTML = `
                    <div class="row">
                        <div class="col-md-8">
                            <h4>${event.title}</h4>
                            <div class="mb-3">
                                <span class="event-type-badge type-${event.type}">${event.type.charAt(0).toUpperCase() + event.type.slice(1)}</span>
                                <span class="event-status status-${event.status}">${event.status.charAt(0).toUpperCase() + event.status.slice(1)}</span>
                            </div>
                            <p class="text-muted">${event.description}</p>
                            
                            <h6>Event Details</h6>
                            <table class="table table-borderless">
                                <tr><td><strong>Date & Time:</strong></td><td>${startDate.toLocaleDateString()} ${startDate.toLocaleTimeString('en', { hour: '2-digit', minute: '2-digit' })} - ${endDate.toLocaleTimeString('en', { hour: '2-digit', minute: '2-digit' })}</td></tr>
                                <tr><td><strong>Location:</strong></td><td>${event.location}</td></tr>
                                <tr><td><strong>Organizer:</strong></td><td>${event.organizer}</td></tr>
                                <tr><td><strong>Contact:</strong></td><td>${event.contact}</td></tr>
                                ${event.capacity ? `<tr><td><strong>Capacity:</strong></td><td>${event.capacity} people</td></tr>` : ''}
                                ${event.registrationRequired ? `<tr><td><strong>Registration:</strong></td><td>Required (${event.registered}/${event.capacity} registered)</td></tr>` : ''}
                            </table>
                        </div>
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">Quick Actions</h6>
                                </div>
                                <div class="card-body">
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-primary btn-sm" onclick="editEvent(${event.id})">
                                            <i class="fas fa-edit"></i> Edit Event
                                        </button>
                                        <button class="btn btn-success btn-sm" onclick="manageRegistrations(${event.id})">
                                            <i class="fas fa-users"></i> Manage Registrations
                                        </button>
                                        <button class="btn btn-info btn-sm" onclick="sendNotifications(${event.id})">
                                            <i class="fas fa-bell"></i> Send Notifications
                                        </button>
                                        <button class="btn btn-warning btn-sm" onclick="duplicateEvent(${event.id})">
                                            <i class="fas fa-copy"></i> Duplicate Event
                                        </button>
                                        <button class="btn btn-danger btn-sm" onclick="deleteEvent(${event.id})">
                                            <i class="fas fa-trash"></i> Delete Event
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                const modal = new bootstrap.Modal(document.getElementById('eventDetailsModal'));
                modal.show();
            }

            editEvent(eventId) {
                const event = this.events.find(e => e.id === eventId);
                if (!event) return;

                this.currentEventId = eventId;
                document.getElementById('eventModalTitle').textContent = 'Edit Event';
                
                // Populate form fields
                document.getElementById('eventTitle').value = event.title;
                document.getElementById('eventType').value = event.type;
                document.getElementById('eventDescription').value = event.description;
                document.getElementById('eventStartDate').value = event.start.slice(0, 16);
                document.getElementById('eventEndDate').value = event.end.slice(0, 16);
                document.getElementById('eventLocation').value = event.location;
                document.getElementById('eventCapacity').value = event.capacity || '';
                document.getElementById('eventOrganizer').value = event.organizer;
                document.getElementById('eventContact').value = event.contact;
                document.getElementById('eventStatus').value = event.status;
                document.getElementById('eventRegistrationRequired').checked = event.registrationRequired;

                const modal = new bootstrap.Modal(document.getElementById('addEventModal'));
                modal.show();
            }

            async saveEvent() {
                const form = document.getElementById('eventForm');
                if (!form.checkValidity()) {
                    form.reportValidity();
                    return;
                }

                const eventData = {
                    title: document.getElementById('eventTitle').value,
                    type: document.getElementById('eventType').value,
                    description: document.getElementById('eventDescription').value,
                    start: document.getElementById('eventStartDate').value,
                    end: document.getElementById('eventEndDate').value,
                    location: document.getElementById('eventLocation').value,
                    capacity: document.getElementById('eventCapacity').value || null,
                    organizer: document.getElementById('eventOrganizer').value,
                    contact: document.getElementById('eventContact').value,
                    status: document.getElementById('eventStatus').value,
                    registrationRequired: document.getElementById('eventRegistrationRequired').checked
                };

                try {
                    let response;
                    if (this.currentEventId) {
                        // Update existing event
                        response = await fetch(`/api/events/${this.currentEventId}`, {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(eventData)
                        });
                    } else {
                        // Create new event
                        response = await fetch(window.BHRC_CONFIG ? window.BHRC_CONFIG.API.BASE_URL + ''.replace('/api', '') : 'https://bhrcdata.online/backend/api'.replace('/api', '')), {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(eventData)
                        });
                    }

                    const result = await response.json();
                    if (result.success) {
                        this.showToast(this.currentEventId ? 'Event updated successfully' : 'Event created successfully', 'success');
                        bootstrap.Modal.getInstance(document.getElementById('addEventModal')).hide();
                        await this.loadEvents();
                        this.updateStats();
                        this.renderListView();
                        this.updateCalendar();
                    } else {
                        this.showToast('Error saving event: ' + result.message, 'error');
                    }
                } catch (error) {
                    this.showToast('Error saving event: ' + error.message, 'error');
                    // For demo purposes, simulate success
                    this.showToast(this.currentEventId ? 'Event updated successfully' : 'Event created successfully', 'success');
                    bootstrap.Modal.getInstance(document.getElementById('addEventModal')).hide();
                }
            }

            async deleteEvent(eventId) {
                if (!confirm('Are you sure you want to delete this event?')) return;

                try {
                    const response = await fetch(`/api/events/${eventId}`, {
                        method: 'DELETE'
                    });

                    const result = await response.json();
                    if (result.success) {
                        this.showToast('Event deleted successfully', 'success');
                        await this.loadEvents();
                        this.updateStats();
                        this.renderListView();
                        this.updateCalendar();
                    } else {
                        this.showToast('Error deleting event: ' + result.message, 'error');
                    }
                } catch (error) {
                    this.showToast('Error deleting event: ' + error.message, 'error');
                    // For demo purposes, simulate success
                    this.showToast('Event deleted successfully', 'success');
                }
            }

            exportEvents() {
                const csv = this.convertToCSV(this.filteredEvents);
                this.downloadCSV(csv, 'events.csv');
                this.showToast('Events data exported successfully', 'success');
            }

            convertToCSV(data) {
                const headers = ['ID', 'Title', 'Type', 'Start Date', 'End Date', 'Location', 'Organizer', 'Status', 'Capacity', 'Registered'];
                const csvContent = [
                    headers.join(','),
                    ...data.map(event => [
                        event.id,
                        `"${event.title}"`,
                        event.type,
                        event.start,
                        event.end,
                        `"${event.location}"`,
                        `"${event.organizer}"`,
                        event.status,
                        event.capacity || '',
                        event.registered || ''
                    ].join(','))
                ].join('\n');
                
                return csvContent;
            }

            downloadCSV(csv, filename) {
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.setAttribute('hidden', '');
                a.setAttribute('href', url);
                a.setAttribute('download', filename);
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            }

            showToast(message, type = 'info') {
                const toastContainer = document.getElementById('toastContainer');
                const toastId = 'toast-' + Date.now();
                
                const toastHTML = `
                    <div id="${toastId}" class="toast align-items-center text-white bg-${type === 'error' ? 'danger' : type === 'success' ? 'success' : 'primary'} border-0" role="alert">
                        <div class="d-flex">
                            <div class="toast-body">${message}</div>
                            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                        </div>
                    </div>
                `;
                
                toastContainer.insertAdjacentHTML('beforeend', toastHTML);
                const toast = new bootstrap.Toast(document.getElementById(toastId));
                toast.show();
                
                document.getElementById(toastId).addEventListener('hidden.bs.toast', function() {
                    this.remove();
                });
            }
        }

        // Global functions
        let eventsManager;

        function switchView(view) {
            eventsManager.switchView(view);
        }

        function changePage(page) {
            eventsManager.changePage(page);
        }

        function searchEvents() {
            eventsManager.searchEvents();
        }

        function filterEvents() {
            eventsManager.filterEvents();
        }

        function clearFilters() {
            eventsManager.clearFilters();
        }

        function viewEvent(eventId) {
            eventsManager.viewEvent(eventId);
        }

        function editEvent(eventId) {
            eventsManager.editEvent(eventId);
        }

        function editCurrentEvent() {
            if (eventsManager.currentEventId) {
                bootstrap.Modal.getInstance(document.getElementById('eventDetailsModal')).hide();
                eventsManager.editEvent(eventsManager.currentEventId);
            }
        }

        function deleteEvent(eventId) {
            eventsManager.deleteEvent(eventId);
        }

        function saveEvent() {
            eventsManager.saveEvent();
        }

        function exportEvents() {
            eventsManager.exportEvents();
        }

        function refreshEvents() {
            eventsManager.loadEvents();
            eventsManager.showToast('Events list refreshed', 'success');
        }

        function manageRegistrations(eventId) {
            eventsManager.showToast('Registration management feature coming soon', 'info');
        }

        function sendNotifications(eventId) {
            eventsManager.showToast('Notifications sent to all registered participants', 'success');
        }

        function duplicateEvent(eventId) {
            const event = eventsManager.events.find(e => e.id === eventId);
            if (event) {
                eventsManager.currentEventId = null;
                document.getElementById('eventModalTitle').textContent = 'Duplicate Event';
                
                // Populate form with event data
                document.getElementById('eventTitle').value = event.title + ' (Copy)';
                document.getElementById('eventType').value = event.type;
                document.getElementById('eventDescription').value = event.description;
                document.getElementById('eventLocation').value = event.location;
                document.getElementById('eventCapacity').value = event.capacity || '';
                document.getElementById('eventOrganizer').value = event.organizer;
                document.getElementById('eventContact').value = event.contact;
                document.getElementById('eventStatus').value = 'upcoming';
                document.getElementById('eventRegistrationRequired').checked = event.registrationRequired;

                const modal = new bootstrap.Modal(document.getElementById('addEventModal'));
                modal.show();
            }
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('authToken');
                window.location.href = '../login.html';
            }
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            eventsManager = new EventsManager();
        });
    </script>
</body>
</html>


