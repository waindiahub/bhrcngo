<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Activity - BHRC Admin</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-bs4.min.css" rel="stylesheet">
    <link href="assets/css/admin.css" rel="stylesheet">
    <style>
        .form-wizard {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .wizard-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .wizard-steps {
            display: flex;
            justify-content: center;
            padding: 20px 0;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }
        .step {
            display: flex;
            align-items: center;
            margin: 0 20px;
            color: #6c757d;
            font-weight: 500;
        }
        .step.active {
            color: #007bff;
        }
        .step.completed {
            color: #28a745;
        }
        .step-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #e9ecef;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-size: 14px;
            font-weight: bold;
        }
        .step.active .step-number {
            background: #007bff;
            color: white;
        }
        .step.completed .step-number {
            background: #28a745;
            color: white;
        }
        .wizard-content {
            padding: 40px;
        }
        .step-content {
            display: none;
        }
        .step-content.active {
            display: block;
        }
        .form-section {
            margin-bottom: 30px;
        }
        .section-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #495057;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
        }
        .image-preview {
            max-width: 200px;
            max-height: 200px;
            border-radius: 10px;
            margin-top: 10px;
            display: none;
        }
        .file-upload-area {
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
        }
        .file-upload-area:hover {
            border-color: #007bff;
            background: rgba(0,123,255,0.05);
        }
        .file-upload-area.dragover {
            border-color: #28a745;
            background: rgba(40,167,69,0.1);
        }
        .tag-input {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            padding: 8px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            min-height: 38px;
        }
        .tag {
            background: #007bff;
            color: white;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .tag .remove-tag {
            cursor: pointer;
            font-weight: bold;
        }
        .tag-input input {
            border: none;
            outline: none;
            flex: 1;
            min-width: 100px;
        }
        .wizard-actions {
            display: flex;
            justify-content: between;
            padding: 20px 40px;
            background: #f8f9fa;
            border-top: 1px solid #dee2e6;
        }
        .location-map {
            height: 300px;
            border-radius: 10px;
            margin-top: 15px;
        }
        .activity-preview {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        .preview-image {
            max-width: 100%;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        .impact-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .metric-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #dee2e6;
            text-align: center;
        }
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: #007bff;
        }
        .metric-label {
            color: #6c757d;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="admin-wrapper">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <img src="../../images/logo-light.png" alt="BHRC" class="sidebar-logo">
                <h4>BHRC Admin</h4>
            </div>
            <nav class="sidebar-nav">
                <a href="dashboard.html" class="nav-link">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </a>
                <a href="complaints.html" class="nav-link">
                    <i class="fas fa-exclamation-triangle"></i> Complaints
                </a>
                <a href="events.html" class="nav-link">
                    <i class="fas fa-calendar-alt"></i> Events
                </a>
                <a href="activities.html" class="nav-link">
                    <i class="fas fa-tasks"></i> Activities
                </a>
                <a href="add_activity.html" class="nav-link active">
                    <i class="fas fa-plus"></i> Add Activity
                </a>
                <a href="members.html" class="nav-link">
                    <i class="fas fa-users"></i> Members
                </a>
                <a href="donations.html" class="nav-link">
                    <i class="fas fa-heart"></i> Donations
                </a>
                <a href="gallery.html" class="nav-link">
                    <i class="fas fa-images"></i> Gallery
                </a>
                <a href="achievements.html" class="nav-link">
                    <i class="fas fa-trophy"></i> Achievements
                </a>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <header class="admin-header">
                <div class="header-left">
                    <button class="sidebar-toggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1>Add New Activity</h1>
                </div>
                <div class="header-right">
                    <div class="header-actions">
                        <a href="activities.html" class="btn btn-outline-secondary">
                            <i class="fas fa-arrow-left"></i> Back to Activities
                        </a>
                        <div class="user-menu dropdown">
                            <button class="user-avatar dropdown-toggle" data-bs-toggle="dropdown">
                                <img src="../../images/default-avatar.png" alt="User">
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#"><i class="fas fa-user"></i> Profile</a></li>
                                <li><a class="dropdown-item" href="#"><i class="fas fa-cog"></i> Settings</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Content Area -->
            <div class="content-area">
                <div class="form-wizard">
                    <!-- Wizard Header -->
                    <div class="wizard-header">
                        <h2><i class="fas fa-plus-circle"></i> Create New Activity</h2>
                        <p>Follow the steps below to create a comprehensive activity record</p>
                    </div>

                    <!-- Wizard Steps -->
                    <div class="wizard-steps">
                        <div class="step active" data-step="1">
                            <div class="step-number">1</div>
                            <span>Basic Information</span>
                        </div>
                        <div class="step" data-step="2">
                            <div class="step-number">2</div>
                            <span>Details & Media</span>
                        </div>
                        <div class="step" data-step="3">
                            <div class="step-number">3</div>
                            <span>Location & Impact</span>
                        </div>
                        <div class="step" data-step="4">
                            <div class="step-number">4</div>
                            <span>Review & Submit</span>
                        </div>
                    </div>

                    <!-- Form -->
                    <form id="addActivityForm" data-validate="true" enctype="multipart/form-data">
                        <div class="wizard-content">
                            <!-- Step 1: Basic Information -->
                            <div class="step-content active" data-step="1">
                                <div class="form-section">
                                    <h4 class="section-title">
                                        <i class="fas fa-info-circle"></i> Basic Information
                                    </h4>
                                    
                                    <div class="row">
                                        <div class="col-md-8">
                                            <div class="mb-3">
                                                <label class="form-label">Activity Title *</label>
                                                <input type="text" class="form-control" name="title" 
                                                       data-rules="required|minLength:5|maxLength:200" 
                                                       placeholder="Enter activity title" required>
                                                <div class="form-error" id="titleError"></div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label class="form-label">Activity Type *</label>
                                                <select class="form-select" name="type" data-rules="required" required>
                                                    <option value="">Select Type</option>
                                                    <option value="legal_aid">Legal Aid</option>
                                                    <option value="awareness">Awareness Campaign</option>
                                                    <option value="training">Training Program</option>
                                                    <option value="workshop">Workshop</option>
                                                    <option value="seminar">Seminar</option>
                                                    <option value="community_service">Community Service</option>
                                                    <option value="research">Research</option>
                                                    <option value="advocacy">Advocacy</option>
                                                    <option value="outreach">Outreach Program</option>
                                                    <option value="other">Other</option>
                                                </select>
                                                <div class="form-error" id="typeError"></div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label">Short Description *</label>
                                        <textarea class="form-control" name="short_description" rows="3" 
                                                  data-rules="required|minLength:20|maxLength:500" 
                                                  placeholder="Brief description of the activity (max 500 characters)" required></textarea>
                                        <div class="form-error" id="short_descriptionError"></div>
                                        <small class="form-text text-muted">This will be shown in activity listings</small>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label class="form-label">Start Date *</label>
                                                <input type="date" class="form-control" name="start_date" 
                                                       data-rules="required|date" required>
                                                <div class="form-error" id="start_dateError"></div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label class="form-label">End Date</label>
                                                <input type="date" class="form-control" name="end_date" 
                                                       data-rules="date">
                                                <div class="form-error" id="end_dateError"></div>
                                                <small class="form-text text-muted">Leave empty for single-day activities</small>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label class="form-label">Status *</label>
                                                <select class="form-select" name="status" data-rules="required" required>
                                                    <option value="planned">Planned</option>
                                                    <option value="ongoing">Ongoing</option>
                                                    <option value="completed">Completed</option>
                                                    <option value="cancelled">Cancelled</option>
                                                </select>
                                                <div class="form-error" id="statusError"></div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Priority Level</label>
                                                <select class="form-select" name="priority">
                                                    <option value="low">Low</option>
                                                    <option value="medium" selected>Medium</option>
                                                    <option value="high">High</option>
                                                    <option value="urgent">Urgent</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Assigned Team Member</label>
                                                <select class="form-select" name="assigned_to">
                                                    <option value="">Select Team Member</option>
                                                    <!-- Options will be populated dynamically -->
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Step 2: Details & Media -->
                            <div class="step-content" data-step="2">
                                <div class="form-section">
                                    <h4 class="section-title">
                                        <i class="fas fa-file-alt"></i> Detailed Description
                                    </h4>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">Full Description *</label>
                                        <textarea id="fullDescription" name="description" 
                                                  data-rules="required|minLength:50" required></textarea>
                                        <div class="form-error" id="descriptionError"></div>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label">Objectives</label>
                                        <textarea class="form-control" name="objectives" rows="4" 
                                                  placeholder="List the main objectives of this activity"></textarea>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label">Target Audience</label>
                                        <input type="text" class="form-control" name="target_audience" 
                                               placeholder="e.g., Students, Legal professionals, General public">
                                    </div>
                                </div>

                                <div class="form-section">
                                    <h4 class="section-title">
                                        <i class="fas fa-images"></i> Media & Documents
                                    </h4>
                                    
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Featured Image</label>
                                                <div class="file-upload-area" onclick="document.getElementById('featuredImage').click()">
                                                    <i class="fas fa-cloud-upload-alt fa-2x text-muted mb-2"></i>
                                                    <p>Click to upload or drag and drop</p>
                                                    <small class="text-muted">JPG, PNG, GIF up to 5MB</small>
                                                </div>
                                                <input type="file" id="featuredImage" name="featured_image" 
                                                       accept="image/*" style="display: none;" 
                                                       data-rules="file|fileSize:5MB|fileType:image">
                                                <img id="featuredImagePreview" class="image-preview" alt="Preview">
                                                <div class="form-error" id="featured_imageError"></div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Additional Images</label>
                                                <input type="file" class="form-control" name="additional_images[]" 
                                                       accept="image/*" multiple 
                                                       data-rules="file|fileSize:5MB|fileType:image">
                                                <small class="form-text text-muted">Select multiple images (max 5MB each)</small>
                                                <div class="form-error" id="additional_imagesError"></div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label">Documents</label>
                                        <input type="file" class="form-control" name="documents[]" 
                                               accept=".pdf,.doc,.docx,.ppt,.pptx" multiple 
                                               data-rules="file|fileSize:10MB">
                                        <small class="form-text text-muted">Upload related documents (PDF, DOC, PPT - max 10MB each)</small>
                                        <div class="form-error" id="documentsError"></div>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label">Video URL</label>
                                        <input type="url" class="form-control" name="video_url" 
                                               data-rules="url" placeholder="https://youtube.com/watch?v=...">
                                        <small class="form-text text-muted">YouTube, Vimeo, or other video platform URL</small>
                                        <div class="form-error" id="video_urlError"></div>
                                    </div>
                                </div>

                                <div class="form-section">
                                    <h4 class="section-title">
                                        <i class="fas fa-tags"></i> Tags & Categories
                                    </h4>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">Tags</label>
                                        <div class="tag-input" id="tagInput">
                                            <input type="text" placeholder="Add tags..." onkeypress="handleTagInput(event)">
                                        </div>
                                        <input type="hidden" name="tags" id="tagsHidden">
                                        <small class="form-text text-muted">Press Enter to add tags</small>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label">Related Categories</label>
                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" name="categories[]" value="human_rights" id="cat1">
                                                    <label class="form-check-label" for="cat1">Human Rights</label>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" name="categories[]" value="legal_aid" id="cat2">
                                                    <label class="form-check-label" for="cat2">Legal Aid</label>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" name="categories[]" value="education" id="cat3">
                                                    <label class="form-check-label" for="cat3">Education</label>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" name="categories[]" value="community" id="cat4">
                                                    <label class="form-check-label" for="cat4">Community Service</label>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" name="categories[]" value="advocacy" id="cat5">
                                                    <label class="form-check-label" for="cat5">Advocacy</label>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" name="categories[]" value="research" id="cat6">
                                                    <label class="form-check-label" for="cat6">Research</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Step 3: Location & Impact -->
                            <div class="step-content" data-step="3">
                                <div class="form-section">
                                    <h4 class="section-title">
                                        <i class="fas fa-map-marker-alt"></i> Location Details
                                    </h4>
                                    
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Venue/Location *</label>
                                                <input type="text" class="form-control" name="location" 
                                                       data-rules="required|minLength:5" 
                                                       placeholder="Enter venue or location" required>
                                                <div class="form-error" id="locationError"></div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="mb-3">
                                                <label class="form-label">City *</label>
                                                <input type="text" class="form-control" name="city" 
                                                       data-rules="required" required>
                                                <div class="form-error" id="cityError"></div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="mb-3">
                                                <label class="form-label">State *</label>
                                                <select class="form-select" name="state" data-rules="required" required>
                                                    <option value="">Select State</option>
                                                    <option value="Andhra Pradesh">Andhra Pradesh</option>
                                                    <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                                                    <option value="Assam">Assam</option>
                                                    <option value="Bharatiya">Bharatiya</option>
                                                    <option value="Chhattisgarh">Chhattisgarh</option>
                                                    <option value="Goa">Goa</option>
                                                    <option value="Gujarat">Gujarat</option>
                                                    <option value="Haryana">Haryana</option>
                                                    <option value="Himachal Pradesh">Himachal Pradesh</option>
                                                    <option value="Jharkhand">Jharkhand</option>
                                                    <option value="Karnataka">Karnataka</option>
                                                    <option value="Kerala">Kerala</option>
                                                    <option value="Madhya Pradesh">Madhya Pradesh</option>
                                                    <option value="Maharashtra">Maharashtra</option>
                                                    <option value="Manipur">Manipur</option>
                                                    <option value="Meghalaya">Meghalaya</option>
                                                    <option value="Mizoram">Mizoram</option>
                                                    <option value="Nagaland">Nagaland</option>
                                                    <option value="Odisha">Odisha</option>
                                                    <option value="Punjab">Punjab</option>
                                                    <option value="Rajasthan">Rajasthan</option>
                                                    <option value="Sikkim">Sikkim</option>
                                                    <option value="Tamil Nadu">Tamil Nadu</option>
                                                    <option value="Telangana">Telangana</option>
                                                    <option value="Tripura">Tripura</option>
                                                    <option value="Uttar Pradesh">Uttar Pradesh</option>
                                                    <option value="Uttarakhand">Uttarakhand</option>
                                                    <option value="West Bengal">West Bengal</option>
                                                    <option value="Delhi">Delhi</option>
                                                </select>
                                                <div class="form-error" id="stateError"></div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label">Full Address</label>
                                        <textarea class="form-control" name="address" rows="3" 
                                                  placeholder="Complete address with landmarks"></textarea>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Latitude</label>
                                                <input type="number" class="form-control" name="latitude" 
                                                       step="any" placeholder="e.g., 28.6139">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Longitude</label>
                                                <input type="number" class="form-control" name="longitude" 
                                                       step="any" placeholder="e.g., 77.2090">
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-section">
                                    <h4 class="section-title">
                                        <i class="fas fa-chart-line"></i> Impact & Metrics
                                    </h4>
                                    
                                    <div class="row">
                                        <div class="col-md-3">
                                            <div class="mb-3">
                                                <label class="form-label">Participants</label>
                                                <input type="number" class="form-control" name="participants" 
                                                       min="0" placeholder="Number of participants">
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="mb-3">
                                                <label class="form-label">Beneficiaries</label>
                                                <input type="number" class="form-control" name="beneficiaries" 
                                                       min="0" placeholder="Direct beneficiaries">
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="mb-3">
                                                <label class="form-label">Volunteers</label>
                                                <input type="number" class="form-control" name="volunteers" 
                                                       min="0" placeholder="Number of volunteers">
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="mb-3">
                                                <label class="form-label">Budget (â‚¹)</label>
                                                <input type="number" class="form-control" name="budget" 
                                                       min="0" step="0.01" placeholder="Activity budget">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label">Expected Outcomes</label>
                                        <textarea class="form-control" name="expected_outcomes" rows="4" 
                                                  placeholder="Describe the expected outcomes and impact of this activity"></textarea>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label">Success Metrics</label>
                                        <textarea class="form-control" name="success_metrics" rows="3" 
                                                  placeholder="How will you measure the success of this activity?"></textarea>
                                    </div>
                                </div>

                                <div class="form-section">
                                    <h4 class="section-title">
                                        <i class="fas fa-users"></i> Partners & Collaborators
                                    </h4>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">Partner Organizations</label>
                                        <input type="text" class="form-control" name="partners" 
                                               placeholder="List partner organizations (comma-separated)">
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label">Sponsors</label>
                                        <input type="text" class="form-control" name="sponsors" 
                                               placeholder="List sponsors or funding sources">
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label">Contact Person</label>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <input type="text" class="form-control" name="contact_name" 
                                                       placeholder="Contact person name">
                                            </div>
                                            <div class="col-md-6">
                                                <input type="tel" class="form-control" name="contact_phone" 
                                                       placeholder="Contact phone number">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Step 4: Review & Submit -->
                            <div class="step-content" data-step="4">
                                <div class="form-section">
                                    <h4 class="section-title">
                                        <i class="fas fa-eye"></i> Review Activity Details
                                    </h4>
                                    
                                    <div class="activity-preview" id="activityPreview">
                                        <!-- Preview content will be generated here -->
                                    </div>
                                </div>

                                <div class="form-section">
                                    <h4 class="section-title">
                                        <i class="fas fa-cog"></i> Additional Settings
                                    </h4>
                                    
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-check mb-3">
                                                <input class="form-check-input" type="checkbox" name="is_featured" id="isFeatured">
                                                <label class="form-check-label" for="isFeatured">
                                                    Feature this activity on homepage
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-check mb-3">
                                                <input class="form-check-input" type="checkbox" name="allow_registration" id="allowRegistration">
                                                <label class="form-check-label" for="allowRegistration">
                                                    Allow public registration
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-check mb-3">
                                                <input class="form-check-input" type="checkbox" name="send_notifications" id="sendNotifications" checked>
                                                <label class="form-check-label" for="sendNotifications">
                                                    Send notifications to subscribers
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-check mb-3">
                                                <input class="form-check-input" type="checkbox" name="publish_immediately" id="publishImmediately" checked>
                                                <label class="form-check-label" for="publishImmediately">
                                                    Publish immediately
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label">Additional Notes</label>
                                        <textarea class="form-control" name="notes" rows="3" 
                                                  placeholder="Any additional notes or instructions"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Wizard Actions -->
                        <div class="wizard-actions">
                            <button type="button" class="btn btn-secondary" id="prevBtn" onclick="changeStep(-1)" style="display: none;">
                                <i class="fas fa-arrow-left"></i> Previous
                            </button>
                            <div class="ms-auto">
                                <button type="button" class="btn btn-outline-secondary me-2" onclick="saveDraft()">
                                    <i class="fas fa-save"></i> Save Draft
                                </button>
                                <button type="button" class="btn btn-primary" id="nextBtn" onclick="changeStep(1)">
                                    Next <i class="fas fa-arrow-right"></i>
                                </button>
                                <button type="button" class="btn btn-success" id="submitBtn" onclick="submitActivity()" style="display: none;">
                                    <i class="fas fa-check"></i> Create Activity
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container position-fixed top-0 end-0 p-3"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-bs4.min.js"></script>
    <script src="assets/js/validation.js"></script>
    <script src="assets/js/admin.js"></script>
    <script>
        class AddActivityManager {
            constructor() {
                this.currentStep = 1;
                this.totalSteps = 4;
                this.tags = [];
                this.init();
            }

            init() {
                this.setupFormValidation();
                this.setupSummernote();
                this.setupFileUploads();
                this.loadTeamMembers();
                this.setupEventListeners();
            }

            setupFormValidation() {
                if (typeof FormValidator !== 'undefined') {
                    this.formValidator = new FormValidator();
                    this.formValidator.initializeForm(document.getElementById('addActivityForm'));
                }
            }

            setupSummernote() {
                $('#fullDescription').summernote({
                    height: 200,
                    toolbar: [
                        ['style', ['style']],
                        ['font', ['bold', 'underline', 'clear']],
                        ['color', ['color']],
                        ['para', ['ul', 'ol', 'paragraph']],
                        ['table', ['table']],
                        ['insert', ['link', 'picture']],
                        ['view', ['fullscreen', 'codeview', 'help']]
                    ]
                });
            }

            setupFileUploads() {
                // Featured image preview
                document.getElementById('featuredImage').addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            const preview = document.getElementById('featuredImagePreview');
                            preview.src = e.target.result;
                            preview.style.display = 'block';
                        };
                        reader.readAsDataURL(file);
                    }
                });

                // Drag and drop for featured image
                const uploadArea = document.querySelector('.file-upload-area');
                uploadArea.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.classList.add('dragover');
                });

                uploadArea.addEventListener('dragleave', function(e) {
                    e.preventDefault();
                    this.classList.remove('dragover');
                });

                uploadArea.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.classList.remove('dragover');
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        document.getElementById('featuredImage').files = files;
                        document.getElementById('featuredImage').dispatchEvent(new Event('change'));
                    }
                });
            }

            async loadTeamMembers() {
                try {
                    const response = await fetch(window.BHRC_CONFIG ? window.BHRC_CONFIG.API.BASE_URL + ''.replace('/api', '') : 'https://bhrcdata.online/backend/api'.replace('/api', '')));
                    const result = await response.json();
                    
                    if (result.success) {
                        const select = document.querySelector('[name="assigned_to"]');
                        result.data.forEach(member => {
                            const option = document.createElement('option');
                            option.value = member.id;
                            option.textContent = `${member.name} (${member.role})`;
                            select.appendChild(option);
                        });
                    }
                } catch (error) {
                    console.error('Error loading team members:', error);
                }
            }

            setupEventListeners() {
                // Date validation
                document.querySelector('[name="start_date"]').addEventListener('change', this.validateDates);
                document.querySelector('[name="end_date"]').addEventListener('change', this.validateDates);
            }

            validateDates() {
                const startDate = document.querySelector('[name="start_date"]').value;
                const endDate = document.querySelector('[name="end_date"]').value;
                
                if (startDate && endDate && new Date(endDate) < new Date(startDate)) {
                    document.querySelector('[name="end_date"]').setCustomValidity('End date must be after start date');
                } else {
                    document.querySelector('[name="end_date"]').setCustomValidity('');
                }
            }

            changeStep(direction) {
                const newStep = this.currentStep + direction;
                
                if (newStep < 1 || newStep > this.totalSteps) return;
                
                // Validate current step before proceeding
                if (direction > 0 && !this.validateCurrentStep()) {
                    return;
                }
                
                // Hide current step
                document.querySelector(`.step-content[data-step="${this.currentStep}"]`).classList.remove('active');
                document.querySelector(`.step[data-step="${this.currentStep}"]`).classList.remove('active');
                
                // Show new step
                this.currentStep = newStep;
                document.querySelector(`.step-content[data-step="${this.currentStep}"]`).classList.add('active');
                document.querySelector(`.step[data-step="${this.currentStep}"]`).classList.add('active');
                
                // Mark previous steps as completed
                for (let i = 1; i < this.currentStep; i++) {
                    document.querySelector(`.step[data-step="${i}"]`).classList.add('completed');
                }
                
                // Update buttons
                this.updateButtons();
                
                // Generate preview for step 4
                if (this.currentStep === 4) {
                    this.generatePreview();
                }
                
                // Scroll to top
                window.scrollTo(0, 0);
            }

            validateCurrentStep() {
                const currentStepContent = document.querySelector(`.step-content[data-step="${this.currentStep}"]`);
                const requiredFields = currentStepContent.querySelectorAll('[required]');
                
                let isValid = true;
                
                requiredFields.forEach(field => {
                    if (!field.value.trim()) {
                        field.classList.add('is-invalid');
                        isValid = false;
                    } else {
                        field.classList.remove('is-invalid');
                    }
                });
                
                if (!isValid) {
                    this.showToast('Please fill in all required fields before proceeding.', 'error');
                }
                
                return isValid;
            }

            updateButtons() {
                const prevBtn = document.getElementById('prevBtn');
                const nextBtn = document.getElementById('nextBtn');
                const submitBtn = document.getElementById('submitBtn');
                
                prevBtn.style.display = this.currentStep === 1 ? 'none' : 'inline-block';
                nextBtn.style.display = this.currentStep === this.totalSteps ? 'none' : 'inline-block';
                submitBtn.style.display = this.currentStep === this.totalSteps ? 'inline-block' : 'none';
            }

            generatePreview() {
                const form = document.getElementById('addActivityForm');
                const formData = new FormData(form);
                const preview = document.getElementById('activityPreview');
                
                const title = formData.get('title') || 'Untitled Activity';
                const type = formData.get('type') || 'Not specified';
                const shortDescription = formData.get('short_description') || 'No description provided';
                const startDate = formData.get('start_date') || 'Not specified';
                const endDate = formData.get('end_date') || 'Single day';
                const location = formData.get('location') || 'Not specified';
                const city = formData.get('city') || '';
                const state = formData.get('state') || '';
                const status = formData.get('status') || 'planned';
                
                const featuredImage = document.getElementById('featuredImagePreview');
                const imageHTML = featuredImage.style.display !== 'none' ? 
                    `<img src="${featuredImage.src}" class="preview-image" alt="Featured Image">` : '';
                
                preview.innerHTML = `
                    <div class="row">
                        <div class="col-md-8">
                            <h3>${title}</h3>
                            <p class="text-muted mb-3">${shortDescription}</p>
                            ${imageHTML}
                            
                            <div class="row mt-3">
                                <div class="col-md-6">
                                    <strong>Type:</strong> ${this.capitalizeFirst(type.replace('_', ' '))}<br>
                                    <strong>Status:</strong> <span class="badge bg-${this.getStatusColor(status)}">${this.capitalizeFirst(status)}</span><br>
                                    <strong>Start Date:</strong> ${this.formatDate(startDate)}<br>
                                    <strong>End Date:</strong> ${endDate !== 'Single day' ? this.formatDate(endDate) : endDate}
                                </div>
                                <div class="col-md-6">
                                    <strong>Location:</strong> ${location}<br>
                                    <strong>City:</strong> ${city}<br>
                                    <strong>State:</strong> ${state}<br>
                                    <strong>Tags:</strong> ${this.tags.join(', ') || 'None'}
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="impact-metrics">
                                <div class="metric-card">
                                    <div class="metric-value">${formData.get('participants') || '0'}</div>
                                    <div class="metric-label">Participants</div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-value">${formData.get('beneficiaries') || '0'}</div>
                                    <div class="metric-label">Beneficiaries</div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-value">${formData.get('volunteers') || '0'}</div>
                                    <div class="metric-label">Volunteers</div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-value">â‚¹${formData.get('budget') || '0'}</div>
                                    <div class="metric-label">Budget</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            async submitActivity() {
                const form = document.getElementById('addActivityForm');
                
                if (this.formValidator && !this.formValidator.validateForm(form)) {
                    this.showToast('Please fix all validation errors before submitting.', 'error');
                    return;
                }

                // Update tags hidden field
                document.getElementById('tagsHidden').value = this.tags.join(',');
                
                // Update description from Summernote
                const description = $('#fullDescription').summernote('code');
                document.querySelector('[name="description"]').value = description;

                const formData = new FormData(form);
                
                try {
                    const response = await fetch(window.BHRC_CONFIG ? window.BHRC_CONFIG.API.BASE_URL + ''.replace('/api', '') : 'https://bhrcdata.online/backend/api'.replace('/api', '')), {
                        method: 'POST',
                        body: formData
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        this.showToast('Activity created successfully!', 'success');
                        setTimeout(() => {
                            window.location.href = 'activities.html';
                        }, 2000);
                    } else {
                        this.showToast('Error creating activity: ' + result.message, 'error');
                    }
                } catch (error) {
                    this.showToast('Error creating activity: ' + error.message, 'error');
                }
            }

            async saveDraft() {
                const form = document.getElementById('addActivityForm');
                const formData = new FormData(form);
                formData.append('is_draft', '1');
                
                // Update tags and description
                document.getElementById('tagsHidden').value = this.tags.join(',');
                const description = $('#fullDescription').summernote('code');
                formData.set('description', description);
                
                try {
                    const response = await fetch(window.BHRC_CONFIG ? window.BHRC_CONFIG.API.BASE_URL + ''.replace('/api', '') : 'https://bhrcdata.online/backend/api'.replace('/api', '')), {
                        method: 'POST',
                        body: formData
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        this.showToast('Draft saved successfully!', 'success');
                    } else {
                        this.showToast('Error saving draft: ' + result.message, 'error');
                    }
                } catch (error) {
                    this.showToast('Error saving draft: ' + error.message, 'error');
                }
            }

            // Utility methods
            getStatusColor(status) {
                const colors = {
                    planned: 'primary',
                    ongoing: 'warning',
                    completed: 'success',
                    cancelled: 'danger'
                };
                return colors[status] || 'secondary';
            }

            formatDate(dateString) {
                if (!dateString) return 'Not specified';
                return new Date(dateString).toLocaleDateString('en-IN', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            }

            capitalizeFirst(str) {
                return str.charAt(0).toUpperCase() + str.slice(1);
            }

            showToast(message, type = 'info') {
                const toastContainer = document.getElementById('toastContainer');
                const toastId = 'toast-' + Date.now();
                
                const toastHTML = `
                    <div id="${toastId}" class="toast align-items-center text-white bg-${type === 'error' ? 'danger' : type === 'success' ? 'success' : 'primary'} border-0" role="alert">
                        <div class="d-flex">
                            <div class="toast-body">${message}</div>
                            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                        </div>
                    </div>
                `;
                
                toastContainer.insertAdjacentHTML('beforeend', toastHTML);
                const toast = new bootstrap.Toast(document.getElementById(toastId));
                toast.show();
                
                document.getElementById(toastId).addEventListener('hidden.bs.toast', function() {
                    this.remove();
                });
            }
        }

        // Tag management functions
        function handleTagInput(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                const input = event.target;
                const tag = input.value.trim();
                
                if (tag && !addActivityManager.tags.includes(tag)) {
                    addActivityManager.tags.push(tag);
                    renderTags();
                    input.value = '';
                }
            }
        }

        function removeTag(tag) {
            const index = addActivityManager.tags.indexOf(tag);
            if (index > -1) {
                addActivityManager.tags.splice(index, 1);
                renderTags();
            }
        }

        function renderTags() {
            const tagInput = document.getElementById('tagInput');
            const input = tagInput.querySelector('input');
            
            // Remove existing tags
            tagInput.querySelectorAll('.tag').forEach(tag => tag.remove());
            
            // Add tags
            addActivityManager.tags.forEach(tag => {
                const tagElement = document.createElement('div');
                tagElement.className = 'tag';
                tagElement.innerHTML = `
                    ${tag}
                    <span class="remove-tag" onclick="removeTag('${tag}')">&times;</span>
                `;
                tagInput.insertBefore(tagElement, input);
            });
        }

        // Global functions
        function changeStep(direction) {
            addActivityManager.changeStep(direction);
        }

        function submitActivity() {
            addActivityManager.submitActivity();
        }

        function saveDraft() {
            addActivityManager.saveDraft();
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('authToken');
                window.location.href = '../login.html';
            }
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            window.addActivityManager = new AddActivityManager();
        });
    </script>
</body>
</html>


