<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Newsletter - BHRC Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="../assets/css/common.css" rel="stylesheet">
    <link href="../assets/css/admin.css" rel="stylesheet">
    <style>
        .newsletter-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            border-left: 4px solid #007bff;
        }
        .newsletter-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .newsletter-card.draft {
            border-left-color: #6c757d;
        }
        .newsletter-card.scheduled {
            border-left-color: #ffc107;
        }
        .newsletter-card.sent {
            border-left-color: #28a745;
        }
        .newsletter-card.failed {
            border-left-color: #dc3545;
        }
        .status-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
        }
        .subscriber-stats {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
        }
        .template-preview {
            max-height: 200px;
            overflow: hidden;
            border: 1px solid #dee2e6;
            border-radius: 4px;
        }
        .template-preview img {
            width: 100%;
            height: auto;
        }
        .email-editor {
            min-height: 400px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
        }
        .subscriber-list {
            max-height: 300px;
            overflow-y: auto;
        }
        .campaign-metrics {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
        }
        .metric-card {
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .progress-ring {
            width: 60px;
            height: 60px;
        }
        .progress-ring circle {
            fill: transparent;
            stroke-width: 4;
            stroke-linecap: round;
        }
        .progress-ring .background {
            stroke: #e9ecef;
        }
        .progress-ring .progress {
            stroke: #007bff;
            stroke-dasharray: 0 100;
            transition: stroke-dasharray 0.3s;
        }
        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        .template-card {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            overflow: hidden;
            transition: transform 0.2s ease;
        }
        .template-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .template-thumbnail {
            height: 150px;
            background: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h4><i class="fas fa-shield-alt"></i> BHRC Admin</h4>
        </div>
        <nav class="sidebar-nav">
            <a href="dashboard.html" class="nav-link">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </a>
            <a href="members.html" class="nav-link">
                <i class="fas fa-users"></i> Members
            </a>
            <a href="associates.html" class="nav-link">
                <i class="fas fa-handshake"></i> Associates
            </a>
            <a href="activities.html" class="nav-link">
                <i class="fas fa-calendar-alt"></i> Activities
            </a>
            <a href="events.html" class="nav-link">
                <i class="fas fa-calendar-check"></i> Events
            </a>
            <a href="newsletter.html" class="nav-link active">
                <i class="fas fa-newspaper"></i> Newsletter
            </a>
            <a href="gallery.html" class="nav-link">
                <i class="fas fa-images"></i> Gallery
            </a>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <header class="main-header">
            <div class="header-left">
                <button class="btn btn-link sidebar-toggle">
                    <i class="fas fa-bars"></i>
                </button>
                <h1>Newsletter</h1>
            </div>
            <div class="header-right">
                <button class="btn btn-success me-2" onclick="createNewsletter()">
                    <i class="fas fa-plus"></i> Create Newsletter
                </button>
                <button class="btn btn-outline-primary me-2" onclick="manageSubscribers()">
                    <i class="fas fa-users"></i> Subscribers
                </button>
                <button class="btn btn-outline-info me-2" onclick="viewTemplates()">
                    <i class="fas fa-file-alt"></i> Templates
                </button>
                <div class="dropdown">
                    <button class="btn btn-link dropdown-toggle" data-bs-toggle="dropdown">
                        <i class="fas fa-user-circle"></i> Admin
                    </button>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#"><i class="fas fa-user"></i> Profile</a></li>
                        <li><a class="dropdown-item" href="#"><i class="fas fa-cog"></i> Settings</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
                    </ul>
                </div>
            </div>
        </header>

        <!-- Content -->
        <div class="content-wrapper">
            <!-- Statistics Cards -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="card bg-primary text-white">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h6 class="card-title">Total Subscribers</h6>
                                    <h3 id="totalSubscribers">0</h3>
                                </div>
                                <i class="fas fa-users fa-2x opacity-75"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-success text-white">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h6 class="card-title">Active Subscribers</h6>
                                    <h3 id="activeSubscribers">0</h3>
                                </div>
                                <i class="fas fa-user-check fa-2x opacity-75"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-info text-white">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h6 class="card-title">Newsletters Sent</h6>
                                    <h3 id="newslettersSent">0</h3>
                                </div>
                                <i class="fas fa-paper-plane fa-2x opacity-75"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-warning text-white">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h6 class="card-title">Avg Open Rate</h6>
                                    <h3 id="avgOpenRate">0%</h3>
                                </div>
                                <i class="fas fa-envelope-open fa-2x opacity-75"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Navigation Tabs -->
            <ul class="nav nav-tabs mb-4" id="newsletterTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="campaigns-tab" data-bs-toggle="tab" data-bs-target="#campaigns" type="button" role="tab">
                        <i class="fas fa-bullhorn"></i> Campaigns
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="subscribers-tab" data-bs-toggle="tab" data-bs-target="#subscribers" type="button" role="tab">
                        <i class="fas fa-users"></i> Subscribers
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="templates-tab" data-bs-toggle="tab" data-bs-target="#templates" type="button" role="tab">
                        <i class="fas fa-file-alt"></i> Templates
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="analytics-tab" data-bs-toggle="tab" data-bs-target="#analytics" type="button" role="tab">
                        <i class="fas fa-chart-bar"></i> Analytics
                    </button>
                </li>
            </ul>

            <!-- Tab Content -->
            <div class="tab-content" id="newsletterTabContent">
                <!-- Campaigns Tab -->
                <div class="tab-pane fade show active" id="campaigns" role="tabpanel">
                    <!-- Filters -->
                    <div class="card mb-4">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-search"></i></span>
                                        <input type="text" class="form-control" id="campaignSearch" placeholder="Search campaigns...">
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <select class="form-select" id="statusFilter">
                                        <option value="">All Status</option>
                                        <option value="draft">Draft</option>
                                        <option value="scheduled">Scheduled</option>
                                        <option value="sent">Sent</option>
                                        <option value="failed">Failed</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <select class="form-select" id="dateFilter">
                                        <option value="">All Time</option>
                                        <option value="today">Today</option>
                                        <option value="week">This Week</option>
                                        <option value="month">This Month</option>
                                        <option value="quarter">This Quarter</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <select class="form-select" id="sortBy">
                                        <option value="created_desc">Newest First</option>
                                        <option value="created_asc">Oldest First</option>
                                        <option value="sent_desc">Recently Sent</option>
                                        <option value="name_asc">Name A-Z</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <div class="btn-group w-100">
                                        <button class="btn btn-outline-secondary" id="gridView" onclick="toggleView('grid')">
                                            <i class="fas fa-th"></i>
                                        </button>
                                        <button class="btn btn-outline-secondary active" id="listView" onclick="toggleView('list')">
                                            <i class="fas fa-list"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Campaigns List -->
                    <div id="campaignsContainer">
                        <!-- Campaigns will be loaded here -->
                    </div>

                    <!-- Pagination -->
                    <nav aria-label="Campaigns pagination" class="mt-4">
                        <ul class="pagination justify-content-center" id="campaignsPagination">
                            <!-- Pagination will be generated here -->
                        </ul>
                    </nav>
                </div>

                <!-- Subscribers Tab -->
                <div class="tab-pane fade" id="subscribers" role="tabpanel">
                    <div class="row">
                        <div class="col-md-8">
                            <!-- Subscriber Filters -->
                            <div class="card mb-4">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="fas fa-search"></i></span>
                                                <input type="text" class="form-control" id="subscriberSearch" placeholder="Search subscribers...">
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <select class="form-select" id="subscriberStatus">
                                                <option value="">All Status</option>
                                                <option value="active">Active</option>
                                                <option value="unsubscribed">Unsubscribed</option>
                                                <option value="bounced">Bounced</option>
                                            </select>
                                        </div>
                                        <div class="col-md-2">
                                            <select class="form-select" id="subscriberSource">
                                                <option value="">All Sources</option>
                                                <option value="website">Website</option>
                                                <option value="manual">Manual</option>
                                                <option value="import">Import</option>
                                                <option value="api">API</option>
                                            </select>
                                        </div>
                                        <div class="col-md-2">
                                            <button class="btn btn-success w-100" onclick="addSubscriber()">
                                                <i class="fas fa-plus"></i> Add
                                            </button>
                                        </div>
                                        <div class="col-md-2">
                                            <button class="btn btn-outline-primary w-100" onclick="importSubscribers()">
                                                <i class="fas fa-upload"></i> Import
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Subscribers List -->
                            <div id="subscribersContainer">
                                <!-- Subscribers will be loaded here -->
                            </div>
                        </div>

                        <div class="col-md-4">
                            <!-- Subscriber Stats -->
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h6><i class="fas fa-chart-pie"></i> Subscriber Statistics</h6>
                                </div>
                                <div class="card-body">
                                    <canvas id="subscriberChart" height="200"></canvas>
                                </div>
                            </div>

                            <!-- Recent Activity -->
                            <div class="card">
                                <div class="card-header">
                                    <h6><i class="fas fa-clock"></i> Recent Activity</h6>
                                </div>
                                <div class="card-body">
                                    <div id="recentActivity">
                                        <!-- Recent activity will be loaded here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Templates Tab -->
                <div class="tab-pane fade" id="templates" role="tabpanel">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h5>Email Templates</h5>
                        <button class="btn btn-primary" onclick="createTemplate()">
                            <i class="fas fa-plus"></i> Create Template
                        </button>
                    </div>

                    <div class="template-grid" id="templatesContainer">
                        <!-- Templates will be loaded here -->
                    </div>
                </div>

                <!-- Analytics Tab -->
                <div class="tab-pane fade" id="analytics" role="tabpanel">
                    <div class="row">
                        <div class="col-md-8">
                            <!-- Performance Chart -->
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h6><i class="fas fa-chart-line"></i> Campaign Performance</h6>
                                </div>
                                <div class="card-body">
                                    <canvas id="performanceChart" height="300"></canvas>
                                </div>
                            </div>

                            <!-- Top Performing Campaigns -->
                            <div class="card">
                                <div class="card-header">
                                    <h6><i class="fas fa-trophy"></i> Top Performing Campaigns</h6>
                                </div>
                                <div class="card-body">
                                    <div id="topCampaigns">
                                        <!-- Top campaigns will be loaded here -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <!-- Key Metrics -->
                            <div class="row">
                                <div class="col-12 mb-3">
                                    <div class="metric-card">
                                        <div class="progress-ring">
                                            <svg width="60" height="60">
                                                <circle class="background" cx="30" cy="30" r="26"></circle>
                                                <circle class="progress" cx="30" cy="30" r="26" id="openRateProgress"></circle>
                                            </svg>
                                        </div>
                                        <h6 class="mt-2">Open Rate</h6>
                                        <h4 id="openRateMetric">0%</h4>
                                    </div>
                                </div>
                                <div class="col-12 mb-3">
                                    <div class="metric-card">
                                        <div class="progress-ring">
                                            <svg width="60" height="60">
                                                <circle class="background" cx="30" cy="30" r="26"></circle>
                                                <circle class="progress" cx="30" cy="30" r="26" id="clickRateProgress"></circle>
                                            </svg>
                                        </div>
                                        <h6 class="mt-2">Click Rate</h6>
                                        <h4 id="clickRateMetric">0%</h4>
                                    </div>
                                </div>
                                <div class="col-12 mb-3">
                                    <div class="metric-card">
                                        <div class="progress-ring">
                                            <svg width="60" height="60">
                                                <circle class="background" cx="30" cy="30" r="26"></circle>
                                                <circle class="progress" cx="30" cy="30" r="26" id="unsubscribeRateProgress"></circle>
                                            </svg>
                                        </div>
                                        <h6 class="mt-2">Unsubscribe Rate</h6>
                                        <h4 id="unsubscribeRateMetric">0%</h4>
                                    </div>
                                </div>
                            </div>

                            <!-- Growth Chart -->
                            <div class="card">
                                <div class="card-header">
                                    <h6><i class="fas fa-chart-area"></i> Subscriber Growth</h6>
                                </div>
                                <div class="card-body">
                                    <canvas id="growthChart" height="200"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Newsletter Modal -->
    <div class="modal fade" id="createNewsletterModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create Newsletter</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="newsletterForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Campaign Name *</label>
                                    <input type="text" class="form-control" id="campaignName" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Subject Line *</label>
                                    <input type="text" class="form-control" id="subjectLine" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">From Name</label>
                                    <input type="text" class="form-control" id="fromName" value="BHRC">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">From Email</label>
                                    <input type="email" class="form-control" id="fromEmail" value="info@bhrcindia.in">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Template</label>
                                    <select class="form-select" id="templateSelect">
                                        <option value="">Select Template</option>
                                        <option value="basic">Basic Newsletter</option>
                                        <option value="announcement">Announcement</option>
                                        <option value="event">Event Invitation</option>
                                        <option value="update">Organization Update</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Recipients</label>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="recipients" id="allSubscribers" value="all" checked>
                                        <label class="form-check-label" for="allSubscribers">
                                            All Active Subscribers
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="recipients" id="selectedSubscribers" value="selected">
                                        <label class="form-check-label" for="selectedSubscribers">
                                            Selected Subscribers
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="recipients" id="testGroup" value="test">
                                        <label class="form-check-label" for="testGroup">
                                            Test Group Only
                                        </label>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Send Options</label>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="sendOption" id="sendNow" value="now" checked>
                                        <label class="form-check-label" for="sendNow">
                                            Send Now
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="sendOption" id="schedule" value="schedule">
                                        <label class="form-check-label" for="schedule">
                                            Schedule for Later
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="sendOption" id="saveDraft" value="draft">
                                        <label class="form-check-label" for="saveDraft">
                                            Save as Draft
                                        </label>
                                    </div>
                                </div>
                                <div class="mb-3" id="scheduleDateTime" style="display: none;">
                                    <label class="form-label">Schedule Date & Time</label>
                                    <input type="datetime-local" class="form-control" id="scheduledDate">
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Email Content</label>
                            <div class="email-editor" id="emailEditor" contenteditable="true">
                                <p>Start typing your newsletter content here...</p>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-outline-primary" onclick="previewNewsletter()">
                        <i class="fas fa-eye"></i> Preview
                    </button>
                    <button type="button" class="btn btn-success" onclick="saveNewsletter()">
                        <i class="fas fa-save"></i> Save & Send
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Campaign Details Modal -->
    <div class="modal fade" id="campaignDetailsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="campaignDetailsTitle">Campaign Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="campaignDetailsContent">
                        <!-- Campaign details will be loaded here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="duplicateCampaignBtn">
                        <i class="fas fa-copy"></i> Duplicate
                    </button>
                    <button type="button" class="btn btn-success" id="resendCampaignBtn">
                        <i class="fas fa-paper-plane"></i> Resend
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Subscriber Modal -->
    <div class="modal fade" id="addSubscriberModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Subscriber</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="subscriberForm">
                        <div class="mb-3">
                            <label class="form-label">Email Address *</label>
                            <input type="email" class="form-control" id="subscriberEmail" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Name</label>
                            <input type="text" class="form-control" id="subscriberName">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Status</label>
                            <select class="form-select" id="subscriberStatusSelect">
                                <option value="active">Active</option>
                                <option value="unsubscribed">Unsubscribed</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Source</label>
                            <select class="form-select" id="subscriberSourceSelect">
                                <option value="manual">Manual</option>
                                <option value="website">Website</option>
                                <option value="import">Import</option>
                                <option value="api">API</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Tags</label>
                            <input type="text" class="form-control" id="subscriberTags" placeholder="Enter tags separated by commas">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveSubscriber()">
                        <i class="fas fa-save"></i> Save Subscriber
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3" id="toastContainer"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        class NewsletterManager {
            constructor() {
                this.campaigns = [];
                this.subscribers = [];
                this.templates = [];
                this.currentView = 'list';
                this.currentPage = 1;
                this.itemsPerPage = 10;
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.loadData();
                this.updateStats();
                this.renderCharts();
            }

            setupEventListeners() {
                // Search and filters
                document.getElementById('campaignSearch').addEventListener('input', () => this.filterCampaigns());
                document.getElementById('statusFilter').addEventListener('change', () => this.filterCampaigns());
                document.getElementById('dateFilter').addEventListener('change', () => this.filterCampaigns());
                document.getElementById('sortBy').addEventListener('change', () => this.filterCampaigns());

                // Send options radio buttons
                document.querySelectorAll('input[name="sendOption"]').forEach(radio => {
                    radio.addEventListener('change', (e) => {
                        const scheduleDiv = document.getElementById('scheduleDateTime');
                        scheduleDiv.style.display = e.target.value === 'schedule' ? 'block' : 'none';
                    });
                });

                // Tab change events
                document.querySelectorAll('#newsletterTabs button').forEach(tab => {
                    tab.addEventListener('shown.bs.tab', (e) => {
                        const target = e.target.getAttribute('data-bs-target');
                        if (target === '#subscribers') {
                            this.loadSubscribers();
                        } else if (target === '#templates') {
                            this.loadTemplates();
                        } else if (target === '#analytics') {
                            this.loadAnalytics();
                        }
                    });
                });
            }

            async loadData() {
                try {
                    // Simulate API calls
                    this.campaigns = this.getMockCampaigns();
                    this.subscribers = this.getMockSubscribers();
                    this.templates = this.getMockTemplates();
                    
                    this.renderCampaigns();
                    this.updateStats();
                } catch (error) {
                    console.error('Error loading data:', error);
                    this.showToast('Error loading data: ' + error.message, 'error');
                }
            }

            getMockCampaigns() {
                return [
                    {
                        id: 1,
                        name: 'Monthly Newsletter - January 2024',
                        subject: 'BHRC Updates: New Year, New Initiatives',
                        status: 'sent',
                        createdAt: '2024-01-15T10:00:00Z',
                        sentAt: '2024-01-15T14:30:00Z',
                        recipients: 1250,
                        opens: 875,
                        clicks: 156,
                        unsubscribes: 3,
                        bounces: 12,
                        template: 'basic',
                        fromName: 'BHRC',
                        fromEmail: 'info@bhrcindia.in'
                    },
                    {
                        id: 2,
                        name: 'Human Rights Workshop Invitation',
                        subject: 'Join Our Upcoming Human Rights Workshop',
                        status: 'scheduled',
                        createdAt: '2024-01-20T09:15:00Z',
                        scheduledAt: '2024-01-25T10:00:00Z',
                        recipients: 800,
                        template: 'event',
                        fromName: 'BHRC Events',
                        fromEmail: 'events@bhrcindia.in'
                    },
                    {
                        id: 3,
                        name: 'Legal Aid Success Stories',
                        subject: 'How BHRC Made a Difference in 2023',
                        status: 'draft',
                        createdAt: '2024-01-18T16:45:00Z',
                        recipients: 0,
                        template: 'announcement',
                        fromName: 'BHRC',
                        fromEmail: 'info@bhrcindia.in'
                    },
                    {
                        id: 4,
                        name: 'Membership Drive Campaign',
                        subject: 'Become a BHRC Member Today',
                        status: 'sent',
                        createdAt: '2024-01-10T11:30:00Z',
                        sentAt: '2024-01-12T15:00:00Z',
                        recipients: 2000,
                        opens: 1200,
                        clicks: 240,
                        unsubscribes: 8,
                        bounces: 25,
                        template: 'basic',
                        fromName: 'BHRC Membership',
                        fromEmail: 'membership@bhrcindia.in'
                    },
                    {
                        id: 5,
                        name: 'Emergency Alert: Police Brutality Case',
                        subject: 'Urgent: Support Needed for Justice',
                        status: 'failed',
                        createdAt: '2024-01-22T08:00:00Z',
                        sentAt: '2024-01-22T08:30:00Z',
                        recipients: 1500,
                        opens: 0,
                        clicks: 0,
                        unsubscribes: 0,
                        bounces: 1500,
                        template: 'announcement',
                        fromName: 'BHRC Alerts',
                        fromEmail: 'alerts@bhrcindia.in',
                        error: 'SMTP server connection failed'
                    }
                ];
            }

            getMockSubscribers() {
                return [
                    {
                        id: 1,
                        email: 'rajesh.kumar@email.com',
                        name: 'Rajesh Kumar',
                        status: 'active',
                        source: 'website',
                        subscribedAt: '2023-12-15T10:30:00Z',
                        tags: ['member', 'legal-aid'],
                        opens: 45,
                        clicks: 12,
                        lastActivity: '2024-01-20T14:20:00Z'
                    },
                    {
                        id: 2,
                        email: 'priya.sharma@email.com',
                        name: 'Priya Sharma',
                        status: 'active',
                        source: 'manual',
                        subscribedAt: '2024-01-05T09:15:00Z',
                        tags: ['volunteer'],
                        opens: 8,
                        clicks: 3,
                        lastActivity: '2024-01-18T11:45:00Z'
                    },
                    {
                        id: 3,
                        email: 'amit.patel@email.com',
                        name: 'Amit Patel',
                        status: 'unsubscribed',
                        source: 'website',
                        subscribedAt: '2023-11-20T16:45:00Z',
                        unsubscribedAt: '2024-01-10T12:30:00Z',
                        tags: ['donor'],
                        opens: 23,
                        clicks: 5,
                        lastActivity: '2024-01-10T12:30:00Z'
                    },
                    {
                        id: 4,
                        email: 'sunita.devi@email.com',
                        name: 'Sunita Devi',
                        status: 'bounced',
                        source: 'import',
                        subscribedAt: '2023-10-12T14:20:00Z',
                        tags: ['member'],
                        opens: 15,
                        clicks: 2,
                        lastActivity: '2024-01-15T10:00:00Z',
                        bounceReason: 'Invalid email address'
                    }
                ];
            }

            getMockTemplates() {
                return [
                    {
                        id: 1,
                        name: 'Basic Newsletter',
                        description: 'Simple newsletter template with header, content, and footer',
                        thumbnail: 'basic-template.jpg',
                        category: 'newsletter',
                        createdAt: '2023-12-01T10:00:00Z',
                        usageCount: 15
                    },
                    {
                        id: 2,
                        name: 'Event Invitation',
                        description: 'Template for event invitations and announcements',
                        thumbnail: 'event-template.jpg',
                        category: 'event',
                        createdAt: '2023-12-05T14:30:00Z',
                        usageCount: 8
                    },
                    {
                        id: 3,
                        name: 'Announcement',
                        description: 'Template for important announcements and alerts',
                        thumbnail: 'announcement-template.jpg',
                        category: 'announcement',
                        createdAt: '2023-12-10T09:15:00Z',
                        usageCount: 12
                    },
                    {
                        id: 4,
                        name: 'Organization Update',
                        description: 'Template for regular organization updates and reports',
                        thumbnail: 'update-template.jpg',
                        category: 'update',
                        createdAt: '2023-12-15T16:45:00Z',
                        usageCount: 6
                    }
                ];
            }

            renderCampaigns() {
                const container = document.getElementById('campaignsContainer');
                
                if (this.campaigns.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-5">
                            <i class="fas fa-newspaper fa-3x text-muted mb-3"></i>
                            <h5 class="text-muted">No campaigns found</h5>
                            <p class="text-muted">Create your first newsletter campaign</p>
                            <button class="btn btn-primary" onclick="createNewsletter()">
                                <i class="fas fa-plus"></i> Create Newsletter
                            </button>
                        </div>
                    `;
                    return;
                }

                if (this.currentView === 'list') {
                    this.renderCampaignsList();
                } else {
                    this.renderCampaignsGrid();
                }
            }

            renderCampaignsList() {
                const container = document.getElementById('campaignsContainer');
                
                const html = this.campaigns.map(campaign => {
                    const statusClass = {
                        'draft': 'secondary',
                        'scheduled': 'warning',
                        'sent': 'success',
                        'failed': 'danger'
                    }[campaign.status];

                    const openRate = campaign.opens && campaign.recipients ? 
                        Math.round((campaign.opens / campaign.recipients) * 100) : 0;
                    const clickRate = campaign.clicks && campaign.recipients ? 
                        Math.round((campaign.clicks / campaign.recipients) * 100) : 0;

                    return `
                        <div class="card newsletter-card ${campaign.status} mb-3">
                            <div class="card-body">
                                <div class="row align-items-center">
                                    <div class="col-md-6">
                                        <h6 class="card-title mb-1">${campaign.name}</h6>
                                        <p class="text-muted mb-2">${campaign.subject}</p>
                                        <div class="d-flex gap-2 align-items-center">
                                            <span class="badge bg-${statusClass} status-badge">${campaign.status}</span>
                                            <small class="text-muted">
                                                <i class="fas fa-user"></i> ${campaign.recipients} recipients
                                            </small>
                                            <small class="text-muted">
                                                <i class="fas fa-calendar"></i> ${new Date(campaign.createdAt).toLocaleDateString()}
                                            </small>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        ${campaign.status === 'sent' ? `
                                            <div class="row text-center">
                                                <div class="col-4">
                                                    <div class="metric-small">
                                                        <div class="metric-value">${openRate}%</div>
                                                        <div class="metric-label">Opens</div>
                                                    </div>
                                                </div>
                                                <div class="col-4">
                                                    <div class="metric-small">
                                                        <div class="metric-value">${clickRate}%</div>
                                                        <div class="metric-label">Clicks</div>
                                                    </div>
                                                </div>
                                                <div class="col-4">
                                                    <div class="metric-small">
                                                        <div class="metric-value">${campaign.unsubscribes || 0}</div>
                                                        <div class="metric-label">Unsubs</div>
                                                    </div>
                                                </div>
                                            </div>
                                        ` : campaign.status === 'scheduled' ? `
                                            <div class="text-center">
                                                <small class="text-muted">Scheduled for:</small><br>
                                                <strong>${new Date(campaign.scheduledAt).toLocaleString()}</strong>
                                            </div>
                                        ` : campaign.status === 'failed' ? `
                                            <div class="text-center text-danger">
                                                <i class="fas fa-exclamation-triangle"></i><br>
                                                <small>${campaign.error || 'Send failed'}</small>
                                            </div>
                                        ` : `
                                            <div class="text-center text-muted">
                                                <i class="fas fa-edit"></i><br>
                                                <small>Draft</small>
                                            </div>
                                        `}
                                    </div>
                                    <div class="col-md-2 text-end">
                                        <div class="btn-group btn-group-sm">
                                            <button class="btn btn-outline-primary" onclick="viewCampaign(${campaign.id})">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            ${campaign.status === 'draft' ? `
                                                <button class="btn btn-outline-success" onclick="editCampaign(${campaign.id})">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                            ` : ''}
                                            <div class="btn-group btn-group-sm">
                                                <button class="btn btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown">
                                                    <i class="fas fa-ellipsis-v"></i>
                                                </button>
                                                <ul class="dropdown-menu">
                                                    <li><a class="dropdown-item" href="#" onclick="duplicateCampaign(${campaign.id})">
                                                        <i class="fas fa-copy"></i> Duplicate
                                                    </a></li>
                                                    ${campaign.status === 'sent' ? `
                                                        <li><a class="dropdown-item" href="#" onclick="resendCampaign(${campaign.id})">
                                                            <i class="fas fa-paper-plane"></i> Resend
                                                        </a></li>
                                                    ` : ''}
                                                    <li><hr class="dropdown-divider"></li>
                                                    <li><a class="dropdown-item text-danger" href="#" onclick="deleteCampaign(${campaign.id})">
                                                        <i class="fas fa-trash"></i> Delete
                                                    </a></li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

                container.innerHTML = html;
            }

            renderCampaignsGrid() {
                const container = document.getElementById('campaignsContainer');
                
                const html = `
                    <div class="row">
                        ${this.campaigns.map(campaign => {
                            const statusClass = {
                                'draft': 'secondary',
                                'scheduled': 'warning',
                                'sent': 'success',
                                'failed': 'danger'
                            }[campaign.status];

                            return `
                                <div class="col-md-4 mb-4">
                                    <div class="card newsletter-card ${campaign.status} h-100">
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between align-items-start mb-2">
                                                <span class="badge bg-${statusClass} status-badge">${campaign.status}</span>
                                                <div class="dropdown">
                                                    <button class="btn btn-sm btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown">
                                                        <i class="fas fa-ellipsis-v"></i>
                                                    </button>
                                                    <ul class="dropdown-menu">
                                                        <li><a class="dropdown-item" href="#" onclick="viewCampaign(${campaign.id})">
                                                            <i class="fas fa-eye"></i> View
                                                        </a></li>
                                                        <li><a class="dropdown-item" href="#" onclick="duplicateCampaign(${campaign.id})">
                                                            <i class="fas fa-copy"></i> Duplicate
                                                        </a></li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <h6 class="card-title">${campaign.name}</h6>
                                            <p class="card-text text-muted small">${campaign.subject}</p>
                                            <div class="mt-auto">
                                                <small class="text-muted">
                                                    <i class="fas fa-user"></i> ${campaign.recipients} recipients<br>
                                                    <i class="fas fa-calendar"></i> ${new Date(campaign.createdAt).toLocaleDateString()}
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;

                container.innerHTML = html;
            }

            loadSubscribers() {
                const container = document.getElementById('subscribersContainer');
                
                const html = this.subscribers.map(subscriber => {
                    const statusClass = {
                        'active': 'success',
                        'unsubscribed': 'warning',
                        'bounced': 'danger'
                    }[subscriber.status];

                    return `
                        <div class="card mb-3">
                            <div class="card-body">
                                <div class="row align-items-center">
                                    <div class="col-md-6">
                                        <h6 class="mb-1">${subscriber.name || 'No Name'}</h6>
                                        <p class="text-muted mb-1">${subscriber.email}</p>
                                        <div class="d-flex gap-2 align-items-center">
                                            <span class="badge bg-${statusClass}">${subscriber.status}</span>
                                            <small class="text-muted">
                                                <i class="fas fa-calendar"></i> ${new Date(subscriber.subscribedAt).toLocaleDateString()}
                                            </small>
                                            <small class="text-muted">
                                                <i class="fas fa-tag"></i> ${subscriber.source}
                                            </small>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="row text-center">
                                            <div class="col-4">
                                                <div class="metric-small">
                                                    <div class="metric-value">${subscriber.opens}</div>
                                                    <div class="metric-label">Opens</div>
                                                </div>
                                            </div>
                                            <div class="col-4">
                                                <div class="metric-small">
                                                    <div class="metric-value">${subscriber.clicks}</div>
                                                    <div class="metric-label">Clicks</div>
                                                </div>
                                            </div>
                                            <div class="col-4">
                                                <div class="metric-small">
                                                    <div class="metric-value">${this.getTimeAgo(subscriber.lastActivity)}</div>
                                                    <div class="metric-label">Last Active</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-2 text-end">
                                        <div class="btn-group btn-group-sm">
                                            <button class="btn btn-outline-primary" onclick="editSubscriber(${subscriber.id})">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="btn btn-outline-danger" onclick="deleteSubscriber(${subscriber.id})">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                ${subscriber.tags && subscriber.tags.length > 0 ? `
                                    <div class="mt-2">
                                        ${subscriber.tags.map(tag => `<span class="badge bg-light text-dark me-1">${tag}</span>`).join('')}
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    `;
                }).join('');

                container.innerHTML = html;
            }

            loadTemplates() {
                const container = document.getElementById('templatesContainer');
                
                const html = this.templates.map(template => `
                    <div class="template-card">
                        <div class="template-thumbnail">
                            <i class="fas fa-file-alt fa-3x text-muted"></i>
                        </div>
                        <div class="p-3">
                            <h6 class="mb-2">${template.name}</h6>
                            <p class="text-muted small mb-2">${template.description}</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <small class="text-muted">Used ${template.usageCount} times</small>
                                <div class="btn-group btn-group-sm">
                                    <button class="btn btn-outline-primary" onclick="previewTemplate(${template.id})">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-outline-success" onclick="useTemplate(${template.id})">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');

                container.innerHTML = html;
            }

            updateStats() {
                const totalSubscribers = this.subscribers.length;
                const activeSubscribers = this.subscribers.filter(s => s.status === 'active').length;
                const sentCampaigns = this.campaigns.filter(c => c.status === 'sent').length;
                
                const totalOpens = this.campaigns
                    .filter(c => c.status === 'sent')
                    .reduce((sum, c) => sum + (c.opens || 0), 0);
                const totalRecipients = this.campaigns
                    .filter(c => c.status === 'sent')
                    .reduce((sum, c) => sum + (c.recipients || 0), 0);
                const avgOpenRate = totalRecipients > 0 ? Math.round((totalOpens / totalRecipients) * 100) : 0;

                document.getElementById('totalSubscribers').textContent = totalSubscribers;
                document.getElementById('activeSubscribers').textContent = activeSubscribers;
                document.getElementById('newslettersSent').textContent = sentCampaigns;
                document.getElementById('avgOpenRate').textContent = `${avgOpenRate}%`;
            }

            renderCharts() {
                this.renderSubscriberChart();
                this.renderPerformanceChart();
                this.renderGrowthChart();
                this.updateMetricRings();
            }

            renderSubscriberChart() {
                const ctx = document.getElementById('subscriberChart').getContext('2d');
                const statusStats = this.subscribers.reduce((acc, subscriber) => {
                    acc[subscriber.status] = (acc[subscriber.status] || 0) + 1;
                    return acc;
                }, {});

                new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(statusStats).map(key => key.charAt(0).toUpperCase() + key.slice(1)),
                        datasets: [{
                            data: Object.values(statusStats),
                            backgroundColor: ['#28a745', '#ffc107', '#dc3545']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    font: { size: 10 }
                                }
                            }
                        }
                    }
                });
            }

            renderPerformanceChart() {
                const ctx = document.getElementById('performanceChart').getContext('2d');
                const sentCampaigns = this.campaigns.filter(c => c.status === 'sent');

                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: sentCampaigns.map(c => new Date(c.sentAt).toLocaleDateString()),
                        datasets: [
                            {
                                label: 'Open Rate (%)',
                                data: sentCampaigns.map(c => Math.round((c.opens / c.recipients) * 100)),
                                borderColor: '#007bff',
                                backgroundColor: 'rgba(0, 123, 255, 0.1)',
                                tension: 0.4
                            },
                            {
                                label: 'Click Rate (%)',
                                data: sentCampaigns.map(c => Math.round((c.clicks / c.recipients) * 100)),
                                borderColor: '#28a745',
                                backgroundColor: 'rgba(40, 167, 69, 0.1)',
                                tension: 0.4
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100
                            }
                        }
                    }
                });
            }

            renderGrowthChart() {
                const ctx = document.getElementById('growthChart').getContext('2d');
                
                // Mock growth data
                const growthData = [
                    { month: 'Oct', subscribers: 850 },
                    { month: 'Nov', subscribers: 920 },
                    { month: 'Dec', subscribers: 1100 },
                    { month: 'Jan', subscribers: 1250 }
                ];

                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: growthData.map(d => d.month),
                        datasets: [{
                            label: 'Subscribers',
                            data: growthData.map(d => d.subscribers),
                            borderColor: '#17a2b8',
                            backgroundColor: 'rgba(23, 162, 184, 0.1)',
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: false
                            }
                        }
                    }
                });
            }

            updateMetricRings() {
                this.updateProgressRing('openRateProgress', 65);
                this.updateProgressRing('clickRateProgress', 12);
                this.updateProgressRing('unsubscribeRateProgress', 2);

                document.getElementById('openRateMetric').textContent = '65%';
                document.getElementById('clickRateMetric').textContent = '12%';
                document.getElementById('unsubscribeRateMetric').textContent = '2%';
            }

            updateProgressRing(elementId, percentage) {
                const circle = document.getElementById(elementId);
                const circumference = 2 * Math.PI * 26; // radius = 26
                const offset = circumference - (percentage / 100) * circumference;
                circle.style.strokeDasharray = `${circumference} ${circumference}`;
                circle.style.strokeDashoffset = offset;
            }

            getTimeAgo(dateString) {
                const date = new Date(dateString);
                const now = new Date();
                const diffInDays = Math.floor((now - date) / (1000 * 60 * 60 * 24));

                if (diffInDays === 0) return 'Today';
                if (diffInDays === 1) return '1d';
                if (diffInDays < 7) return `${diffInDays}d`;
                if (diffInDays < 30) return `${Math.floor(diffInDays / 7)}w`;
                return `${Math.floor(diffInDays / 30)}m`;
            }

            filterCampaigns() {
                // Implementation for filtering campaigns
                this.renderCampaigns();
            }

            toggleView(view) {
                this.currentView = view;
                document.getElementById('gridView').classList.toggle('active', view === 'grid');
                document.getElementById('listView').classList.toggle('active', view === 'list');
                this.renderCampaigns();
            }

            showToast(message, type = 'info') {
                const toastContainer = document.getElementById('toastContainer');
                const toastId = 'toast-' + Date.now();
                
                const toastHtml = `
                    <div class="toast" id="${toastId}" role="alert">
                        <div class="toast-header">
                            <i class="fas fa-${type === 'success' ? 'check-circle text-success' : 
                                type === 'error' ? 'exclamation-circle text-danger' : 
                                'info-circle text-info'}"></i>
                            <strong class="me-auto ms-2">Newsletter</strong>
                            <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
                        </div>
                        <div class="toast-body">${message}</div>
                    </div>
                `;
                
                toastContainer.insertAdjacentHTML('beforeend', toastHtml);
                const toast = new bootstrap.Toast(document.getElementById(toastId));
                toast.show();
            }
        }

        // Global functions
        function createNewsletter() {
            const modal = new bootstrap.Modal(document.getElementById('createNewsletterModal'));
            modal.show();
        }

        function saveNewsletter() {
            const form = document.getElementById('newsletterForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const formData = {
                name: document.getElementById('campaignName').value,
                subject: document.getElementById('subjectLine').value,
                fromName: document.getElementById('fromName').value,
                fromEmail: document.getElementById('fromEmail').value,
                template: document.getElementById('templateSelect').value,
                recipients: document.querySelector('input[name="recipients"]:checked').value,
                sendOption: document.querySelector('input[name="sendOption"]:checked').value,
                scheduledDate: document.getElementById('scheduledDate').value,
                content: document.getElementById('emailEditor').innerHTML
            };

            // Simulate API call
            setTimeout(() => {
                newsletterManager.showToast('Newsletter saved successfully!', 'success');
                bootstrap.Modal.getInstance(document.getElementById('createNewsletterModal')).hide();
                newsletterManager.loadData();
            }, 1000);
        }

        function previewNewsletter() {
            // Implementation for newsletter preview
            newsletterManager.showToast('Preview feature coming soon!', 'info');
        }

        function viewCampaign(id) {
            const campaign = newsletterManager.campaigns.find(c => c.id === id);
            if (!campaign) return;

            const modal = new bootstrap.Modal(document.getElementById('campaignDetailsModal'));
            document.getElementById('campaignDetailsTitle').textContent = campaign.name;
            
            const content = `
                <div class="row">
                    <div class="col-md-6">
                        <h6>Campaign Information</h6>
                        <table class="table table-sm">
                            <tr><td><strong>Subject:</strong></td><td>${campaign.subject}</td></tr>
                            <tr><td><strong>Status:</strong></td><td><span class="badge bg-primary">${campaign.status}</span></td></tr>
                            <tr><td><strong>Recipients:</strong></td><td>${campaign.recipients}</td></tr>
                            <tr><td><strong>Created:</strong></td><td>${new Date(campaign.createdAt).toLocaleString()}</td></tr>
                            ${campaign.sentAt ? `<tr><td><strong>Sent:</strong></td><td>${new Date(campaign.sentAt).toLocaleString()}</td></tr>` : ''}
                        </table>
                    </div>
                    <div class="col-md-6">
                        ${campaign.status === 'sent' ? `
                            <h6>Performance Metrics</h6>
                            <div class="row">
                                <div class="col-6">
                                    <div class="metric-card">
                                        <h4>${campaign.opens}</h4>
                                        <small>Opens (${Math.round((campaign.opens / campaign.recipients) * 100)}%)</small>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="metric-card">
                                        <h4>${campaign.clicks}</h4>
                                        <small>Clicks (${Math.round((campaign.clicks / campaign.recipients) * 100)}%)</small>
                                    </div>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
            
            document.getElementById('campaignDetailsContent').innerHTML = content;
            modal.show();
        }

        function editCampaign(id) {
            // Implementation for editing campaign
            newsletterManager.showToast('Edit feature coming soon!', 'info');
        }

        function duplicateCampaign(id) {
            // Implementation for duplicating campaign
            newsletterManager.showToast('Campaign duplicated successfully!', 'success');
        }

        function resendCampaign(id) {
            // Implementation for resending campaign
            newsletterManager.showToast('Campaign resent successfully!', 'success');
        }

        function deleteCampaign(id) {
            if (confirm('Are you sure you want to delete this campaign?')) {
                newsletterManager.showToast('Campaign deleted successfully!', 'success');
            }
        }

        function manageSubscribers() {
            // Switch to subscribers tab
            const subscribersTab = document.getElementById('subscribers-tab');
            subscribersTab.click();
        }

        function viewTemplates() {
            // Switch to templates tab
            const templatesTab = document.getElementById('templates-tab');
            templatesTab.click();
        }

        function addSubscriber() {
            const modal = new bootstrap.Modal(document.getElementById('addSubscriberModal'));
            modal.show();
        }

        function saveSubscriber() {
            const form = document.getElementById('subscriberForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            // Simulate API call
            setTimeout(() => {
                newsletterManager.showToast('Subscriber added successfully!', 'success');
                bootstrap.Modal.getInstance(document.getElementById('addSubscriberModal')).hide();
                newsletterManager.loadSubscribers();
            }, 1000);
        }

        function editSubscriber(id) {
            // Implementation for editing subscriber
            newsletterManager.showToast('Edit subscriber feature coming soon!', 'info');
        }

        function deleteSubscriber(id) {
            if (confirm('Are you sure you want to delete this subscriber?')) {
                newsletterManager.showToast('Subscriber deleted successfully!', 'success');
            }
        }

        function importSubscribers() {
            // Implementation for importing subscribers
            newsletterManager.showToast('Import feature coming soon!', 'info');
        }

        function createTemplate() {
            // Implementation for creating template
            newsletterManager.showToast('Create template feature coming soon!', 'info');
        }

        function previewTemplate(id) {
            // Implementation for previewing template
            newsletterManager.showToast('Template preview coming soon!', 'info');
        }

        function useTemplate(id) {
            // Implementation for using template
            createNewsletter();
            document.getElementById('templateSelect').value = id;
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                window.location.href = '../auth/login.html';
            }
        }

        // Initialize the newsletter manager when DOM is loaded
        let newsletterManager;
        document.addEventListener('DOMContentLoaded', function() {
            newsletterManager = new NewsletterManager();
        });
    </script>
</body>
</html>

