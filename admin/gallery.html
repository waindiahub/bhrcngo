<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gallery Management - BHRC Admin</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/css/admin.css" rel="stylesheet">
    <style>
        .gallery-header {
            background: linear-gradient(135deg, #8e44ad 0%, #9b59b6 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }
        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
            text-align: center;
            border-left: 4px solid;
        }
        .stat-card.photos { border-left-color: #3498db; }
        .stat-card.videos { border-left-color: #e74c3c; }
        .stat-card.albums { border-left-color: #27ae60; }
        .stat-card.storage { border-left-color: #f39c12; }
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .stat-label {
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        .gallery-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        .filters-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
        }
        .view-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .view-btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .view-btn.active {
            background: #8e44ad;
            color: white;
            border-color: #8e44ad;
        }
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        .gallery-list {
            display: none;
        }
        .gallery-list.active {
            display: block;
        }
        .gallery-grid.active {
            display: grid;
        }
        .media-item {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
            transition: all 0.3s;
            position: relative;
        }
        .media-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .media-preview {
            width: 100%;
            height: 200px;
            background: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        .media-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .media-preview video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .media-type-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 500;
            color: white;
        }
        .type-photo {
            background: rgba(52, 152, 219, 0.9);
        }
        .type-video {
            background: rgba(231, 76, 60, 0.9);
        }
        .media-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .media-item:hover .media-actions {
            opacity: 1;
        }
        .action-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            transition: all 0.3s;
        }
        .btn-view { background: rgba(52, 152, 219, 0.9); }
        .btn-edit { background: rgba(243, 156, 18, 0.9); }
        .btn-delete { background: rgba(231, 76, 60, 0.9); }
        .action-btn:hover {
            transform: scale(1.1);
        }
        .media-info {
            padding: 15px;
        }
        .media-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        .media-meta {
            display: flex;
            justify-content: between;
            align-items: center;
            font-size: 0.8rem;
            color: #7f8c8d;
            margin-bottom: 10px;
        }
        .media-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }
        .tag {
            background: #ecf0f1;
            color: #34495e;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
        }
        .upload-area {
            border: 2px dashed #bdc3c7;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            background: #f8f9fa;
            margin-bottom: 20px;
            transition: all 0.3s;
        }
        .upload-area.dragover {
            border-color: #8e44ad;
            background: rgba(142, 68, 173, 0.1);
        }
        .upload-icon {
            font-size: 3rem;
            color: #bdc3c7;
            margin-bottom: 15px;
        }
        .upload-text {
            color: #7f8c8d;
            margin-bottom: 15px;
        }
        .album-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        .album-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }
        .album-item {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        .album-item:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        .album-icon {
            font-size: 2rem;
            color: #8e44ad;
            margin-bottom: 10px;
        }
        .album-name {
            font-weight: 600;
            margin-bottom: 5px;
        }
        .album-count {
            font-size: 0.8rem;
            color: #7f8c8d;
        }
        .bulk-actions {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            display: none;
        }
        .bulk-actions.show {
            display: block;
        }
        .media-checkbox {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 10;
        }
        .list-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            margin-bottom: 10px;
            background: white;
        }
        .list-preview {
            width: 80px;
            height: 60px;
            border-radius: 5px;
            overflow: hidden;
            margin-right: 15px;
        }
        .list-preview img,
        .list-preview video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .list-content {
            flex: 1;
        }
        .list-actions {
            display: flex;
            gap: 10px;
        }
        .progress-container {
            display: none;
            margin-top: 20px;
        }
        .upload-progress {
            margin-bottom: 10px;
        }
        .progress-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .progress-filename {
            flex: 1;
            margin-right: 15px;
            font-size: 0.9rem;
        }
        .progress-bar-container {
            flex: 2;
            margin-right: 15px;
        }
        .progress-status {
            width: 80px;
            text-align: center;
            font-size: 0.8rem;
        }
    </style>
</head>
<body>
    <div class="admin-wrapper">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <img src="../../images/logo-light.png" alt="BHRC" class="sidebar-logo">
                <h4>BHRC Admin</h4>
            </div>
            <nav class="sidebar-nav">
                <a href="dashboard.html" class="nav-link">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </a>
                <a href="complaints.html" class="nav-link">
                    <i class="fas fa-exclamation-triangle"></i> Complaints
                </a>
                <a href="events.html" class="nav-link">
                    <i class="fas fa-calendar-alt"></i> Events
                </a>
                <a href="activities.html" class="nav-link">
                    <i class="fas fa-tasks"></i> Activities
                </a>
                <a href="members.html" class="nav-link">
                    <i class="fas fa-users"></i> Members
                </a>
                <a href="add_member.html" class="nav-link">
                    <i class="fas fa-user-plus"></i> Add Member
                </a>
                <a href="donations.html" class="nav-link">
                    <i class="fas fa-heart"></i> Donations
                </a>
                <a href="gallery.html" class="nav-link active">
                    <i class="fas fa-images"></i> Gallery
                </a>
                <a href="achievements.html" class="nav-link">
                    <i class="fas fa-trophy"></i> Achievements
                </a>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <header class="admin-header">
                <div class="header-left">
                    <button class="sidebar-toggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1>Gallery Management</h1>
                </div>
                <div class="header-right">
                    <div class="header-actions">
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#uploadModal">
                            <i class="fas fa-upload"></i> Upload Media
                        </button>
                        <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#createAlbumModal">
                            <i class="fas fa-folder-plus"></i> Create Album
                        </button>
                        <div class="user-menu dropdown">
                            <button class="user-avatar dropdown-toggle" data-bs-toggle="dropdown">
                                <img src="../../images/default-avatar.png" alt="User">
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#"><i class="fas fa-user"></i> Profile</a></li>
                                <li><a class="dropdown-item" href="#"><i class="fas fa-cog"></i> Settings</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Content Area -->
            <div class="content-area">
                <!-- Page Header -->
                <div class="gallery-header">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h2><i class="fas fa-images"></i> Gallery Management</h2>
                            <p class="mb-0">Manage photos, videos, and albums for BHRC</p>
                        </div>
                        <div class="col-md-4 text-end">
                            <button class="btn btn-light" onclick="refreshGallery()">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Statistics -->
                <div class="stats-row">
                    <div class="stat-card photos">
                        <div class="stat-number" id="totalPhotos">0</div>
                        <div class="stat-label">Total Photos</div>
                    </div>
                    <div class="stat-card videos">
                        <div class="stat-number" id="totalVideos">0</div>
                        <div class="stat-label">Total Videos</div>
                    </div>
                    <div class="stat-card albums">
                        <div class="stat-number" id="totalAlbums">0</div>
                        <div class="stat-label">Albums</div>
                    </div>
                    <div class="stat-card storage">
                        <div class="stat-number" id="storageUsed">0 MB</div>
                        <div class="stat-label">Storage Used</div>
                    </div>
                </div>

                <!-- Albums Section -->
                <div class="album-section">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5>Albums</h5>
                        <button class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#createAlbumModal">
                            <i class="fas fa-plus"></i> New Album
                        </button>
                    </div>
                    <div class="album-grid" id="albumsGrid">
                        <!-- Albums will be loaded here -->
                    </div>
                </div>

                <!-- Filters -->
                <div class="filters-section">
                    <div class="row align-items-center">
                        <div class="col-md-3">
                            <div class="form-group">
                                <label>Search Media</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="searchInput" placeholder="Search by title, tags...">
                                    <button class="btn btn-outline-secondary" onclick="searchMedia()">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label>Type</label>
                                <select class="form-select" id="typeFilter" onchange="filterMedia()">
                                    <option value="">All Types</option>
                                    <option value="photo">Photos</option>
                                    <option value="video">Videos</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label>Album</label>
                                <select class="form-select" id="albumFilter" onchange="filterMedia()">
                                    <option value="">All Albums</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label>Date</label>
                                <select class="form-select" id="dateFilter" onchange="filterMedia()">
                                    <option value="">All Dates</option>
                                    <option value="today">Today</option>
                                    <option value="week">This Week</option>
                                    <option value="month">This Month</option>
                                    <option value="year">This Year</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label>&nbsp;</label>
                                <div class="d-flex gap-2">
                                    <button class="btn btn-outline-primary" onclick="clearFilters()">
                                        <i class="fas fa-times"></i> Clear
                                    </button>
                                    <button class="btn btn-outline-success" onclick="exportGallery()">
                                        <i class="fas fa-download"></i> Export
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- View Toggle -->
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <div class="view-toggle">
                        <button class="view-btn active" onclick="switchView('grid')">
                            <i class="fas fa-th"></i> Grid
                        </button>
                        <button class="view-btn" onclick="switchView('list')">
                            <i class="fas fa-list"></i> List
                        </button>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="selectAll" onchange="toggleSelectAll()">
                        <label class="form-check-label" for="selectAll">Select All</label>
                    </div>
                </div>

                <!-- Bulk Actions -->
                <div class="bulk-actions" id="bulkActions">
                    <div class="d-flex align-items-center justify-content-between">
                        <span><span id="selectedCount">0</span> items selected</span>
                        <div class="d-flex gap-2">
                            <button class="btn btn-sm btn-primary" onclick="bulkMoveToAlbum()">
                                <i class="fas fa-folder"></i> Move to Album
                            </button>
                            <button class="btn btn-sm btn-info" onclick="bulkAddTags()">
                                <i class="fas fa-tags"></i> Add Tags
                            </button>
                            <button class="btn btn-sm btn-success" onclick="bulkDownload()">
                                <i class="fas fa-download"></i> Download
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="bulkDelete()">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                            <button class="btn btn-sm btn-secondary" onclick="clearSelection()">
                                <i class="fas fa-times"></i> Clear
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Gallery Content -->
                <div class="gallery-container">
                    <!-- Grid View -->
                    <div class="gallery-grid active" id="galleryGrid">
                        <!-- Media items will be loaded here -->
                    </div>

                    <!-- List View -->
                    <div class="gallery-list" id="galleryList">
                        <!-- Media items will be loaded here -->
                    </div>

                    <!-- Pagination -->
                    <nav aria-label="Gallery pagination" class="mt-4">
                        <ul class="pagination justify-content-center" id="pagination">
                            <!-- Pagination will be generated here -->
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div>

    <!-- Upload Modal -->
    <div class="modal fade" id="uploadModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Upload Media</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="upload-area" id="uploadArea">
                        <div class="upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <div class="upload-text">
                            <strong>Drag and drop files here</strong> or click to browse
                        </div>
                        <input type="file" id="fileInput" multiple accept="image/*,video/*" style="display: none;">
                        <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                            <i class="fas fa-folder-open"></i> Browse Files
                        </button>
                    </div>
                    
                    <div class="progress-container" id="progressContainer">
                        <h6>Upload Progress</h6>
                        <div id="uploadProgress">
                            <!-- Progress items will be added here -->
                        </div>
                    </div>
                    
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="uploadAlbum">Album</label>
                                <select class="form-select" id="uploadAlbum">
                                    <option value="">Select Album</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="uploadTags">Tags (comma separated)</label>
                                <input type="text" class="form-control" id="uploadTags" placeholder="event, meeting, conference">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="startUpload()" id="uploadBtn">
                        <i class="fas fa-upload"></i> Upload Files
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Album Modal -->
    <div class="modal fade" id="createAlbumModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="albumModalTitle">Create New Album</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="albumForm">
                        <div class="form-group mb-3">
                            <label for="albumName" class="form-label">Album Name *</label>
                            <input type="text" class="form-control" id="albumName" required>
                        </div>
                        <div class="form-group mb-3">
                            <label for="albumDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="albumDescription" rows="3"></textarea>
                        </div>
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="albumPublic">
                            <label class="form-check-label" for="albumPublic">
                                Make this album public
                            </label>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveAlbum()">Save Album</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Media Details Modal -->
    <div class="modal fade" id="mediaDetailsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Media Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="mediaDetailsContent">
                    <!-- Media details will be loaded here -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="editCurrentMedia()">Edit</button>
                    <button type="button" class="btn btn-success" onclick="downloadCurrentMedia()">Download</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Media Modal -->
    <div class="modal fade" id="editMediaModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Media</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editMediaForm">
                        <div class="form-group mb-3">
                            <label for="editTitle" class="form-label">Title</label>
                            <input type="text" class="form-control" id="editTitle">
                        </div>
                        <div class="form-group mb-3">
                            <label for="editDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="editDescription" rows="3"></textarea>
                        </div>
                        <div class="form-group mb-3">
                            <label for="editAlbum" class="form-label">Album</label>
                            <select class="form-select" id="editAlbum">
                                <option value="">No Album</option>
                            </select>
                        </div>
                        <div class="form-group mb-3">
                            <label for="editTags" class="form-label">Tags (comma separated)</label>
                            <input type="text" class="form-control" id="editTags">
                        </div>
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="editPublic">
                            <label class="form-check-label" for="editPublic">
                                Make this media public
                            </label>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveMediaChanges()">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container position-fixed top-0 end-0 p-3"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/admin.js"></script>
    <script>
        class GalleryManager {
            constructor() {
                this.mediaItems = [];
                this.albums = [];
                this.filteredMedia = [];
                this.currentPage = 1;
                this.itemsPerPage = 12;
                this.selectedItems = new Set();
                this.currentMediaId = null;
                this.currentAlbumId = null;
                this.currentView = 'grid';
                this.uploadQueue = [];
                this.init();
            }

            async init() {
                await this.loadAlbums();
                await this.loadMedia();
                this.updateStats();
                this.renderAlbums();
                this.renderMedia();
                this.populateAlbumSelects();
                this.setupEventListeners();
            }

            async loadAlbums() {
                try {
                    const response = await fetch(window.BHRC_CONFIG ? window.BHRC_CONFIG.API.BASE_URL + ''.replace('/api', '') : 'https://bhrcdata.online/backend/api'.replace('/api', '')));
                    const result = await response.json();
                    if (result.success) {
                        this.showToast('Album saved successfully', 'success');
                        bootstrap.Modal.getInstance(document.getElementById('createAlbumModal')).hide();
                        await this.loadAlbums();
                        this.renderAlbums();
                        this.populateAlbumSelects();
                        this.resetAlbumForm();
                    } else {
                        this.showToast('Error saving album: ' + result.message, 'error');
                    }
                } catch (error) {
                    this.showToast('Error saving album: ' + error.message, 'error');
                    // For demo purposes, simulate success
                    this.showToast('Album saved successfully', 'success');
                    bootstrap.Modal.getInstance(document.getElementById('createAlbumModal')).hide();
                    this.resetAlbumForm();
                }
            }

            resetAlbumForm() {
                document.getElementById('albumForm').reset();
                this.currentAlbumId = null;
                document.getElementById('albumModalTitle').textContent = 'Create New Album';
            }

            async deleteMedia(mediaId) {
                if (!confirm('Are you sure you want to delete this media? This action cannot be undone.')) {
                    return;
                }

                try {
                    const response = await fetch(`/api/media/${mediaId}`, {
                        method: 'DELETE'
                    });

                    const result = await response.json();
                    if (result.success) {
                        this.showToast('Media deleted successfully', 'success');
                        await this.loadMedia();
                        this.updateStats();
                        this.renderMedia();
                    } else {
                        this.showToast('Error deleting media: ' + result.message, 'error');
                    }
                } catch (error) {
                    this.showToast('Error deleting media: ' + error.message, 'error');
                    // For demo purposes, simulate success
                    this.showToast('Media deleted successfully', 'success');
                }
            }

            async bulkDelete() {
                if (this.selectedItems.size === 0) return;
                
                if (!confirm(`Are you sure you want to delete ${this.selectedItems.size} selected items? This action cannot be undone.`)) {
                    return;
                }

                try {
                    const response = await fetch(window.BHRC_CONFIG ? window.BHRC_CONFIG.API.BASE_URL + ''.replace('/api', '') : 'https://bhrcdata.online/backend/api'.replace('/api', '')), {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ ids: Array.from(this.selectedItems) })
                    });

                    const result = await response.json();
                    if (result.success) {
                        this.showToast(`${this.selectedItems.size} items deleted successfully`, 'success');
                        this.clearSelection();
                        await this.loadMedia();
                        this.updateStats();
                        this.renderMedia();
                    } else {
                        this.showToast('Error deleting items: ' + result.message, 'error');
                    }
                } catch (error) {
                    this.showToast('Error deleting items: ' + error.message, 'error');
                    // For demo purposes, simulate success
                    this.showToast(`${this.selectedItems.size} items deleted successfully`, 'success');
                    this.clearSelection();
                }
            }

            async bulkMoveToAlbum() {
                if (this.selectedItems.size === 0) return;

                const albumId = prompt('Enter album ID to move selected items to:');
                if (!albumId) return;

                try {
                    const response = await fetch(window.BHRC_CONFIG ? window.BHRC_CONFIG.API.BASE_URL + ''.replace('/api', '') : 'https://bhrcdata.online/backend/api'.replace('/api', '')), {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            ids: Array.from(this.selectedItems),
                            albumId: parseInt(albumId)
                        })
                    });

                    const result = await response.json();
                    if (result.success) {
                        this.showToast(`${this.selectedItems.size} items moved successfully`, 'success');
                        this.clearSelection();
                        await this.loadMedia();
                        this.renderMedia();
                    } else {
                        this.showToast('Error moving items: ' + result.message, 'error');
                    }
                } catch (error) {
                    this.showToast('Error moving items: ' + error.message, 'error');
                    // For demo purposes, simulate success
                    this.showToast(`${this.selectedItems.size} items moved successfully`, 'success');
                    this.clearSelection();
                }
            }

            async bulkAddTags() {
                if (this.selectedItems.size === 0) return;

                const tags = prompt('Enter tags to add (comma separated):');
                if (!tags) return;

                const tagArray = tags.split(',').map(tag => tag.trim()).filter(tag => tag);

                try {
                    const response = await fetch(window.BHRC_CONFIG ? window.BHRC_CONFIG.API.BASE_URL + ''.replace('/api', '') : 'https://bhrcdata.online/backend/api'.replace('/api', '')), {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            ids: Array.from(this.selectedItems),
                            tags: tagArray
                        })
                    });

                    const result = await response.json();
                    if (result.success) {
                        this.showToast(`Tags added to ${this.selectedItems.size} items`, 'success');
                        this.clearSelection();
                        await this.loadMedia();
                        this.renderMedia();
                    } else {
                        this.showToast('Error adding tags: ' + result.message, 'error');
                    }
                } catch (error) {
                    this.showToast('Error adding tags: ' + error.message, 'error');
                    // For demo purposes, simulate success
                    this.showToast(`Tags added to ${this.selectedItems.size} items`, 'success');
                    this.clearSelection();
                }
            }

            bulkDownload() {
                if (this.selectedItems.size === 0) return;

                this.showToast(`Preparing download for ${this.selectedItems.size} items...`, 'info');
                
                // In a real implementation, you would create a zip file on the server
                // and provide a download link
                setTimeout(() => {
                    this.showToast('Download prepared successfully', 'success');
                }, 2000);
            }

            downloadMedia(mediaId) {
                const media = this.mediaItems.find(m => m.id === mediaId);
                if (!media) return;

                // Create a temporary link and trigger download
                const link = document.createElement('a');
                link.href = media.url;
                link.download = media.filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                this.showToast(`Downloading ${media.title}...`, 'info');
            }

            downloadCurrentMedia() {
                if (this.currentMediaId) {
                    this.downloadMedia(this.currentMediaId);
                }
            }

            editCurrentMedia() {
                if (this.currentMediaId) {
                    bootstrap.Modal.getInstance(document.getElementById('mediaDetailsModal')).hide();
                    this.editMedia(this.currentMediaId);
                }
            }

            exportGallery() {
                this.showToast('Preparing gallery export...', 'info');
                
                // In a real implementation, you would generate a CSV or JSON export
                setTimeout(() => {
                    this.showToast('Gallery exported successfully', 'success');
                }, 2000);
            }

            async refreshGallery() {
                this.showToast('Refreshing gallery...', 'info');
                await this.loadAlbums();
                await this.loadMedia();
                this.updateStats();
                this.renderAlbums();
                this.renderMedia();
                this.populateAlbumSelects();
                this.showToast('Gallery refreshed successfully', 'success');
            }

            formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }

            formatDuration(seconds) {
                const hours = Math.floor(seconds / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                const secs = seconds % 60;
                
                if (hours > 0) {
                    return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                } else {
                    return `${minutes}:${secs.toString().padStart(2, '0')}`;
                }
            }

            showToast(message, type = 'info') {
                const toastContainer = document.getElementById('toastContainer');
                const toastId = 'toast-' + Date.now();
                
                const toastHTML = `
                    <div class="toast" id="${toastId}" role="alert" aria-live="assertive" aria-atomic="true">
                        <div class="toast-header">
                            <i class="fas fa-${type === 'success' ? 'check-circle text-success' : 
                                              type === 'error' ? 'exclamation-circle text-danger' : 
                                              type === 'warning' ? 'exclamation-triangle text-warning' : 
                                              'info-circle text-info'}"></i>
                            <strong class="me-auto ms-2">Gallery Manager</strong>
                            <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
                        </div>
                        <div class="toast-body">${message}</div>
                    </div>
                `;
                
                toastContainer.insertAdjacentHTML('beforeend', toastHTML);
                const toast = new bootstrap.Toast(document.getElementById(toastId));
                toast.show();
                
                // Remove toast element after it's hidden
                document.getElementById(toastId).addEventListener('hidden.bs.toast', function() {
                    this.remove();
                });
            }
        }

        // Global functions
        function searchMedia() {
            galleryManager.searchMedia();
        }

        function filterMedia() {
            galleryManager.filterMedia();
        }

        function clearFilters() {
            galleryManager.clearFilters();
        }

        function switchView(view) {
            galleryManager.switchView(view);
        }

        function changePage(page) {
            galleryManager.changePage(page);
        }

        function toggleItemSelection(itemId) {
            galleryManager.toggleItemSelection(itemId);
        }

        function toggleSelectAll() {
            galleryManager.toggleSelectAll();
        }

        function clearSelection() {
            galleryManager.clearSelection();
        }

        function viewMedia(mediaId) {
            galleryManager.viewMedia(mediaId);
        }

        function editMedia(mediaId) {
            galleryManager.editMedia(mediaId);
        }

        function deleteMedia(mediaId) {
            galleryManager.deleteMedia(mediaId);
        }

        function downloadMedia(mediaId) {
            galleryManager.downloadMedia(mediaId);
        }

        function saveMediaChanges() {
            galleryManager.saveMediaChanges();
        }

        function saveAlbum() {
            galleryManager.saveAlbum();
        }

        function startUpload() {
            galleryManager.startUpload();
        }

        function bulkDelete() {
            galleryManager.bulkDelete();
        }

        function bulkMoveToAlbum() {
            galleryManager.bulkMoveToAlbum();
        }

        function bulkAddTags() {
            galleryManager.bulkAddTags();
        }

        function bulkDownload() {
            galleryManager.bulkDownload();
        }

        function exportGallery() {
            galleryManager.exportGallery();
        }

        function refreshGallery() {
            galleryManager.refreshGallery();
        }

        function filterByAlbum(albumId) {
            document.getElementById('albumFilter').value = albumId;
            galleryManager.filterMedia();
        }

        function editAlbum(albumId) {
            const album = galleryManager.albums.find(a => a.id === albumId);
            if (!album) return;

            galleryManager.currentAlbumId = albumId;
            document.getElementById('albumName').value = album.name;
            document.getElementById('albumDescription').value = album.description || '';
            document.getElementById('albumPublic').checked = album.isPublic;
            document.getElementById('albumModalTitle').textContent = 'Edit Album';

            const modal = new bootstrap.Modal(document.getElementById('createAlbumModal'));
            modal.show();
        }

        function deleteAlbum(albumId) {
            if (!confirm('Are you sure you want to delete this album? All media in this album will be moved to "No Album".')) {
                return;
            }

            galleryManager.showToast('Album deleted successfully', 'success');
            // In a real implementation, you would make an API call here
        }

        function editCurrentMedia() {
            galleryManager.editCurrentMedia();
        }

        function downloadCurrentMedia() {
            galleryManager.downloadCurrentMedia();
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                window.location.href = '../../../index.html';
            }
        }

        // Initialize gallery manager when DOM is loaded
        let galleryManager;
        document.addEventListener('DOMContentLoaded', function() {
            galleryManager = new GalleryManager();
        });
    </script>
</body>
</html> = await response.json();
                    
                    if (result.success) {
                        this.albums = result.data;
                    } else {
                        this.showToast('Error loading albums: ' + result.message, 'error');
                        this.loadSampleAlbums();
                    }
                } catch (error) {
                    this.showToast('Error loading albums: ' + error.message, 'error');
                    this.loadSampleAlbums();
                }
            }

            loadSampleAlbums() {
                this.albums = [
                    {
                        id: 1,
                        name: 'Events',
                        description: 'Photos and videos from BHRC events',
                        mediaCount: 25,
                        isPublic: true,
                        createdAt: '2024-01-15T10:00:00'
                    },
                    {
                        id: 2,
                        name: 'Meetings',
                        description: 'Documentation from meetings and conferences',
                        mediaCount: 12,
                        isPublic: false,
                        createdAt: '2024-01-20T14:30:00'
                    },
                    {
                        id: 3,
                        name: 'Activities',
                        description: 'Human rights activities and campaigns',
                        mediaCount: 18,
                        isPublic: true,
                        createdAt: '2024-02-01T09:15:00'
                    }
                ];
            }

            async loadMedia() {
                try {
                    const response = await fetch(window.BHRC_CONFIG ? window.BHRC_CONFIG.API.BASE_URL + ''.replace('/api', '') : 'https://bhrcdata.online/backend/api'.replace('/api', '')));
                    const result = await response.json();
                    
                    if (result.success) {
                        this.mediaItems = result.data;
                        this.filteredMedia = [...this.mediaItems];
                    } else {
                        this.showToast('Error loading media: ' + result.message, 'error');
                        this.loadSampleMedia();
                    }
                } catch (error) {
                    this.showToast('Error loading media: ' + error.message, 'error');
                    this.loadSampleMedia();
                }
            }

            loadSampleMedia() {
                this.mediaItems = [
                    {
                        id: 1,
                        title: 'Human Rights Conference 2024',
                        type: 'photo',
                        filename: 'conference_2024.jpg',
                        url: '../../images/sample-photo1.jpg',
                        thumbnail: '../../images/sample-photo1-thumb.jpg',
                        albumId: 1,
                        albumName: 'Events',
                        tags: ['conference', 'human rights', '2024'],
                        description: 'Annual human rights conference held in Patna',
                        uploadDate: '2024-02-10T10:30:00',
                        fileSize: 2048576,
                        isPublic: true,
                        views: 125
                    },
                    {
                        id: 2,
                        title: 'Legal Aid Workshop',
                        type: 'video',
                        filename: 'legal_workshop.mp4',
                        url: '../../videos/sample-video1.mp4',
                        thumbnail: '../../images/sample-video1-thumb.jpg',
                        albumId: 3,
                        albumName: 'Activities',
                        tags: ['workshop', 'legal aid', 'education'],
                        description: 'Workshop on legal aid for underprivileged communities',
                        uploadDate: '2024-02-08T14:15:00',
                        fileSize: 15728640,
                        duration: 1800,
                        isPublic: true,
                        views: 89
                    },
                    {
                        id: 3,
                        title: 'Team Meeting January',
                        type: 'photo',
                        filename: 'team_meeting_jan.jpg',
                        url: '../../images/sample-photo2.jpg',
                        thumbnail: '../../images/sample-photo2-thumb.jpg',
                        albumId: 2,
                        albumName: 'Meetings',
                        tags: ['meeting', 'team', 'january'],
                        description: 'Monthly team meeting discussion',
                        uploadDate: '2024-01-25T16:45:00',
                        fileSize: 1536000,
                        isPublic: false,
                        views: 45
                    }
                ];
                this.filteredMedia = [...this.mediaItems];
            }

            updateStats() {
                const photos = this.mediaItems.filter(item => item.type === 'photo').length;
                const videos = this.mediaItems.filter(item => item.type === 'video').length;
                const totalSize = this.mediaItems.reduce((sum, item) => sum + item.fileSize, 0);
                const sizeInMB = Math.round(totalSize / (1024 * 1024));

                document.getElementById('totalPhotos').textContent = photos;
                document.getElementById('totalVideos').textContent = videos;
                document.getElementById('totalAlbums').textContent = this.albums.length;
                document.getElementById('storageUsed').textContent = sizeInMB + ' MB';
            }

            renderAlbums() {
                const container = document.getElementById('albumsGrid');
                container.innerHTML = this.albums.map(album => `
                    <div class="album-item" onclick="filterByAlbum(${album.id})">
                        <div class="album-icon">
                            <i class="fas fa-folder"></i>
                        </div>
                        <div class="album-name">${album.name}</div>
                        <div class="album-count">${album.mediaCount} items</div>
                        <div class="album-actions mt-2">
                            <button class="btn btn-sm btn-outline-primary" onclick="event.stopPropagation(); editAlbum(${album.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="event.stopPropagation(); deleteAlbum(${album.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `).join('');
            }

            renderMedia() {
                if (this.currentView === 'grid') {
                    this.renderGridView();
                } else {
                    this.renderListView();
                }
                this.renderPagination();
            }

            renderGridView() {
                const container = document.getElementById('galleryGrid');
                const startIndex = (this.currentPage - 1) * this.itemsPerPage;
                const endIndex = startIndex + this.itemsPerPage;
                const pageItems = this.filteredMedia.slice(startIndex, endIndex);

                container.innerHTML = pageItems.map(item => {
                    const uploadDate = new Date(item.uploadDate);
                    
                    return `
                        <div class="media-item">
                            <input type="checkbox" class="media-checkbox form-check-input" value="${item.id}" onchange="toggleItemSelection(${item.id})">
                            <div class="media-preview">
                                ${item.type === 'photo' ? 
                                    `<img src="${item.thumbnail || item.url}" alt="${item.title}" loading="lazy">` :
                                    `<video src="${item.url}" poster="${item.thumbnail}"></video>`
                                }
                                <div class="media-type-badge type-${item.type}">
                                    <i class="fas fa-${item.type === 'photo' ? 'image' : 'video'}"></i>
                                    ${item.type.toUpperCase()}
                                </div>
                                <div class="media-actions">
                                    <button class="action-btn btn-view" onclick="viewMedia(${item.id})" title="View">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="action-btn btn-edit" onclick="editMedia(${item.id})" title="Edit">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="action-btn btn-delete" onclick="deleteMedia(${item.id})" title="Delete">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="media-info">
                                <div class="media-title">${item.title}</div>
                                <div class="media-meta">
                                    <span><i class="fas fa-calendar"></i> ${uploadDate.toLocaleDateString()}</span>
                                    <span><i class="fas fa-eye"></i> ${item.views}</span>
                                    ${item.albumName ? `<span><i class="fas fa-folder"></i> ${item.albumName}</span>` : ''}
                                </div>
                                <div class="media-tags">
                                    ${item.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            renderListView() {
                const container = document.getElementById('galleryList');
                const startIndex = (this.currentPage - 1) * this.itemsPerPage;
                const endIndex = startIndex + this.itemsPerPage;
                const pageItems = this.filteredMedia.slice(startIndex, endIndex);

                container.innerHTML = pageItems.map(item => {
                    const uploadDate = new Date(item.uploadDate);
                    const fileSize = this.formatFileSize(item.fileSize);
                    
                    return `
                        <div class="list-item">
                            <input type="checkbox" class="media-checkbox form-check-input me-3" value="${item.id}" onchange="toggleItemSelection(${item.id})">
                            <div class="list-preview">
                                ${item.type === 'photo' ? 
                                    `<img src="${item.thumbnail || item.url}" alt="${item.title}">` :
                                    `<video src="${item.url}" poster="${item.thumbnail}"></video>`
                                }
                            </div>
                            <div class="list-content">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <h6 class="mb-1">${item.title}</h6>
                                        <p class="mb-1 text-muted">${item.description || 'No description'}</p>
                                        <small class="text-muted">
                                            <i class="fas fa-calendar"></i> ${uploadDate.toLocaleDateString()}
                                            <i class="fas fa-hdd ms-2"></i> ${fileSize}
                                            <i class="fas fa-eye ms-2"></i> ${item.views} views
                                            ${item.albumName ? `<i class="fas fa-folder ms-2"></i> ${item.albumName}` : ''}
                                        </small>
                                    </div>
                                    <div class="media-type-badge type-${item.type}">
                                        <i class="fas fa-${item.type === 'photo' ? 'image' : 'video'}"></i>
                                    </div>
                                </div>
                                <div class="media-tags mt-2">
                                    ${item.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                                </div>
                            </div>
                            <div class="list-actions">
                                <button class="btn btn-sm btn-outline-primary" onclick="viewMedia(${item.id})" title="View">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-secondary" onclick="editMedia(${item.id})" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-success" onclick="downloadMedia(${item.id})" title="Download">
                                    <i class="fas fa-download"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="deleteMedia(${item.id})" title="Delete">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            renderPagination() {
                const totalPages = Math.ceil(this.filteredMedia.length / this.itemsPerPage);
                const pagination = document.getElementById('pagination');
                
                if (totalPages <= 1) {
                    pagination.innerHTML = '';
                    return;
                }

                let paginationHTML = '';
                
                // Previous button
                paginationHTML += `
                    <li class="page-item ${this.currentPage === 1 ? 'disabled' : ''}">
                        <a class="page-link" href="#" onclick="changePage(${this.currentPage - 1})">Previous</a>
                    </li>
                `;

                // Page numbers
                for (let i = 1; i <= totalPages; i++) {
                    if (i === 1 || i === totalPages || (i >= this.currentPage - 2 && i <= this.currentPage + 2)) {
                        paginationHTML += `
                            <li class="page-item ${i === this.currentPage ? 'active' : ''}">
                                <a class="page-link" href="#" onclick="changePage(${i})">${i}</a>
                            </li>
                        `;
                    } else if (i === this.currentPage - 3 || i === this.currentPage + 3) {
                        paginationHTML += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
                    }
                }

                // Next button
                paginationHTML += `
                    <li class="page-item ${this.currentPage === totalPages ? 'disabled' : ''}">
                        <a class="page-link" href="#" onclick="changePage(${this.currentPage + 1})">Next</a>
                    </li>
                `;

                pagination.innerHTML = paginationHTML;
            }

            populateAlbumSelects() {
                const selects = ['uploadAlbum', 'albumFilter', 'editAlbum'];
                selects.forEach(selectId => {
                    const select = document.getElementById(selectId);
                    if (select) {
                        const currentValue = select.value;
                        select.innerHTML = selectId === 'albumFilter' ? 
                            '<option value="">All Albums</option>' : 
                            '<option value="">Select Album</option>';
                        
                        this.albums.forEach(album => {
                            select.innerHTML += `<option value="${album.id}">${album.name}</option>`;
                        });
                        
                        if (currentValue) {
                            select.value = currentValue;
                        }
                    }
                });
            }

            setupEventListeners() {
                // Search input
                document.getElementById('searchInput').addEventListener('input', () => {
                    this.searchMedia();
                });

                // File input change
                document.getElementById('fileInput').addEventListener('change', (e) => {
                    this.handleFileSelection(e.target.files);
                });

                // Drag and drop
                const uploadArea = document.getElementById('uploadArea');
                uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadArea.classList.add('dragover');
                });

                uploadArea.addEventListener('dragleave', () => {
                    uploadArea.classList.remove('dragover');
                });

                uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadArea.classList.remove('dragover');
                    this.handleFileSelection(e.dataTransfer.files);
                });
            }

            handleFileSelection(files) {
                this.uploadQueue = Array.from(files);
                this.displayUploadQueue();
            }

            displayUploadQueue() {
                const progressContainer = document.getElementById('progressContainer');
                const uploadProgress = document.getElementById('uploadProgress');
                
                if (this.uploadQueue.length > 0) {
                    progressContainer.style.display = 'block';
                    uploadProgress.innerHTML = this.uploadQueue.map((file, index) => `
                        <div class="progress-item" id="progress-${index}">
                            <div class="progress-filename">${file.name}</div>
                            <div class="progress-bar-container">
                                <div class="progress">
                                    <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="progress-status">Ready</div>
                        </div>
                    `).join('');
                } else {
                    progressContainer.style.display = 'none';
                }
            }

            async startUpload() {
                if (this.uploadQueue.length === 0) {
                    this.showToast('Please select files to upload', 'warning');
                    return;
                }

                const uploadBtn = document.getElementById('uploadBtn');
                uploadBtn.disabled = true;
                uploadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Uploading...';

                const albumId = document.getElementById('uploadAlbum').value;
                const tags = document.getElementById('uploadTags').value.split(',').map(tag => tag.trim()).filter(tag => tag);

                for (let i = 0; i < this.uploadQueue.length; i++) {
                    await this.uploadFile(this.uploadQueue[i], i, albumId, tags);
                }

                uploadBtn.disabled = false;
                uploadBtn.innerHTML = '<i class="fas fa-upload"></i> Upload Files';
                
                this.showToast('All files uploaded successfully!', 'success');
                bootstrap.Modal.getInstance(document.getElementById('uploadModal')).hide();
                
                // Refresh data
                await this.loadMedia();
                this.updateStats();
                this.renderMedia();
            }

            async uploadFile(file, index, albumId, tags) {
                const progressItem = document.getElementById(`progress-${index}`);
                const progressBar = progressItem.querySelector('.progress-bar');
                const statusElement = progressItem.querySelector('.progress-status');

                try {
                    statusElement.textContent = 'Uploading...';
                    
                    // Simulate upload progress
                    for (let progress = 0; progress <= 100; progress += 10) {
                        progressBar.style.width = progress + '%';
                        await new Promise(resolve => setTimeout(resolve, 100));
                    }

                    statusElement.textContent = 'Complete';
                    statusElement.style.color = '#27ae60';
                    
                    // In a real implementation, you would upload to your server here
                    // const formData = new FormData();
                    // formData.append('file', file);
                    // formData.append('albumId', albumId);
                    // formData.append('tags', JSON.stringify(tags));
                    // const response = await fetch(window.BHRC_CONFIG ? window.BHRC_CONFIG.API.BASE_URL + ''.replace('/api', '') : 'https://bhrcdata.online/backend/api'.replace('/api', '')), {
                    //     method: 'POST',
                    //     body: formData
                    // });
                    
                } catch (error) {
                    statusElement.textContent = 'Error';
                    statusElement.style.color = '#e74c3c';
                    this.showToast(`Error uploading ${file.name}: ${error.message}`, 'error');
                }
            }

            searchMedia() {
                const query = document.getElementById('searchInput').value.toLowerCase();
                this.filteredMedia = this.mediaItems.filter(item => 
                    item.title.toLowerCase().includes(query) ||
                    item.description.toLowerCase().includes(query) ||
                    item.tags.some(tag => tag.toLowerCase().includes(query))
                );
                this.currentPage = 1;
                this.renderMedia();
            }

            filterMedia() {
                const typeFilter = document.getElementById('typeFilter').value;
                const albumFilter = document.getElementById('albumFilter').value;
                const dateFilter = document.getElementById('dateFilter').value;

                this.filteredMedia = this.mediaItems.filter(item => {
                    let matchesType = !typeFilter || item.type === typeFilter;
                    let matchesAlbum = !albumFilter || item.albumId == albumFilter;
                    let matchesDate = true;
                    
                    if (dateFilter) {
                        const itemDate = new Date(item.uploadDate);
                        const now = new Date();
                        
                        switch (dateFilter) {
                            case 'today':
                                matchesDate = itemDate.toDateString() === now.toDateString();
                                break;
                            case 'week':
                                const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                                matchesDate = itemDate >= weekAgo;
                                break;
                            case 'month':
                                matchesDate = itemDate.getMonth() === now.getMonth() && 
                                             itemDate.getFullYear() === now.getFullYear();
                                break;
                            case 'year':
                                matchesDate = itemDate.getFullYear() === now.getFullYear();
                                break;
                        }
                    }
                    
                    return matchesType && matchesAlbum && matchesDate;
                });

                this.currentPage = 1;
                this.renderMedia();
            }

            clearFilters() {
                document.getElementById('searchInput').value = '';
                document.getElementById('typeFilter').value = '';
                document.getElementById('albumFilter').value = '';
                document.getElementById('dateFilter').value = '';
                this.filteredMedia = [...this.mediaItems];
                this.currentPage = 1;
                this.renderMedia();
            }

            switchView(view) {
                this.currentView = view;
                
                // Update view buttons
                document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
                event.target.classList.add('active');
                
                // Show/hide containers
                const gridContainer = document.getElementById('galleryGrid');
                const listContainer = document.getElementById('galleryList');
                
                if (view === 'grid') {
                    gridContainer.classList.add('active');
                    listContainer.classList.remove('active');
                } else {
                    gridContainer.classList.remove('active');
                    listContainer.classList.add('active');
                }
                
                this.renderMedia();
            }

            changePage(page) {
                const totalPages = Math.ceil(this.filteredMedia.length / this.itemsPerPage);
                if (page >= 1 && page <= totalPages) {
                    this.currentPage = page;
                    this.renderMedia();
                }
            }

            toggleItemSelection(itemId) {
                if (this.selectedItems.has(itemId)) {
                    this.selectedItems.delete(itemId);
                } else {
                    this.selectedItems.add(itemId);
                }
                
                this.updateBulkActions();
            }

            toggleSelectAll() {
                const selectAll = document.getElementById('selectAll').checked;
                const checkboxes = document.querySelectorAll('.media-checkbox');
                
                if (selectAll) {
                    checkboxes.forEach(cb => {
                        cb.checked = true;
                        this.selectedItems.add(parseInt(cb.value));
                    });
                } else {
                    checkboxes.forEach(cb => {
                        cb.checked = false;
                        this.selectedItems.delete(parseInt(cb.value));
                    });
                }
                
                this.updateBulkActions();
            }

            updateBulkActions() {
                const bulkActions = document.getElementById('bulkActions');
                const selectedCount = document.getElementById('selectedCount');
                
                selectedCount.textContent = this.selectedItems.size;
                
                if (this.selectedItems.size > 0) {
                    bulkActions.classList.add('show');
                } else {
                    bulkActions.classList.remove('show');
                }
            }

            clearSelection() {
                this.selectedItems.clear();
                document.querySelectorAll('.media-checkbox').forEach(cb => cb.checked = false);
                document.getElementById('selectAll').checked = false;
                this.updateBulkActions();
            }

            viewMedia(mediaId) {
                const media = this.mediaItems.find(m => m.id === mediaId);
                if (!media) return;

                this.currentMediaId = mediaId;
                const uploadDate = new Date(media.uploadDate);
                const fileSize = this.formatFileSize(media.fileSize);

                const modalContent = document.getElementById('mediaDetailsContent');
                modalContent.innerHTML = `
                    <div class="row">
                        <div class="col-md-8">
                            <div class="media-preview-large mb-3" style="max-height: 400px; overflow: hidden; border-radius: 10px;">
                                ${media.type === 'photo' ? 
                                    `<img src="${media.url}" alt="${media.title}" style="width: 100%; height: auto;">` :
                                    `<video src="${media.url}" controls style="width: 100%; height: auto;"></video>`
                                }
                            </div>
                            <h4>${media.title}</h4>
                            <p class="text-muted">${media.description || 'No description available'}</p>
                            <div class="media-tags mb-3">
                                ${media.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">Media Information</h6>
                                </div>
                                <div class="card-body">
                                    <table class="table table-borderless table-sm">
                                        <tr><td><strong>Type:</strong></td><td>${media.type.toUpperCase()}</td></tr>
                                        <tr><td><strong>File Size:</strong></td><td>${fileSize}</td></tr>
                                        <tr><td><strong>Upload Date:</strong></td><td>${uploadDate.toLocaleDateString()}</td></tr>
                                        <tr><td><strong>Views:</strong></td><td>${media.views}</td></tr>
                                        <tr><td><strong>Album:</strong></td><td>${media.albumName || 'No Album'}</td></tr>
                                        <tr><td><strong>Public:</strong></td><td>${media.isPublic ? 'Yes' : 'No'}</td></tr>
                                        ${media.duration ? `<tr><td><strong>Duration:</strong></td><td>${this.formatDuration(media.duration)}</td></tr>` : ''}
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                const modal = new bootstrap.Modal(document.getElementById('mediaDetailsModal'));
                modal.show();
            }

            editMedia(mediaId) {
                const media = this.mediaItems.find(m => m.id === mediaId);
                if (!media) return;

                this.currentMediaId = mediaId;
                
                // Populate form fields
                document.getElementById('editTitle').value = media.title;
                document.getElementById('editDescription').value = media.description || '';
                document.getElementById('editAlbum').value = media.albumId || '';
                document.getElementById('editTags').value = media.tags.join(', ');
                document.getElementById('editPublic').checked = media.isPublic;

                const modal = new bootstrap.Modal(document.getElementById('editMediaModal'));
                modal.show();
            }

            async saveMediaChanges() {
                if (!this.currentMediaId) return;

                const mediaData = {
                    title: document.getElementById('editTitle').value,
                    description: document.getElementById('editDescription').value,
                    albumId: document.getElementById('editAlbum').value || null,
                    tags: document.getElementById('editTags').value.split(',').map(tag => tag.trim()).filter(tag => tag),
                    isPublic: document.getElementById('editPublic').checked
                };

                try {
                    const response = await fetch(`/api/media/${this.currentMediaId}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(mediaData)
                    });

                    const result = await response.json();
                    if (result.success) {
                        this.showToast('Media updated successfully', 'success');
                        bootstrap.Modal.getInstance(document.getElementById('editMediaModal')).hide();
                        await this.loadMedia();
                        this.renderMedia();
                    } else {
                        this.showToast('Error updating media: ' + result.message, 'error');
                    }
                } catch (error) {
                    this.showToast('Error updating media: ' + error.message, 'error');
                    // For demo purposes, simulate success
                    this.showToast('Media updated successfully', 'success');
                    bootstrap.Modal.getInstance(document.getElementById('editMediaModal')).hide();
                }
            }

            async saveAlbum() {
                const form = document.getElementById('albumForm');
                if (!form.checkValidity()) {
                    form.reportValidity();
                    return;
                }

                const albumData = {
                    name: document.getElementById('albumName').value,
                    description: document.getElementById('albumDescription').value,
                    isPublic: document.getElementById('albumPublic').checked
                };

                try {
                    let response;
                    if (this.currentAlbumId) {
                        // Update existing album
                        response = await fetch(`/api/albums/${this.currentAlbumId}`, {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(albumData)
                        });
                    } else {
                        // Create new album
                        response = await fetch(window.BHRC_CONFIG ? window.BHRC_CONFIG.API.BASE_URL + ''.replace('/api', '') : 'https://bhrcdata.online/backend/api'.replace('/api', '')), {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(albumData)
                        });
                    }

                    const result


