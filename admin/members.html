<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Members Management - BHRC Admin</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/css/admin.css" rel="stylesheet">
    <style>
        .members-header {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }
        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
            text-align: center;
            border-left: 4px solid;
        }
        .stat-card.total { border-left-color: #3498db; }
        .stat-card.active { border-left-color: #27ae60; }
        .stat-card.pending { border-left-color: #f39c12; }
        .stat-card.inactive { border-left-color: #e74c3c; }
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .stat-label {
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        .filters-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
        }
        .members-table-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
        }
        .member-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }
        .member-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        .status-active {
            background: rgba(39, 174, 96, 0.1);
            color: #27ae60;
        }
        .status-pending {
            background: rgba(243, 156, 18, 0.1);
            color: #f39c12;
        }
        .status-inactive {
            background: rgba(231, 76, 60, 0.1);
            color: #e74c3c;
        }
        .action-buttons {
            display: flex;
            gap: 5px;
        }
        .btn-action {
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        .btn-view {
            background: #3498db;
            color: white;
        }
        .btn-edit {
            background: #f39c12;
            color: white;
        }
        .btn-delete {
            background: #e74c3c;
            color: white;
        }
        .bulk-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }
        .member-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
            display: none;
        }
        .member-card.active {
            display: block;
        }
        .member-card-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        .member-card-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin-right: 15px;
            object-fit: cover;
        }
        .member-card-info h5 {
            margin: 0 0 5px 0;
            color: #2c3e50;
        }
        .member-card-info p {
            margin: 0;
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        .member-card-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        .detail-item {
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }
        .detail-item i {
            width: 20px;
            margin-right: 8px;
            color: #3498db;
        }
        .view-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .toggle-btn {
            padding: 8px 15px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .toggle-btn.active {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }
        .export-section {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="admin-wrapper">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <img src="../../images/logo-light.png" alt="BHRC" class="sidebar-logo">
                <h4>BHRC Admin</h4>
            </div>
            <nav class="sidebar-nav">
                <a href="dashboard.html" class="nav-link">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </a>
                <a href="complaints.html" class="nav-link">
                    <i class="fas fa-exclamation-triangle"></i> Complaints
                </a>
                <a href="events.html" class="nav-link">
                    <i class="fas fa-calendar-alt"></i> Events
                </a>
                <a href="activities.html" class="nav-link">
                    <i class="fas fa-tasks"></i> Activities
                </a>
                <a href="members.html" class="nav-link active">
                    <i class="fas fa-users"></i> Members
                </a>
                <a href="add_member.html" class="nav-link">
                    <i class="fas fa-user-plus"></i> Add Member
                </a>
                <a href="donations.html" class="nav-link">
                    <i class="fas fa-heart"></i> Donations
                </a>
                <a href="gallery.html" class="nav-link">
                    <i class="fas fa-images"></i> Gallery
                </a>
                <a href="achievements.html" class="nav-link">
                    <i class="fas fa-trophy"></i> Achievements
                </a>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <header class="admin-header">
                <div class="header-left">
                    <button class="sidebar-toggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1>Members Management</h1>
                </div>
                <div class="header-right">
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="window.location.href='add_member.html'">
                            <i class="fas fa-user-plus"></i> Add Member
                        </button>
                        <div class="user-menu dropdown">
                            <button class="user-avatar dropdown-toggle" data-bs-toggle="dropdown">
                                <img src="../../images/default-avatar.png" alt="User">
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#"><i class="fas fa-user"></i> Profile</a></li>
                                <li><a class="dropdown-item" href="#"><i class="fas fa-cog"></i> Settings</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Content Area -->
            <div class="content-area">
                <!-- Page Header -->
                <div class="members-header">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h2><i class="fas fa-users"></i> Members Management</h2>
                            <p class="mb-0">Manage and monitor all BHRC members</p>
                        </div>
                        <div class="col-md-4 text-end">
                            <button class="btn btn-light" onclick="refreshMembers()">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Statistics -->
                <div class="stats-row">
                    <div class="stat-card total">
                        <div class="stat-number" id="totalMembers">0</div>
                        <div class="stat-label">Total Members</div>
                    </div>
                    <div class="stat-card active">
                        <div class="stat-number" id="activeMembers">0</div>
                        <div class="stat-label">Active Members</div>
                    </div>
                    <div class="stat-card pending">
                        <div class="stat-number" id="pendingMembers">0</div>
                        <div class="stat-label">Pending Approval</div>
                    </div>
                    <div class="stat-card inactive">
                        <div class="stat-number" id="inactiveMembers">0</div>
                        <div class="stat-label">Inactive Members</div>
                    </div>
                </div>

                <!-- Filters and Search -->
                <div class="filters-section">
                    <div class="row align-items-center">
                        <div class="col-md-3">
                            <div class="form-group">
                                <label>Search Members</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="searchInput" placeholder="Search by name, email, phone...">
                                    <button class="btn btn-outline-secondary" onclick="searchMembers()">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label>Status</label>
                                <select class="form-select" id="statusFilter" onchange="filterMembers()">
                                    <option value="">All Status</option>
                                    <option value="active">Active</option>
                                    <option value="pending">Pending</option>
                                    <option value="inactive">Inactive</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label>Membership Type</label>
                                <select class="form-select" id="typeFilter" onchange="filterMembers()">
                                    <option value="">All Types</option>
                                    <option value="regular">Regular</option>
                                    <option value="life">Life Member</option>
                                    <option value="honorary">Honorary</option>
                                    <option value="student">Student</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label>State</label>
                                <select class="form-select" id="stateFilter" onchange="filterMembers()">
                                    <option value="">All States</option>
                                    <option value="Bharatiya">Bharatiya</option>
                                    <option value="jharkhand">Jharkhand</option>
                                    <option value="west-bengal">West Bengal</option>
                                    <option value="uttar-pradesh">Uttar Pradesh</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label>&nbsp;</label>
                                <div class="d-flex gap-2">
                                    <button class="btn btn-outline-primary" onclick="clearFilters()">
                                        <i class="fas fa-times"></i> Clear
                                    </button>
                                    <button class="btn btn-outline-success" onclick="exportMembers()">
                                        <i class="fas fa-download"></i> Export
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- View Toggle -->
                <div class="view-toggle">
                    <button class="toggle-btn active" onclick="switchView('table')" id="tableViewBtn">
                        <i class="fas fa-table"></i> Table View
                    </button>
                    <button class="toggle-btn" onclick="switchView('cards')" id="cardsViewBtn">
                        <i class="fas fa-th-large"></i> Cards View
                    </button>
                </div>

                <!-- Bulk Actions -->
                <div class="bulk-actions" id="bulkActions" style="display: none;">
                    <input type="checkbox" id="selectAll" onchange="toggleSelectAll()">
                    <label for="selectAll">Select All</label>
                    <button class="btn btn-sm btn-success" onclick="bulkApprove()">
                        <i class="fas fa-check"></i> Approve Selected
                    </button>
                    <button class="btn btn-sm btn-warning" onclick="bulkSuspend()">
                        <i class="fas fa-pause"></i> Suspend Selected
                    </button>
                    <button class="btn btn-sm btn-danger" onclick="bulkDelete()">
                        <i class="fas fa-trash"></i> Delete Selected
                    </button>
                    <button class="btn btn-sm btn-info" onclick="bulkExport()">
                        <i class="fas fa-download"></i> Export Selected
                    </button>
                </div>

                <!-- Table View -->
                <div class="members-table-container" id="tableView">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th><input type="checkbox" onchange="toggleSelectAll()"></th>
                                    <th>Member</th>
                                    <th>Contact</th>
                                    <th>Type</th>
                                    <th>Status</th>
                                    <th>Joined</th>
                                    <th>Location</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="membersTableBody">
                                <!-- Members will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Cards View -->
                <div id="cardsView" style="display: none;">
                    <div id="membersCardsContainer">
                        <!-- Member cards will be loaded here -->
                    </div>
                </div>

                <!-- Pagination -->
                <nav aria-label="Members pagination" class="mt-4">
                    <ul class="pagination justify-content-center" id="pagination">
                        <!-- Pagination will be generated here -->
                    </ul>
                </nav>
            </div>
        </div>
    </div>

    <!-- Member Details Modal -->
    <div class="modal fade" id="memberDetailsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Member Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="memberDetailsContent">
                    <!-- Member details will be loaded here -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="editMember()">Edit Member</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container position-fixed top-0 end-0 p-3"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/admin.js"></script>
    <script>
        class MembersManager {
            constructor() {
                this.members = [];
                this.filteredMembers = [];
                this.currentPage = 1;
                this.itemsPerPage = 10;
                this.currentView = 'table';
                this.selectedMembers = new Set();
                this.init();
            }

            async init() {
                await this.loadMembers();
                this.updateStats();
                this.renderMembers();
                this.setupEventListeners();
            }

            async loadMembers() {
                try {
                    const response = await fetch(window.BHRC_CONFIG ? window.BHRC_CONFIG.API.BASE_URL + ''.replace('/api', '') : 'https://bhrcdata.online/backend/api'.replace('/api', '')));
                    const result = await response.json();
                    
                    if (result.success) {
                        this.members = result.data;
                        this.filteredMembers = [...this.members];
                    } else {
                        this.showToast('Error loading members: ' + result.message, 'error');
                        this.loadSampleData();
                    }
                } catch (error) {
                    this.showToast('Error loading members: ' + error.message, 'error');
                    this.loadSampleData();
                }
            }

            loadSampleData() {
                this.members = [
                    {
                        id: 1,
                        name: 'Rajesh Kumar',
                        email: 'rajesh.kumar@email.com',
                        phone: '+91 9876543210',
                        type: 'regular',
                        status: 'active',
                        joined: '2023-01-15',
                        state: 'Bharatiya',
                        city: 'Patna',
                        avatar: '../../images/default-avatar.png',
                        address: '123 Gandhi Maidan, Patna, Bharatiya',
                        occupation: 'Lawyer',
                        aadhar: '1234-5678-9012'
                    },
                    {
                        id: 2,
                        name: 'Priya Sharma',
                        email: 'priya.sharma@email.com',
                        phone: '+91 9876543211',
                        type: 'life',
                        status: 'active',
                        joined: '2022-08-20',
                        state: 'Bharatiya',
                        city: 'Gaya',
                        avatar: '../../images/default-avatar.png',
                        address: '456 Buddha Colony, Gaya, Bharatiya',
                        occupation: 'Social Worker',
                        aadhar: '2345-6789-0123'
                    },
                    {
                        id: 3,
                        name: 'Amit Singh',
                        email: 'amit.singh@email.com',
                        phone: '+91 9876543212',
                        type: 'student',
                        status: 'pending',
                        joined: '2024-01-10',
                        state: 'jharkhand',
                        city: 'Ranchi',
                        avatar: '../../images/default-avatar.png',
                        address: '789 University Road, Ranchi, Jharkhand',
                        occupation: 'Student',
                        aadhar: '3456-7890-1234'
                    }
                ];
                this.filteredMembers = [...this.members];
            }

            updateStats() {
                const stats = {
                    total: this.members.length,
                    active: this.members.filter(m => m.status === 'active').length,
                    pending: this.members.filter(m => m.status === 'pending').length,
                    inactive: this.members.filter(m => m.status === 'inactive').length
                };

                document.getElementById('totalMembers').textContent = stats.total;
                document.getElementById('activeMembers').textContent = stats.active;
                document.getElementById('pendingMembers').textContent = stats.pending;
                document.getElementById('inactiveMembers').textContent = stats.inactive;
            }

            renderMembers() {
                if (this.currentView === 'table') {
                    this.renderTableView();
                } else {
                    this.renderCardsView();
                }
                this.renderPagination();
            }

            renderTableView() {
                const tbody = document.getElementById('membersTableBody');
                const startIndex = (this.currentPage - 1) * this.itemsPerPage;
                const endIndex = startIndex + this.itemsPerPage;
                const pageMembers = this.filteredMembers.slice(startIndex, endIndex);

                tbody.innerHTML = pageMembers.map(member => `
                    <tr>
                        <td>
                            <input type="checkbox" value="${member.id}" onchange="toggleMemberSelection(${member.id})">
                        </td>
                        <td>
                            <div class="d-flex align-items-center">
                                <img src="${member.avatar}" alt="${member.name}" class="member-avatar me-2">
                                <div>
                                    <strong>${member.name}</strong><br>
                                    <small class="text-muted">ID: ${member.id}</small>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div>
                                <i class="fas fa-envelope"></i> ${member.email}<br>
                                <i class="fas fa-phone"></i> ${member.phone}
                            </div>
                        </td>
                        <td>
                            <span class="badge bg-info">${member.type.charAt(0).toUpperCase() + member.type.slice(1)}</span>
                        </td>
                        <td>
                            <span class="member-status status-${member.status}">${member.status.charAt(0).toUpperCase() + member.status.slice(1)}</span>
                        </td>
                        <td>${new Date(member.joined).toLocaleDateString()}</td>
                        <td>${member.city}, ${member.state.charAt(0).toUpperCase() + member.state.slice(1)}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn-action btn-view" onclick="viewMember(${member.id})" title="View Details">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn-action btn-edit" onclick="editMember(${member.id})" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn-action btn-delete" onclick="deleteMember(${member.id})" title="Delete">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            }

            renderCardsView() {
                const container = document.getElementById('membersCardsContainer');
                const startIndex = (this.currentPage - 1) * this.itemsPerPage;
                const endIndex = startIndex + this.itemsPerPage;
                const pageMembers = this.filteredMembers.slice(startIndex, endIndex);

                container.innerHTML = pageMembers.map(member => `
                    <div class="member-card">
                        <div class="member-card-header">
                            <img src="${member.avatar}" alt="${member.name}" class="member-card-avatar">
                            <div class="member-card-info">
                                <h5>${member.name}</h5>
                                <p>${member.type.charAt(0).toUpperCase() + member.type.slice(1)} Member</p>
                                <span class="member-status status-${member.status}">${member.status.charAt(0).toUpperCase() + member.status.slice(1)}</span>
                            </div>
                            <div class="ms-auto">
                                <input type="checkbox" value="${member.id}" onchange="toggleMemberSelection(${member.id})">
                            </div>
                        </div>
                        <div class="member-card-details">
                            <div class="detail-item">
                                <i class="fas fa-envelope"></i>
                                <span>${member.email}</span>
                            </div>
                            <div class="detail-item">
                                <i class="fas fa-phone"></i>
                                <span>${member.phone}</span>
                            </div>
                            <div class="detail-item">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>${member.city}, ${member.state.charAt(0).toUpperCase() + member.state.slice(1)}</span>
                            </div>
                            <div class="detail-item">
                                <i class="fas fa-calendar"></i>
                                <span>Joined: ${new Date(member.joined).toLocaleDateString()}</span>
                            </div>
                        </div>
                        <div class="action-buttons">
                            <button class="btn-action btn-view" onclick="viewMember(${member.id})">
                                <i class="fas fa-eye"></i> View
                            </button>
                            <button class="btn-action btn-edit" onclick="editMember(${member.id})">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="btn-action btn-delete" onclick="deleteMember(${member.id})">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </div>
                `).join('');
            }

            renderPagination() {
                const totalPages = Math.ceil(this.filteredMembers.length / this.itemsPerPage);
                const pagination = document.getElementById('pagination');
                
                if (totalPages <= 1) {
                    pagination.innerHTML = '';
                    return;
                }

                let paginationHTML = '';
                
                // Previous button
                paginationHTML += `
                    <li class="page-item ${this.currentPage === 1 ? 'disabled' : ''}">
                        <a class="page-link" href="#" onclick="changePage(${this.currentPage - 1})">Previous</a>
                    </li>
                `;

                // Page numbers
                for (let i = 1; i <= totalPages; i++) {
                    if (i === 1 || i === totalPages || (i >= this.currentPage - 2 && i <= this.currentPage + 2)) {
                        paginationHTML += `
                            <li class="page-item ${i === this.currentPage ? 'active' : ''}">
                                <a class="page-link" href="#" onclick="changePage(${i})">${i}</a>
                            </li>
                        `;
                    } else if (i === this.currentPage - 3 || i === this.currentPage + 3) {
                        paginationHTML += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
                    }
                }

                // Next button
                paginationHTML += `
                    <li class="page-item ${this.currentPage === totalPages ? 'disabled' : ''}">
                        <a class="page-link" href="#" onclick="changePage(${this.currentPage + 1})">Next</a>
                    </li>
                `;

                pagination.innerHTML = paginationHTML;
            }

            setupEventListeners() {
                document.getElementById('searchInput').addEventListener('input', () => {
                    this.searchMembers();
                });
            }

            searchMembers() {
                const query = document.getElementById('searchInput').value.toLowerCase();
                this.filteredMembers = this.members.filter(member => 
                    member.name.toLowerCase().includes(query) ||
                    member.email.toLowerCase().includes(query) ||
                    member.phone.includes(query) ||
                    member.city.toLowerCase().includes(query)
                );
                this.currentPage = 1;
                this.renderMembers();
            }

            filterMembers() {
                const statusFilter = document.getElementById('statusFilter').value;
                const typeFilter = document.getElementById('typeFilter').value;
                const stateFilter = document.getElementById('stateFilter').value;

                this.filteredMembers = this.members.filter(member => {
                    return (!statusFilter || member.status === statusFilter) &&
                           (!typeFilter || member.type === typeFilter) &&
                           (!stateFilter || member.state === stateFilter);
                });

                this.currentPage = 1;
                this.renderMembers();
            }

            clearFilters() {
                document.getElementById('searchInput').value = '';
                document.getElementById('statusFilter').value = '';
                document.getElementById('typeFilter').value = '';
                document.getElementById('stateFilter').value = '';
                this.filteredMembers = [...this.members];
                this.currentPage = 1;
                this.renderMembers();
            }

            switchView(view) {
                this.currentView = view;
                
                if (view === 'table') {
                    document.getElementById('tableView').style.display = 'block';
                    document.getElementById('cardsView').style.display = 'none';
                    document.getElementById('tableViewBtn').classList.add('active');
                    document.getElementById('cardsViewBtn').classList.remove('active');
                } else {
                    document.getElementById('tableView').style.display = 'none';
                    document.getElementById('cardsView').style.display = 'block';
                    document.getElementById('tableViewBtn').classList.remove('active');
                    document.getElementById('cardsViewBtn').classList.add('active');
                }
                
                this.renderMembers();
            }

            changePage(page) {
                const totalPages = Math.ceil(this.filteredMembers.length / this.itemsPerPage);
                if (page >= 1 && page <= totalPages) {
                    this.currentPage = page;
                    this.renderMembers();
                }
            }

            toggleMemberSelection(memberId) {
                if (this.selectedMembers.has(memberId)) {
                    this.selectedMembers.delete(memberId);
                } else {
                    this.selectedMembers.add(memberId);
                }
                
                const bulkActions = document.getElementById('bulkActions');
                bulkActions.style.display = this.selectedMembers.size > 0 ? 'flex' : 'none';
            }

            toggleSelectAll() {
                const checkboxes = document.querySelectorAll('input[type="checkbox"][value]');
                const selectAllCheckbox = document.getElementById('selectAll');
                
                checkboxes.forEach(checkbox => {
                    checkbox.checked = selectAllCheckbox.checked;
                    const memberId = parseInt(checkbox.value);
                    if (selectAllCheckbox.checked) {
                        this.selectedMembers.add(memberId);
                    } else {
                        this.selectedMembers.delete(memberId);
                    }
                });
                
                const bulkActions = document.getElementById('bulkActions');
                bulkActions.style.display = this.selectedMembers.size > 0 ? 'flex' : 'none';
            }

            viewMember(memberId) {
                const member = this.members.find(m => m.id === memberId);
                if (!member) return;

                const modalContent = document.getElementById('memberDetailsContent');
                modalContent.innerHTML = `
                    <div class="row">
                        <div class="col-md-4 text-center">
                            <img src="${member.avatar}" alt="${member.name}" class="img-fluid rounded-circle mb-3" style="width: 150px; height: 150px; object-fit: cover;">
                            <h5>${member.name}</h5>
                            <span class="badge bg-${member.status === 'active' ? 'success' : member.status === 'pending' ? 'warning' : 'danger'} mb-3">
                                ${member.status.charAt(0).toUpperCase() + member.status.slice(1)}
                            </span>
                        </div>
                        <div class="col-md-8">
                            <h6>Personal Information</h6>
                            <table class="table table-borderless">
                                <tr><td><strong>Email:</strong></td><td>${member.email}</td></tr>
                                <tr><td><strong>Phone:</strong></td><td>${member.phone}</td></tr>
                                <tr><td><strong>Membership Type:</strong></td><td>${member.type.charAt(0).toUpperCase() + member.type.slice(1)}</td></tr>
                                <tr><td><strong>Joined:</strong></td><td>${new Date(member.joined).toLocaleDateString()}</td></tr>
                                <tr><td><strong>Occupation:</strong></td><td>${member.occupation}</td></tr>
                                <tr><td><strong>Aadhar:</strong></td><td>${member.aadhar}</td></tr>
                                <tr><td><strong>Address:</strong></td><td>${member.address}</td></tr>
                            </table>
                        </div>
                    </div>
                `;

                const modal = new bootstrap.Modal(document.getElementById('memberDetailsModal'));
                modal.show();
            }

            async bulkApprove() {
                if (this.selectedMembers.size === 0) return;
                
                if (confirm(`Approve ${this.selectedMembers.size} selected members?`)) {
                    try {
                        // API call would go here
                        this.showToast(`${this.selectedMembers.size} members approved successfully`, 'success');
                        this.selectedMembers.clear();
                        document.getElementById('bulkActions').style.display = 'none';
                        await this.loadMembers();
                        this.renderMembers();
                    } catch (error) {
                        this.showToast('Error approving members: ' + error.message, 'error');
                    }
                }
            }

            async bulkSuspend() {
                if (this.selectedMembers.size === 0) return;
                
                if (confirm(`Suspend ${this.selectedMembers.size} selected members?`)) {
                    try {
                        // API call would go here
                        this.showToast(`${this.selectedMembers.size} members suspended successfully`, 'success');
                        this.selectedMembers.clear();
                        document.getElementById('bulkActions').style.display = 'none';
                        await this.loadMembers();
                        this.renderMembers();
                    } catch (error) {
                        this.showToast('Error suspending members: ' + error.message, 'error');
                    }
                }
            }

            async bulkDelete() {
                if (this.selectedMembers.size === 0) return;
                
                if (confirm(`Delete ${this.selectedMembers.size} selected members? This action cannot be undone.`)) {
                    try {
                        // API call would go here
                        this.showToast(`${this.selectedMembers.size} members deleted successfully`, 'success');
                        this.selectedMembers.clear();
                        document.getElementById('bulkActions').style.display = 'none';
                        await this.loadMembers();
                        this.renderMembers();
                    } catch (error) {
                        this.showToast('Error deleting members: ' + error.message, 'error');
                    }
                }
            }

            exportMembers() {
                const dataToExport = this.selectedMembers.size > 0 
                    ? this.members.filter(m => this.selectedMembers.has(m.id))
                    : this.filteredMembers;

                const csv = this.convertToCSV(dataToExport);
                this.downloadCSV(csv, 'members.csv');
                this.showToast('Members data exported successfully', 'success');
            }

            convertToCSV(data) {
                const headers = ['ID', 'Name', 'Email', 'Phone', 'Type', 'Status', 'Joined', 'City', 'State', 'Occupation'];
                const csvContent = [
                    headers.join(','),
                    ...data.map(member => [
                        member.id,
                        `"${member.name}"`,
                        member.email,
                        member.phone,
                        member.type,
                        member.status,
                        member.joined,
                        `"${member.city}"`,
                        member.state,
                        `"${member.occupation}"`
                    ].join(','))
                ].join('\n');
                
                return csvContent;
            }

            downloadCSV(csv, filename) {
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.setAttribute('hidden', '');
                a.setAttribute('href', url);
                a.setAttribute('download', filename);
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            }

            showToast(message, type = 'info') {
                const toastContainer = document.getElementById('toastContainer');
                const toastId = 'toast-' + Date.now();
                
                const toastHTML = `
                    <div id="${toastId}" class="toast align-items-center text-white bg-${type === 'error' ? 'danger' : type === 'success' ? 'success' : 'primary'} border-0" role="alert">
                        <div class="d-flex">
                            <div class="toast-body">${message}</div>
                            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                        </div>
                    </div>
                `;
                
                toastContainer.insertAdjacentHTML('beforeend', toastHTML);
                const toast = new bootstrap.Toast(document.getElementById(toastId));
                toast.show();
                
                document.getElementById(toastId).addEventListener('hidden.bs.toast', function() {
                    this.remove();
                });
            }
        }

        // Global functions
        let membersManager;

        function switchView(view) {
            membersManager.switchView(view);
        }

        function changePage(page) {
            membersManager.changePage(page);
        }

        function toggleMemberSelection(memberId) {
            membersManager.toggleMemberSelection(memberId);
        }

        function toggleSelectAll() {
            membersManager.toggleSelectAll();
        }

        function searchMembers() {
            membersManager.searchMembers();
        }

        function filterMembers() {
            membersManager.filterMembers();
        }

        function clearFilters() {
            membersManager.clearFilters();
        }

        function viewMember(memberId) {
            membersManager.viewMember(memberId);
        }

        function editMember(memberId) {
            window.location.href = `add_member.html?edit=${memberId}`;
        }

        function deleteMember(memberId) {
            if (confirm('Are you sure you want to delete this member?')) {
                // API call would go here
                membersManager.showToast('Member deleted successfully', 'success');
                membersManager.loadMembers();
            }
        }

        function bulkApprove() {
            membersManager.bulkApprove();
        }

        function bulkSuspend() {
            membersManager.bulkSuspend();
        }

        function bulkDelete() {
            membersManager.bulkDelete();
        }

        function bulkExport() {
            membersManager.exportMembers();
        }

        function exportMembers() {
            membersManager.exportMembers();
        }

        function refreshMembers() {
            membersManager.loadMembers();
            membersManager.showToast('Members list refreshed', 'success');
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('authToken');
                window.location.href = '../login.html';
            }
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            membersManager = new MembersManager();
        });
    </script>
</body>
</html>


